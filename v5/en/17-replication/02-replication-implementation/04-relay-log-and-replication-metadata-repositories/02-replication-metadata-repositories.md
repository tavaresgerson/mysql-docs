#### 16.2.4.2 Replication Metadata Repositories

A replica server creates two replication metadata repositories, the connection metadata repository and the applier metadata repository. The replication metadata repositories survive a replica server's shutdown. If binary log file position based replication is in use, when the replica restarts, it reads the two repositories to determine how far it previously proceeded in reading the binary log from the source and in processing its own relay log. If GTID-based replication is in use, the replica does not use the replication metadata repositories for that purpose, but does need them for the other metadata that they contain.

* The replica's *connection metadata repository* contains information that the replication I/O thread needs to connect to the replication source server and retrieve transactions from the source's binary log. The metadata in this repository includes the connection configuration, the replication user account details, the SSL settings for the connection, and the file name and position where the replication I/O thread is currently reading from the source's binary log.

* The replica's *applier metadata repository* contains information that the replication SQL thread needs to read and apply transactions from the replica's relay log. The metadata in this repository includes the file name and position up to which the replication SQL thread has executed the transactions in the relay log, and the equivalent position in the source's binary log. It also includes metadata for the process of applying transactions, such as the number of worker threads.

By default, the replication metadata repositories are created as files in the data directory named `master.info` and `relay-log.info`, or with alternative names and locations specified by the [`--master-info-file`](replication-options-replica.html#option_mysqld_master-info-file) option and [`relay_log_info_file`](replication-options-replica.html#sysvar_relay_log_info_file) system variable. To create the replication metadata repositories as tables, specify [`master_info_repository=TABLE`](replication-options-replica.html#sysvar_master_info_repository) and [`relay_log_info_repository=TABLE`](replication-options-replica.html#sysvar_relay_log_info_repository) at server startup. In that case, the replica's connection metadata repository is written to the `slave_master_info` table in the `mysql` system schema, and the replica's applier metadata repository is written to the `slave_relay_log_info` table in the `mysql` system schema. A warning message is issued if [**mysqld**](mysqld.html "4.3.1 mysqld — The MySQL Server") is unable to initialize the tables for the replication metadata repositories, but the replica is allowed to continue starting. This situation is most likely to occur when upgrading from a version of MySQL that does not support the use of tables for the repositories to one in which they are supported.

Important

1. Do not attempt to update or insert rows in the `mysql.slave_master_info` or `mysql.slave_relay_log_info` tables manually. Doing so can cause undefined behavior, and is not supported. Execution of any statement requiring a write lock on either or both of the `slave_master_info` and `slave_relay_log_info` tables is disallowed while replication is ongoing (although statements that perform only reads are permitted at any time).

2. Access to the replica's connection metadata repository file or table should be restricted to the database administrator, because it contains the replication user account name and password for connecting to the source. Use a restricted access mode to protect database backups that include this repository.

[`RESET SLAVE`](reset-slave.html "13.4.2.3 RESET SLAVE Statement") clears the data in the replication metadata repositories, with the exception of the replication connection parameters (depending on the MySQL Server release and repository type). For details, see the description for [`RESET SLAVE`](reset-slave.html "13.4.2.3 RESET SLAVE Statement").

If you set [`master_info_repository`](replication-options-replica.html#sysvar_master_info_repository) and [`relay_log_info_repository`](replication-options-replica.html#sysvar_relay_log_info_repository) to `TABLE`, the `mysql.slave_master_info` and `mysql.slave_relay_log_info` tables are created using the [`InnoDB`](innodb-storage-engine.html "Chapter 14 The InnoDB Storage Engine") transactional storage engine. Updates to the replica's applier metadata repository table are committed together with the transactions, meaning that the replica's progress information recorded in that repository is always consistent with what has been applied to the database, even in the event of an unexpected server halt. The [`--relay-log-recovery`](replication-options-replica.html#sysvar_relay_log_recovery) option must be enabled on the replica to guarantee resilience. For more details, see [Section 16.3.2, “Handling an Unexpected Halt of a Replica”](replication-solutions-unexpected-replica-halt.html "16.3.2 Handling an Unexpected Halt of a Replica").

When you back up the replica's data or transfer a snapshot of its data to create a new replica, ensure that you include the `mysql.slave_master_info` and `mysql.slave_relay_log_info` tables containing the replication metadata repositories, or the equivalent files (`master.info` and `relay-log.info` in the data directory, unless you specified alternative names and locations). When binary log file position based replication is in use, the replication metadata repositories are needed to resume replication after restarting the restored or copied replica. If you do not have the relay log files, but still have the replica's applier metadata repository, you can check it to determine how far the replication SQL thread has executed in the source's binary log. Then you can use a [`CHANGE MASTER TO`](change-master-to.html "13.4.2.1 CHANGE MASTER TO Statement") statement with the `MASTER_LOG_FILE` and `MASTER_LOG_POS` options to tell the replica to re-read the binary logs from the source from that point (provided that the required binary logs still exist on the source).

One additional repository, the applier worker metadata repository, is created primarily for internal use, and holds status information about worker threads on a multithreaded replica. The applier worker metadata repository includes the names and positions for the relay log file and the source's binary log file for each worker thread. If the replica's applier metadata repository is created as a table, which is the default, the applier worker metadata repository is written to the `mysql.slave_worker_info` table. If the applier metadata repository is written to a file, the applier worker metadata repository is written to the `worker-relay-log.info` file. For external use, status information for worker threads is presented in the Performance Schema [`replication_applier_status_by_worker`](performance-schema-replication-applier-status-by-worker-table.html "25.12.11.6 The replication_applier_status_by_worker Table") table.

The replication metadata repositories originally contained information similar to that shown in the output of the [`SHOW SLAVE STATUS`](show-slave-status.html "13.7.5.34 SHOW SLAVE STATUS Statement") statement, which is discussed in [Section 13.4.2, “SQL Statements for Controlling Replica Servers”](replication-statements-replica.html "13.4.2 SQL Statements for Controlling Replica Servers"). Further information has since been added to the replication metadata repositories which is not displayed by the [`SHOW SLAVE STATUS`](show-slave-status.html "13.7.5.34 SHOW SLAVE STATUS Statement") statement.

For the connection metadata repository, the following table shows the correspondence between the columns in the `mysql.slave_master_info` table, the columns displayed by [`SHOW SLAVE STATUS`](show-slave-status.html "13.7.5.34 SHOW SLAVE STATUS Statement"), and the lines in the `master.info` file.

<table summary="The correspondence between the lines in the master.info file, the columns in the mysql.slave_master_info table, and the columns displayed by SHOW SLAVE STATUS."><col style="width: 16%"/><col style="width: 31%"/><col style="width: 40%"/><col style="width: 18%"/><thead><tr> <th scope="col"><code class="filename">master.info</code> File Line</th> <th scope="col"><code>slave_master_info</code> Table Column</th> <th scope="col"><code>SHOW SLAVE STATUS</code> Column</th> <th scope="col">Description</th> </tr></thead><tbody><tr> <th scope="row">1</th> <td><code>Number_of_lines</code></td> <td>[None]</td> <td>Number of lines in the file, or columns in the table</td> </tr><tr> <th scope="row">2</th> <td><code>Master_log_name</code></td> <td><code>Master_Log_File</code></td> <td>The name of the binary log currently being read from the source</td> </tr><tr> <th scope="row">3</th> <td><code>Master_log_pos</code></td> <td><code>Read_Master_Log_Pos</code></td> <td>The current position within the binary log that has been read from the source</td> </tr><tr> <th scope="row">4</th> <td><code>Host</code></td> <td><code>Master_Host</code></td> <td>The host name of the source server</td> </tr><tr> <th scope="row">5</th> <td><code>User_name</code></td> <td><code>Master_User</code></td> <td>The replication user name used to connect to the source</td> </tr><tr> <th scope="row">6</th> <td><code>User_password</code></td> <td>Password (not shown by <a class="link" href="show-slave-status.html" title="13.7.5.34 SHOW SLAVE STATUS Statement"><code>SHOW SLAVE STATUS</code></a>)</td> <td>The password used to connect to the source</td> </tr><tr> <th scope="row">7</th> <td><code>Port</code></td> <td><code>Master_Port</code></td> <td>The network port used to connect to the source</td> </tr><tr> <th scope="row">8</th> <td><code>Connect_retry</code></td> <td><code>Connect_Retry</code></td> <td>The period (in seconds) that the replica waits before trying to reconnect to the source</td> </tr><tr> <th scope="row">9</th> <td><code>Enabled_ssl</code></td> <td><code>Master_SSL_Allowed</code></td> <td>Indicates whether the server supports SSL connections</td> </tr><tr> <th scope="row">10</th> <td><code>Ssl_ca</code></td> <td><code>Master_SSL_CA_File</code></td> <td>The file used for the Certificate Authority (CA) certificate</td> </tr><tr> <th scope="row">11</th> <td><code>Ssl_capath</code></td> <td><code>Master_SSL_CA_Path</code></td> <td>The path to the Certificate Authority (CA) certificates</td> </tr><tr> <th scope="row">12</th> <td><code>Ssl_cert</code></td> <td><code>Master_SSL_Cert</code></td> <td>The name of the SSL certificate file</td> </tr><tr> <th scope="row">13</th> <td><code>Ssl_cipher</code></td> <td><code>Master_SSL_Cipher</code></td> <td>The list of possible ciphers used in the handshake for the SSL connection</td> </tr><tr> <th scope="row">14</th> <td><code>Ssl_key</code></td> <td><code>Master_SSL_Key</code></td> <td>The name of the SSL key file</td> </tr><tr> <th scope="row">15</th> <td><code>Ssl_verify_server_cert</code></td> <td><code>Master_SSL_Verify_Server_Cert</code></td> <td>Whether to verify the server certificate</td> </tr><tr> <th scope="row">16</th> <td><code>Heartbeat</code></td> <td>[None]</td> <td>Interval between replication heartbeats, in seconds</td> </tr><tr> <th scope="row">17</th> <td><code>Bind</code></td> <td><code>Master_Bind</code></td> <td>Which of the replica's network interfaces should be used for connecting to the source</td> </tr><tr> <th scope="row">18</th> <td><code>Ignored_server_ids</code></td> <td><code>Replicate_Ignore_Server_Ids</code></td> <td>The list of server IDs to be ignored. Note that for <code>Ignored_server_ids</code> the list of server IDs is preceded by the total number of server IDs to ignore.</td> </tr><tr> <th scope="row">19</th> <td><code>Uuid</code></td> <td><code>Master_UUID</code></td> <td>The source's unique ID</td> </tr><tr> <th scope="row">20</th> <td><code>Retry_count</code></td> <td><code>Master_Retry_Count</code></td> <td>Maximum number of reconnection attempts permitted</td> </tr><tr> <th scope="row">21</th> <td><code>Ssl_crl</code></td> <td>[None]</td> <td>Path to an SSL certificate revocation-list file</td> </tr><tr> <th scope="row">22</th> <td><code>Ssl_crlpath</code></td> <td>[None]</td> <td>Path to a directory containing SSL certificate revocation-list files</td> </tr><tr> <th scope="row">23</th> <td><code>Enabled_auto_position</code></td> <td><code>Auto_position</code></td> <td>If autopositioning is in use or not</td> </tr><tr> <th scope="row">24</th> <td><code>Channel_name</code></td> <td><code>Channel_name</code></td> <td>The name of the replication channel</td> </tr><tr> <th scope="row">25</th> <td><code>Tls_version</code></td> <td><code>Master_TLS_Version</code></td> <td>TLS version on source</td> </tr></tbody></table>

For the applier metadata repository, the following table shows the correspondence between the columns in the `mysql.slave_relay_log_info` table, the columns displayed by [`SHOW SLAVE STATUS`](show-slave-status.html "13.7.5.34 SHOW SLAVE STATUS Statement"), and the lines in the `relay-log.info` file.

<table summary="The correspondence between the lines in the relay-log.info file, the columns in the mysql.slave_relay_log_info table, and the columns displayed by SHOW SLAVE STATUS."><col style="width: 15%"/><col style="width: 30%"/><col style="width: 40%"/><col style="width: 20%"/><thead><tr> <th scope="col">Line in <code class="filename">relay-log.info</code></th> <th scope="col"><code>slave_relay_log_info</code> Table Column</th> <th scope="col"><code>SHOW SLAVE STATUS</code> Column</th> <th scope="col">Description</th> </tr></thead><tbody><tr> <th scope="row">1</th> <td><code>Number_of_lines</code></td> <td>[None]</td> <td>Number of lines in the file or columns in the table</td> </tr><tr> <th scope="row">2</th> <td><code>Relay_log_name</code></td> <td><code>Relay_Log_File</code></td> <td>The name of the current relay log file</td> </tr><tr> <th scope="row">3</th> <td><code>Relay_log_pos</code></td> <td><code>Relay_Log_Pos</code></td> <td>The current position within the relay log file; events up to this position have been executed on the replica database</td> </tr><tr> <th scope="row">4</th> <td><code>Master_log_name</code></td> <td><code>Relay_Master_Log_File</code></td> <td>The name of the source's binary log file from which the events in the relay log file were read</td> </tr><tr> <th scope="row">5</th> <td><code>Master_log_pos</code></td> <td><code>Exec_Master_Log_Pos</code></td> <td>The equivalent position within the source's binary log file of events that have already been executed</td> </tr><tr> <th scope="row">6</th> <td><code>Sql_delay</code></td> <td><code>SQL_Delay</code></td> <td>The number of seconds that the replica must lag the source</td> </tr><tr> <th scope="row">7</th> <td><code>Number_of_workers</code></td> <td>[None]</td> <td>The number of worker threads on the replica for executing replication events (transactions) in parallel</td> </tr><tr> <th scope="row">8</th> <td><code>Id</code></td> <td>[None]</td> <td>ID used for internal purposes; currently this is always 1</td> </tr><tr> <th scope="row">9</th> <td><code>Channel_name</code></td> <td>Channel_name</td> <td>The name of the replication channel</td> </tr></tbody></table>

In versions of MySQL prior to MySQL 5.6, the `relay-log.info` file does not include a line count or a delay value (and the `slave_relay_log_info` table is not available).

<table summary="The correspondence between lines in the relay-log.info file and items that appear in the Status column."><col style="width: 15%"/><col style="width: 35%"/><col style="width: 50%"/><thead><tr> <th scope="col">Line</th> <th scope="col">Status Column</th> <th scope="col">Description</th> </tr></thead><tbody><tr> <th scope="row">1</th> <td><code>Relay_Log_File</code></td> <td>The name of the current relay log file</td> </tr><tr> <th scope="row">2</th> <td><code>Relay_Log_Pos</code></td> <td>The current position within the relay log file; events up to this position have been executed on the replica database</td> </tr><tr> <th scope="row">3</th> <td><code>Relay_Master_Log_File</code></td> <td>The name of the source's binary log file from which the events in the relay log file were read</td> </tr><tr> <th scope="row">4</th> <td><code>Exec_Master_Log_Pos</code></td> <td>The equivalent position within the source's binary log file of events that have already been executed</td> </tr></tbody></table>

Note

If you downgrade a replica server to a version older than MySQL 5.6, the older server does not read the `relay-log.info` file correctly. To address this, modify the file in a text editor by deleting the initial line containing the number of lines.

The contents of the `relay-log.info` file and the states shown by the [`SHOW SLAVE STATUS`](show-slave-status.html "13.7.5.34 SHOW SLAVE STATUS Statement") statement might not match if the `relay-log.info` file has not been flushed to disk. Ideally, you should only view `relay-log.info` on a replica that is offline (that is, `mysqld` is not running). For a running system, you can use [`SHOW SLAVE STATUS`](show-slave-status.html "13.7.5.34 SHOW SLAVE STATUS Statement"), or query the `mysql.slave_master_info` and `mysql.slave_relay_log_info` tables if you are writing the replication metadata repositories to tables.
