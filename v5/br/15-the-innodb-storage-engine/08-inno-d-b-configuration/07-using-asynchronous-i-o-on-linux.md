### 14.8.7 Uso de I/O Assíncrono no Linux

O `InnoDB` utiliza o subsistema de I/O assíncrono (AIO nativo) no Linux para executar requisições de *read-ahead* e de escrita para páginas de arquivos de dados. Este comportamento é controlado pela opção de configuração `innodb_use_native_aio`, que se aplica apenas a sistemas Linux e está habilitada por padrão. Em outros sistemas tipo Unix, o `InnoDB` usa apenas I/O síncrono. Historicamente, o `InnoDB` usava I/O assíncrono apenas em sistemas Windows. O uso do subsistema de I/O assíncrono no Linux requer a biblioteca `libaio`.

Com I/O síncrono, as *query threads* enfileiram requisições de I/O, e as *background threads* do `InnoDB` recuperam as requisições enfileiradas uma de cada vez, emitindo uma chamada de I/O síncrona para cada. Quando uma requisição de I/O é concluída e a chamada de I/O retorna, a *background thread* do `InnoDB` que está lidando com a requisição chama uma rotina de conclusão de I/O e retorna para processar a próxima requisição. O número de requisições que podem ser processadas em paralelo é *`n`*, onde *`n`* é o número de *background threads* do `InnoDB`. O número de *background threads* do `InnoDB` é controlado por `innodb_read_io_threads` e `innodb_write_io_threads`. Consulte a Seção 14.8.6, “Configuring the Number of Background InnoDB I/O Threads”.

Com AIO nativo, as *query threads* despacham requisições de I/O diretamente para o sistema operacional, removendo assim o limite imposto pelo número de *background threads*. As *background threads* do `InnoDB` aguardam eventos de I/O para sinalizar requisições concluídas. Quando uma requisição é concluída, uma *background thread* chama uma rotina de conclusão de I/O e retoma a espera por eventos de I/O.

A vantagem do AIO nativo é a escalabilidade para sistemas com alta dependência de I/O (*I/O-bound*), que tipicamente mostram muitas leituras/escritas pendentes na saída de `SHOW ENGINE INNODB STATUS\G`. O aumento no processamento paralelo ao usar AIO nativo significa que o tipo de *I/O scheduler* ou as propriedades do controlador do *disk array* têm uma influência maior no desempenho de I/O.

Uma desvantagem potencial do AIO nativo para sistemas com alta dependência de I/O (*I/O-bound*) é a falta de controle sobre o número de requisições de escrita de I/O despachadas simultaneamente para o sistema operacional. Muitas requisições de escrita de I/O despachadas para o sistema operacional para processamento paralelo podem, em alguns casos, resultar em *I/O read starvation* (privação de leitura de I/O), dependendo da quantidade de atividade de I/O e das capacidades do sistema.

Se um problema com o subsistema de I/O assíncrono no OS impedir o `InnoDB` de iniciar, você pode iniciar o servidor com `innodb_use_native_aio=0`. Esta opção também pode ser desabilitada automaticamente durante a inicialização se o `InnoDB` detectar um problema potencial, como uma combinação de localização `tmpdir`, sistema de arquivos `tmpfs` e *Linux kernel* que não suporte I/O assíncrono em `tmpfs`.