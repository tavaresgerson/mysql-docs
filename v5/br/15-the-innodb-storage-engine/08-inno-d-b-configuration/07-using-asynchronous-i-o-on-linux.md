### 14.8.7 Usar E/S assíncrona no Linux

O `InnoDB` utiliza o subsistema de E/S assíncrona (AIO nativo) no Linux para realizar solicitações de leitura à frente e escrita de páginas de arquivos de dados. Esse comportamento é controlado pela opção de configuração `innodb_use_native_aio`, que se aplica apenas a sistemas Linux e é ativada por padrão. Em outros sistemas semelhantes ao Unix, o `InnoDB` usa apenas E/S síncrona. Historicamente, o `InnoDB` usava apenas E/S assíncrona em sistemas Windows. O uso do subsistema de E/S assíncrona no Linux requer a biblioteca `libaio`.

Com I/O síncrono, os threads de consulta colocam as solicitações de I/O em fila, e os threads de plano de fundo do `InnoDB` recuperam as solicitações em fila uma de cada vez, emitindo uma chamada de I/O síncrona para cada uma. Quando uma solicitação de I/O é concluída e a chamada de I/O retorna, o thread de plano de fundo do `InnoDB` que está lidando com a solicitação chama uma rotina de conclusão de I/O e retorna para processar a próxima solicitação. O número de solicitações que podem ser processadas em paralelo é *`n`*, onde *`n`* é o número de threads de plano de fundo do `InnoDB`. O número de threads de plano de fundo do `InnoDB` é controlado por `innodb_read_io_threads` e `innodb_write_io_threads`. Veja a Seção 14.8.6, “Configurando o Número de Threads de I/O de Plano de Fundo do `InnoDB`”.

Com o AIO nativo, os threads de consulta enviam solicitações de E/S diretamente ao sistema operacional, removendo assim o limite imposto pelo número de threads em segundo plano. Os threads de segundo plano do `InnoDB` aguardam por eventos de E/S para sinalizar solicitações concluídas. Quando uma solicitação é concluída, um thread de segundo plano chama uma rotina de conclusão de E/S e retoma a espera por eventos de E/S.

A vantagem do AIO nativo é a escalabilidade para sistemas com grande demanda de E/S, que geralmente mostram muitos leitores/escritores pendentes na saída `SHOW ENGINE INNODB STATUS\G`. O aumento no processamento paralelo ao usar o AIO nativo significa que o tipo de agendador de E/S ou as propriedades do controlador da matriz de discos têm uma influência maior no desempenho da E/S.

Uma possível desvantagem do AIO nativo para sistemas com alto tráfego de E/S é a falta de controle sobre o número de solicitações de escrita de E/S enviadas ao sistema operacional de uma só vez. Se forem enviadas muitas solicitações de escrita de E/S ao sistema operacional para processamento paralelo, isso pode, em alguns casos, resultar em escassez de leitura de E/S, dependendo da quantidade de atividade de E/S e das capacidades do sistema.

Se um problema com o subsistema de E/S assíncrona no sistema operacional impedir que o `InnoDB` seja iniciado, você pode iniciar o servidor com `innodb_use_native_aio=0`. Essa opção também pode ser desabilitada automaticamente durante a inicialização se o `InnoDB` detectar um problema potencial, como uma combinação de local de `tmpdir`, sistema de arquivos `tmpfs` e kernel Linux que não suporta E/S assíncrona em `tmpfs`.
