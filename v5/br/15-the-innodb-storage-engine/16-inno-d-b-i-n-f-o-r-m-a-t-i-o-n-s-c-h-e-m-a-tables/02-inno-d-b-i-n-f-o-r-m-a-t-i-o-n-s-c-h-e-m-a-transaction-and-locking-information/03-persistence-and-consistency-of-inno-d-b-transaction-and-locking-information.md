#### 14.16.2.3 Persistência e Consistência das Informações de Transação e Bloqueio do InnoDB

Os dados expostos pelas tabelas de transação e bloqueio (`INNODB_TRX`, `INNODB_LOCKS` e `INNODB_LOCK_WAITS`) representam um vislumbre de dados em rápida mudança. Isso não é como as tabelas de usuários, onde os dados mudam apenas quando ocorrem atualizações iniciadas pela aplicação. Os dados subjacentes são dados gerenciados internamente pelo sistema e podem mudar muito rapidamente.

Por razões de desempenho e para minimizar a chance de junções enganosas entre a transação e as tabelas de bloqueio, o `InnoDB` coleta as informações necessárias sobre a transação e o bloqueio em um buffer intermediário sempre que uma consulta `SELECT` é emitida em qualquer uma das tabelas. Esse buffer é atualizado apenas se mais de 0,1 segundo tiver se passado desde a última vez que o buffer foi lido. Os dados necessários para preencher as três tabelas são obtidos de forma atômica e consistente e são salvos nesse buffer interno global, formando um "instantâneo" no momento. Se múltiplos acessos às tabelas ocorrerem em 0,1 segundo (como quase certamente acontece quando o MySQL processa uma junção entre essas tabelas), o mesmo instantâneo é usado para satisfazer a consulta.

Um resultado correto é retornado quando você junta qualquer uma dessas tabelas em uma única consulta, porque os dados das três tabelas vêm do mesmo instantâneo. Como o buffer não é atualizado a cada consulta de qualquer uma dessas tabelas, se você emitir consultas separadas contra essas tabelas em um décimo de segundo, os resultados são os mesmos de consulta em consulta. Por outro lado, duas consultas separadas das mesmas ou de tabelas diferentes emitidas com mais de um décimo de segundo de diferença podem ver resultados diferentes, pois os dados vêm de instantâneos diferentes.

Como o `InnoDB` deve suspender temporariamente enquanto os dados da transação e do bloqueio são coletados, consultas muito frequentes nessas tabelas podem afetar negativamente o desempenho, conforme observado por outros usuários.

Como essas tabelas contêm informações sensíveis (pelo menos `INNODB_LOCKS.LOCK_DATA` e `INNODB_TRX.TRX_QUERY`), por razões de segurança, apenas os usuários com o privilégio `PROCESSO` têm permissão para `SELECT` delas.

Como descrito anteriormente, os dados que preenchem as tabelas de transação e bloqueio (`INNODB_TRX`, `INNODB_LOCKS` e `INNODB_LOCK_WAITS`) são recuperados automaticamente e salvos em um buffer intermediário que fornece uma instantânea “no momento”. Os dados em todas as três tabelas são consistentes quando consultados a partir do mesmo instantâneo. No entanto, os dados subjacentes mudam tão rapidamente que vislumbres semelhantes de outros dados que mudam de forma semelhante podem não estar em sincronia. Portanto, você deve ter cuidado ao comparar dados nas tabelas de transação e bloqueio do `InnoDB` com dados na tabela `PROCESSLIST`. Os dados da tabela `PROCESSLIST` não vêm do mesmo instantâneo que os dados sobre bloqueio e transação. Mesmo que você execute uma única consulta `SELECT` (juntando `INNODB_TRX` e `PROCESSLIST`, por exemplo), o conteúdo dessas tabelas geralmente não é consistente. `INNODB_TRX` pode referenciar linhas que não estão presentes em `PROCESSLIST` ou a consulta SQL atualmente em execução de uma transação mostrada em `INNODB_TRX.TRX_QUERY` pode diferir daquela em `PROCESSLIST.INFO`.
