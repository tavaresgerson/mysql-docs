#### 14.16.1.3 Usando as Tabelas do Schema de Informações de Compressão

**Exemplo 14.1 Usando as Tabelas do Schema de Informações de Compressão**

A seguir, temos uma saída de exemplo de um Database que contém tabelas comprimidas (veja Seção 14.9, “Compressão de Tabela e Página InnoDB”, `INNODB_CMP`, `INNODB_CMP_PER_INDEX`, e `INNODB_CMPMEM`).

A tabela a seguir mostra o conteúdo da tabela `INNODB_CMP` do Schema de Informações sob uma carga de trabalho leve. O único tamanho de página comprimida que o Buffer Pool contém é 8K. Comprimir ou descomprimir páginas consumiu menos de um segundo desde o momento em que as estatísticas foram redefinidas, pois as colunas `COMPRESS_TIME` e `UNCOMPRESS_TIME` estão zeradas.

<table summary="Dados de exemplo da tabela INFORMATION_SCHEMA.INNODB_CMP, mostrando o funcionamento interno da compressão de tabela InnoDB sob uma carga de trabalho leve."><col style="width: 15%"/><col style="width: 15%"/><col style="width: 15%"/><col style="width: 15%"/><col style="width: 20%"/><col style="width: 20%"/><thead><tr> <th>tamanho da página</th> <th>ops de compressão</th> <th>ops de compressão ok</th> <th>tempo de compressão</th> <th>ops de descompressão</th> <th>tempo de descompressão</th> </tr></thead><tbody><tr> <th>1024</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr><tr> <th>2048</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr><tr> <th>4096</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr><tr> <th>8192</th> <td>1048</td> <td>921</td> <td>0</td> <td>61</td> <td>0</td> </tr><tr> <th>16384</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr></tbody></table>

De acordo com `INNODB_CMPMEM`, existem 6169 páginas comprimidas de 8KB no Buffer Pool. O único outro tamanho de bloco alocado é de 64 bytes. O menor `PAGE_SIZE` em `INNODB_CMPMEM` é usado para descritores de bloco daquelas páginas comprimidas para as quais nenhuma página não comprimida existe no Buffer Pool. Vemos que existem 5910 páginas desse tipo. Indiretamente, vemos que 259 (6169-5910) páginas comprimidas também existem no Buffer Pool em formato não comprimido.

A tabela a seguir mostra o conteúdo da tabela `INNODB_CMPMEM` do Schema de Informações sob uma carga de trabalho leve. Parte da memória é inutilizável devido à fragmentação do alocador de memória para páginas comprimidas: `SUM(PAGE_SIZE*PAGES_FREE)=6784`. Isso ocorre porque as solicitações de alocação de memória pequenas são atendidas pela divisão de blocos maiores, começando pelos blocos de 16K que são alocados a partir do Buffer Pool principal, usando o sistema de alocação *buddy*. A fragmentação está baixa porque alguns blocos alocados foram realocados (copiados) para formar blocos livres adjacentes maiores. Essa cópia de `SUM(PAGE_SIZE*RELOCATION_OPS)` bytes consumiu menos de um segundo `(SUM(RELOCATION_TIME)=0)`.

<table summary="Dados de exemplo da tabela INFORMATION_SCHEMA.INNODB_CMPMEM, mostrando as operações de memória do Buffer Pool para a compressão de tabelas InnoDB sob uma carga de trabalho leve."><col style="width: 15%"/><col style="width: 15%"/><col style="width: 20%"/><col style="width: 20%"/><col style="width: 20%"/><thead><tr> <th>tamanho da página</th> <th>páginas em uso</th> <th>páginas livres</th> <th>ops de realocação</th> <th>tempo de realocação</th> </tr></thead><tbody><tr> <th>64</th> <td>5910</td> <td>0</td> <td>2436</td> <td>0</td> </tr><tr> <th>128</th> <td>0</td> <td>1</td> <td>0</td> <td>0</td> </tr><tr> <th>256</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr><tr> <th>512</th> <td>0</td> <td>1</td> <td>0</td> <td>0</td> </tr><tr> <th>1024</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr><tr> <th>2048</th> <td>0</td> <td>1</td> <td>0</td> <td>0</td> </tr><tr> <th>4096</th> <td>0</td> <td>1</td> <td>0</td> <td>0</td> </tr><tr> <th>8192</th> <td>6169</td> <td>0</td> <td>5</td> <td>0</td> </tr><tr> <th>16384</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr></tbody></table>