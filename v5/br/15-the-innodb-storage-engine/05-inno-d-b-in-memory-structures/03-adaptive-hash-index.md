### 14.5.3 Index Hash Adaptável

O Index Hash adaptável permite que o `InnoDB` se comporte mais como um Database in-memory em sistemas com combinações apropriadas de *workload* (carga de trabalho) e memória suficiente para o Buffer Pool, sem sacrificar recursos transacionais ou confiabilidade. O Index Hash adaptável é ativado pela variável `innodb_adaptive_hash_index`, ou desativado na inicialização do servidor por `--skip-innodb-adaptive-hash-index`.

Com base no padrão de buscas observado, um Index Hash é construído usando um prefixo da chave do Index. O prefixo pode ter qualquer comprimento, e pode ser que apenas alguns valores na B-tree apareçam no Index Hash. Indexes Hash são construídos sob demanda para as páginas do Index que são acessadas frequentemente.

Se uma tabela cabe quase inteiramente na memória principal, um Index Hash acelera as Queries, permitindo a pesquisa direta de qualquer elemento, transformando o valor do Index em uma espécie de *pointer* (ponteiro). O `InnoDB` possui um mecanismo que monitora as buscas de Index. Se o `InnoDB` percebe que as Queries podem se beneficiar da construção de um Index Hash, ele o faz automaticamente.

Em algumas cargas de trabalho (*workloads*), o ganho de velocidade das pesquisas do Index Hash supera em muito o trabalho extra para monitorar as pesquisas de Index e manter a estrutura do Index Hash. O acesso ao Index Hash adaptável pode, por vezes, tornar-se uma fonte de *contention* (contenção) sob *workloads* pesadas, como múltiplos JOINs concorrentes. Queries com operadores `LIKE` e curingas `%` também tendem a não se beneficiar. Para *workloads* que não se beneficiam do Index Hash adaptável, desativá-lo reduz a sobrecarga de desempenho desnecessária. Como é difícil prever antecipadamente se o recurso de Index Hash adaptável é apropriado para um sistema e *workload* específicos, considere executar *benchmarks* com ele ativado e desativado.

No MySQL 5.7, o recurso de Index Hash adaptável é particionado. Cada Index é vinculado a uma partição específica, e cada partição é protegida por um *latch* separado. O particionamento é controlado pela variável `innodb_adaptive_hash_index_parts`. Em versões anteriores, o recurso de Index Hash adaptável era protegido por um único *latch*, que poderia se tornar um ponto de contenção (*contention*) sob *workloads* pesadas. A variável `innodb_adaptive_hash_index_parts` é definida como 8 por padrão. A configuração máxima é 512.

Você pode monitorar o uso e a contenção (*contention*) do Index Hash adaptável na seção `SEMAPHORES` da saída de `SHOW ENGINE INNODB STATUS`. Se houver inúmeros Threads esperando por *rw-latches* criados em `btr0sea.c`, considere aumentar o número de partições do Index Hash adaptável ou desativar o Index Hash adaptável.

Para obter informações sobre as características de desempenho dos Indexes Hash, consulte a Seção 8.3.8, “Comparação de B-Tree e Indexes Hash”.