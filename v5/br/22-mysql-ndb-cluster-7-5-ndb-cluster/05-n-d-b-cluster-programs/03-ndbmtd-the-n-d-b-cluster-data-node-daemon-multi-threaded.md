### 21.5.3 ndbmtd — O Daemon (Multi-Threaded) do Data Node do NDB Cluster

[**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") é uma versão multi-threaded do [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon"), o processo usado para manipular todos os dados em tabelas que utilizam o storage engine [`NDBCLUSTER`](mysql-cluster.html "Chapter 21 MySQL NDB Cluster 7.5 and NDB Cluster 7.6"). O [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") é destinado ao uso em hosts que possuem múltiplos núcleos de CPU (cores). Exceto quando indicado de outra forma, o [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") funciona da mesma maneira que o [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon"); portanto, nesta seção, focamos nas formas em que o [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") difere do [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon"). Você deve consultar [Section 21.5.1, “ndbd — The NDB Cluster Data Node Daemon”](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon"), para obter informações adicionais sobre a execução de Data Nodes do NDB Cluster que se aplicam tanto às versões single-threaded quanto multi-threaded do processo do Data Node.

As opções de linha de comando e os parâmetros de configuração usados com [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon") também se aplicam ao [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)"). Para obter mais informações sobre essas opções e parâmetros, consulte [Section 21.5.1, “ndbd — The NDB Cluster Data Node Daemon”](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon") e [Section 21.4.3.6, “Defining NDB Cluster Data Nodes”](mysql-cluster-ndbd-definition.html "21.4.3.6 Defining NDB Cluster Data Nodes"), respectivamente.

O [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") também é compatível em nível de file system com o [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon"). Em outras palavras, um Data Node executando o [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon") pode ser interrompido, seu Binary substituído pelo [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)"), e então reiniciado sem qualquer perda de dados. (No entanto, ao fazer isso, você deve garantir que [`MaxNoOfExecutionThreads`](mysql-cluster-ndbd-definition.html#ndbparam-ndbmtd-maxnoofexecutionthreads) esteja definido para um valor apropriado antes de reiniciar o Node, caso deseje que o [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") seja executado de forma multi-threaded.) Da mesma forma, um Binary [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") pode ser substituído pelo [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon") simplesmente interrompendo o Node e iniciando o [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon") no lugar do Binary multi-threaded. Não é necessário, ao alternar entre os dois, iniciar o Binary do Data Node usando [`--initial`](mysql-cluster-programs-ndbd.html#option_ndbd_initial).

O uso do [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") difere do uso do [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon") em dois aspectos principais:

1. Como o [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") é executado por padrão no modo single-threaded (ou seja, se comporta como o [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon")), você deve configurá-lo para usar múltiplos Threads. Isso pode ser feito definindo um valor apropriado no arquivo `config.ini` para o parâmetro de configuração [`MaxNoOfExecutionThreads`](mysql-cluster-ndbd-definition.html#ndbparam-ndbmtd-maxnoofexecutionthreads) ou para o parâmetro [`ThreadConfig`](mysql-cluster-ndbd-definition.html#ndbparam-ndbmtd-threadconfig). O uso de `MaxNoOfExecutionThreads` é mais simples, mas `ThreadConfig` oferece mais flexibilidade. Para obter mais informações sobre esses parâmetros de configuração e seu uso, consulte [Multi-Threading Configuration Parameters (ndbmtd)](mysql-cluster-ndbd-definition.html#mysql-cluster-ndbd-definition-ndbmtd-parameters "Multi-Threading Configuration Parameters (ndbmtd)").

2. Trace files são gerados por erros críticos em processos [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") de uma maneira um pouco diferente de como são gerados por falhas do [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon"). Essas diferenças são discutidas em mais detalhes nos próximos parágrafos.

Assim como o [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon"), o [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") gera um conjunto de log files que são colocados no diretório especificado por [`DataDir`](mysql-cluster-ndbd-definition.html#ndbparam-ndbd-datadir) no arquivo de configuração `config.ini`. Exceto pelos trace files, eles são gerados da mesma forma e têm os mesmos nomes daqueles gerados pelo [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon").

No caso de um erro crítico, o [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") gera trace files descrevendo o que aconteceu imediatamente antes da ocorrência do erro. Esses arquivos, que podem ser encontrados no [`DataDir`](mysql-cluster-ndbd-definition.html#ndbparam-ndbd-datadir) do Data Node, são úteis para a análise de problemas pelas equipes de Desenvolvimento e Suporte do NDB Cluster. Um trace file é gerado para cada Thread do [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)"). Os nomes desses arquivos seguem o seguinte padrão:

```sql
ndb_node_id_trace.log.trace_id_tthread_id,
```

Neste padrão, *`node_id`* representa o ID exclusivo do Data Node no Cluster, *`trace_id`* é um número de sequência de rastreamento (trace), e *`thread_id`* é o ID do Thread. Por exemplo, no caso de falha de um processo [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") em execução como um Data Node do NDB Cluster com o Node ID 3 e com [`MaxNoOfExecutionThreads`](mysql-cluster-ndbd-definition.html#ndbparam-ndbmtd-maxnoofexecutionthreads) igual a 4, quatro trace files são gerados no diretório de dados do Data Node. Se for a primeira vez que este Node falhou, esses arquivos serão nomeados `ndb_3_trace.log.1_t1`, `ndb_3_trace.log.1_t2`, `ndb_3_trace.log.1_t3` e `ndb_3_trace.log.1_t4`. Internamente, esses trace files seguem o mesmo formato dos trace files do [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon").

Os exit codes e mensagens do [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon") que são gerados quando um processo de Data Node é encerrado prematuramente também são usados pelo [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)"). Consulte [Data Node Error Messages](/doc/ndb-internals/en/ndb-node-error-messages.html), para obter uma lista deles.

Nota

É possível usar o [**ndbd**](mysql-cluster-programs-ndbd.html "21.5.1 ndbd — The NDB Cluster Data Node Daemon") e o [**ndbmtd**](mysql-cluster-programs-ndbmtd.html "21.5.3 ndbmtd — The NDB Cluster Data Node Daemon (Multi-Threaded)") simultaneamente em diferentes Data Nodes no mesmo NDB Cluster. No entanto, tais configurações não foram extensivamente testadas; portanto, não podemos recomendar fazer isso em um ambiente de produção neste momento.