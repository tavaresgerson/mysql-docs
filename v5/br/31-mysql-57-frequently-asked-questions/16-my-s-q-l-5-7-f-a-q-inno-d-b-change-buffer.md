## A.16 MySQL 5.7 FAQ: Change Buffer do InnoDB

A.16.1. [Que tipos de operações modificam Indexes secundários e resultam em buffering de mudanças?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-operations)

A.16.2. [Qual é o benefício do Change Buffer do InnoDB?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-benefits)

A.16.3. [O Change Buffer suporta outros tipos de Indexes?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-index-types)

A.16.4. [Quanto espaço o InnoDB usa para o Change Buffer?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-space-max-size)

A.16.5. [Como eu determino o tamanho atual do Change Buffer?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-current-size)

A.16.6. [Quando ocorre a mesclagem (merging) do Change Buffer?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-merging)

A.16.7. [Quando o Change Buffer é despejado (flushed)?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-flush-time)

A.16.8. [Quando o Change Buffer deve ser usado?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-when-to-enable)

A.16.9. [Quando o Change Buffer não deve ser usado?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-when-to-disable)

A.16.10. [Onde posso encontrar informações adicionais sobre o Change Buffer?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-info)

<table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"/><col/></colgroup><tbody><tr class="question"><td align="left" valign="top"><p><b>A.16.1.</b></p></td><td align="left" valign="top"><p> Que tipos de operações modificam Indexes secundários e resultam em buffering de mudanças? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> As operações <code>INSERT</code>, <code>UPDATE</code> e <code>DELETE</code> podem modificar Indexes secundários. Se uma página de Index afetada não estiver no Buffer Pool, as mudanças podem ser armazenadas em Buffer no Change Buffer. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.2.</b></p></td><td align="left" valign="top"><p> Qual é o benefício do Change Buffer do <code>InnoDB</code>? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> O buffering de mudanças em Indexes secundários, quando as páginas de Index secundário não estão no Buffer Pool, evita operações custosas de I/O de acesso aleatório que seriam necessárias para ler imediatamente as páginas de Index afetadas do disco. As mudanças armazenadas em Buffer podem ser aplicadas posteriormente, em lotes, à medida que as páginas são lidas no Buffer Pool por outras operações de leitura. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.3.</b></p></td><td align="left" valign="top"><p> O Change Buffer suporta outros tipos de Indexes? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Não. O Change Buffer suporta apenas Indexes secundários. Indexes clusterizados, Indexes full-text e Indexes espaciais não são suportados. Os Indexes full-text possuem seu próprio mecanismo de caching. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.4.</b></p></td><td align="left" valign="top"><p> Quanto espaço o <code>InnoDB</code> usa para o Change Buffer? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Antes da introdução da opção de configuração <code>innodb_change_buffer_max_size</code> no MySQL 5.6, o tamanho máximo do Change Buffer em disco (on-disk) no tablespace do sistema era 1/3 do tamanho do Buffer Pool do <code>InnoDB</code>. </p><p> No MySQL 5.6 e posterior, a opção de configuração <code>innodb_change_buffer_max_size</code> define o tamanho máximo do Change Buffer como uma porcentagem do tamanho total do Buffer Pool. Por padrão, <code>innodb_change_buffer_max_size</code> é definido como 25. A configuração máxima é 50. </p><p> O <code>InnoDB</code> não armazena uma operação em Buffer se isso faria com que o Change Buffer em disco excedesse o limite definido. </p><p> Não é obrigatório que as páginas do Change Buffer persistam no Buffer Pool e elas podem ser despejadas por operações LRU. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.5.</b></p></td><td align="left" valign="top"><p> Como eu determino o tamanho atual do Change Buffer? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> O tamanho atual do Change Buffer é reportado por <code>SHOW ENGINE INNODB STATUS \G</code>, sob o cabeçalho <code>INSERT BUFFER AND ADAPTIVE HASH INDEX</code>. Por exemplo: </p><pre class="programlisting copytoclipboard language-none"><code class="language-none">------------------------------------- INSERT BUFFER AND ADAPTIVE HASH INDEX ------------------------------------- Ibuf: size 1, free list len 0, seg size 2, 0 merges</code></pre><p> Os pontos de dados relevantes incluem: </p> <div class="itemizedlist"> <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> <code>size</code>: O número de páginas usadas dentro do Change Buffer. O tamanho do Change Buffer é igual a <code>seg size - (1 + free list len)</code>. O valor <code>1 +</code> representa a página de cabeçalho do Change Buffer (header page). </p></li><li class="listitem"><p> <code>seg size</code>: O tamanho do Change Buffer, em páginas. </p></li></ul> </div> <p> Para obter informações sobre o monitoramento do status do Change Buffer, veja Seção 14.5.2, “Change Buffer”. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.6.</b></p></td><td align="left" valign="top"><p> Quando ocorre a mesclagem (merging) do Change Buffer? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"> <div class="itemizedlist"> <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p> Quando uma página é lida no Buffer Pool, as mudanças armazenadas em Buffer são mescladas após a conclusão da leitura, antes que a página seja disponibilizada. </p></li><li class="listitem"><p> A mesclagem do Change Buffer é realizada como uma tarefa em background. O parâmetro <code>innodb_io_capacity</code> define um limite superior para a atividade de I/O realizada por tarefas em background do <code>InnoDB</code>, como a mesclagem de dados do Change Buffer. </p></li><li class="listitem"><p> Uma mesclagem do Change Buffer é realizada durante a recuperação de falhas (crash recovery). As mudanças são aplicadas do Change Buffer (no tablespace do sistema) para as páginas folha dos Indexes secundários à medida que as páginas de Index são lidas no Buffer Pool. </p></li><li class="listitem"><p> O Change Buffer é totalmente durável e pode sobreviver a uma falha do sistema (system crash). Após a reinicialização, as operações de mesclagem do Change Buffer são retomadas como parte das operações normais. </p></li><li class="listitem"><p> Uma mesclagem completa do Change Buffer pode ser forçada como parte de um desligamento lento do servidor usando <code>--innodb-fast-shutdown=0</code>. </p></li></ul> </div> </td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.7.</b></p></td><td align="left" valign="top"><p> Quando o Change Buffer é despejado (flushed)? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> As páginas atualizadas são despejadas pelo mesmo mecanismo de despejo (flushing mechanism) que despeja as outras páginas que ocupam o Buffer Pool. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.8.</b></p></td><td align="left" valign="top"><p> Quando o Change Buffer deve ser usado? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> O Change Buffer é um recurso projetado para reduzir o I/O aleatório em Indexes secundários, à medida que os Indexes crescem e não cabem mais no Buffer Pool do <code>InnoDB</code>. Geralmente, o Change Buffer deve ser usado quando o conjunto de dados inteiro não cabe no Buffer Pool, quando há atividade DML substancial que modifica as páginas de Index secundário, ou quando há muitos Indexes secundários que são alterados regularmente pela atividade DML. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.9.</b></p></td><td align="left" valign="top"><p> Quando o Change Buffer não deve ser usado? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Você pode considerar desabilitar o Change Buffer se o conjunto de dados inteiro couber no Buffer Pool do <code>InnoDB</code>, se você tiver relativamente poucos Indexes secundários, ou se estiver usando armazenamento de estado sólido (solid-state storage), onde as leituras aleatórias são quase tão rápidas quanto as leituras sequenciais. Antes de fazer alterações na configuração, é recomendado executar testes usando uma workload representativa para determinar se a desativação do Change Buffer oferece algum benefício. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.10.</b></p></td><td align="left" valign="top"><p> Onde posso encontrar informações adicionais sobre o Change Buffer? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Veja Seção 14.5.2, “Change Buffer”. </p></td></tr></tbody></table>