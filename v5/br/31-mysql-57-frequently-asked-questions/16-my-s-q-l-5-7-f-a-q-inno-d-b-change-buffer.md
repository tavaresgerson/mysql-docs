## A.16 Perguntas frequentes sobre o MySQL 5.7: Buffer de alteração InnoDB

A.16.1. [Que tipos de operações modificam índices secundários e resultam no buffer de alterações?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-operations)

A.16.2. [Qual é o benefício do buffer de alteração do InnoDB?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-benefits)

A.16.3. [O buffer de alterações suporta outros tipos de índices?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-index-types)

A.16.4. [Quanto espaço o InnoDB usa para o buffer de alterações?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-space-max-size)

A.16.5. [Como determinar o tamanho atual do buffer de alterações?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-current-size)

A.16.6. [Quando ocorre a junção do buffer de alterações?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-merging)

A.16.7. [Quando o buffer de alterações é esvaziado?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-flush-time)

A.16.8. [Quando o buffer de alterações deve ser usado?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-when-to-enable)

A.16.9. [Quando o buffer de alteração não deve ser usado?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-when-to-disable)

A.16.10. [Onde posso encontrar informações adicionais sobre o buffer de alterações?](faqs-innodb-change-buffer.html#faq-innodb-change-buffer-info)

<table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"/><col/></colgroup><tbody><tr class="question"><td align="left" valign="top"><p><b>A.16.1.</b></p></td><td align="left" valign="top"><p>Que tipos de operações modificam índices secundários e resultam em bufferização de alterações?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>As operações PH_HTML_CODE_<code>SHOW ENGINE INNODB STATUS \G</code>], PH_HTML_CODE_<code>SHOW ENGINE INNODB STATUS \G</code>] e PH_HTML_CODE_<code class="language-none">------------------------------------- INSERT BUFFER AND ADAPTIVE HASH INDEX ------------------------------------- Ibuf: size 1, free list len 0, seg size 2, 0 merges</code>] podem modificar índices secundários. Se uma página de índice afetada não estiver no buffer pool, as alterações podem ser armazenadas no buffer de alterações.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.2.</b></p></td><td align="left" valign="top"><p>Qual é o benefício do buffer de alteração PH_HTML_CODE_<code>size</code>]?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>O bufferamento das mudanças no índice secundário, quando as páginas do índice secundário não estão no pool de buffer, evita operações de E/S de acesso aleatório caras que seriam necessárias para ler imediatamente as páginas do índice afetadas do disco. As mudanças bufferadas podem ser aplicadas posteriormente, em lotes, à medida que as páginas são lidas para o pool de buffer por outras operações de leitura.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.3.</b></p></td><td align="left" valign="top"><p>O buffer de alterações suporta outros tipos de índices?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Não. O buffer de alterações só suporta índices secundários. Índices agrupados, índices de texto completo e índices espaciais não são suportados. Os índices de texto completo têm seu próprio mecanismo de cache.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.4.</b></p></td><td align="left" valign="top"><p>Quanto espaço o PH_HTML_CODE_<code>seg size - (1 + free list len)</code>] usa para o buffer de alteração?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Antes da introdução doPH_HTML_CODE_<code>1 +</code>]Uma opção de configuração no MySQL 5.6, o tamanho máximo do buffer de alterações no disco no espaço de tabela do sistema era de 1/3 do tamanho do pool de buffers PH_HTML_CODE_<code>seg size</code>].</p><p>Em MySQL 5.6 e versões posteriores, oPH_HTML_CODE_<code>innodb_io_capacity</code>]A opção de configuração define o tamanho máximo do buffer de alterações como uma porcentagem do tamanho total do pool de buffers. Por padrão,PH_HTML_CODE_<code>InnoDB</code>]O valor padrão é 25. O valor máximo é 50.</p><p>PH_HTML_CODE_<code>--innodb-fast-shutdown=0</code>] não armazena uma operação se isso causar que o buffer de mudança no disco exceda o limite definido.</p><p>As páginas de buffer de alteração não são necessárias para persistir no pool de buffer e podem ser expulsas por operações LRU.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.5.</b></p></td><td align="left" valign="top"><p>Como posso determinar o tamanho atual do buffer de alterações?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>O tamanho atual do buffer de alterações é relatado por <code>SHOW ENGINE INNODB STATUS \G</code>, sob o título <code>UPDATE</code><code>SHOW ENGINE INNODB STATUS \G</code>]. Por exemplo:</p><pre class="programlisting copytoclipboard language-none"><code class="language-none">------------------------------------- INSERT BUFFER AND ADAPTIVE HASH INDEX ------------------------------------- Ibuf: size 1, free list len 0, seg size 2, 0 merges</code></pre><p>Os pontos de dados relevantes incluem:</p> <div class="itemizedlist"> <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><code>size</code>: O número de páginas usadas dentro do buffer de alterações. O tamanho do buffer de alterações é igual a <code>seg size - (1 + free list len)</code>. O valor <code>1 +</code> representa a página de cabeçalho do buffer de alterações.</p></li><li class="listitem"><p><code>seg size</code>: O tamanho do buffer de alteração, em páginas.</p></li></ul> </div> <p>Para obter informações sobre o monitoramento do status do buffer de alterações, consulteSeção 14.5.2, “Buffer de Alteração”.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.6.</b></p></td><td align="left" valign="top"><p>Quando ocorre a junção do buffer de mudança?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"> <div class="itemizedlist"> <ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Quando uma página é lida no pool de buffer, as alterações em buffer são mescladas após a conclusão da leitura, antes de a página ser disponibilizada.</p></li><li class="listitem"><p>A fusão de buffers é realizada como uma tarefa em segundo plano. O<code>innodb_io_capacity</code>O parâmetro define um limite superior para a atividade de E/S realizada pelas tarefas de segundo plano <code>InnoDB</code> como a fusão de dados do buffer de alterações.</p></li><li class="listitem"><p>Uma fusão de buffer de alterações é realizada durante a recuperação de falhas. As alterações são aplicadas do buffer de alterações (no espaço de tabela do sistema) para as páginas de folha de índices secundários, à medida que as páginas de índice são lidas no pool de buffer.</p></li><li class="listitem"><p>O buffer de alterações é totalmente durável e pode sobreviver a um crash do sistema. Após o reinício, as operações de fusão do buffer de alterações são retomadas como parte das operações normais.</p></li><li class="listitem"><p>Uma fusão completa do buffer de alterações pode ser forçada como parte de um desligamento lento do servidor usando<code>--innodb-fast-shutdown=0</code>.</p></li></ul> </div> </td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.7.</b></p></td><td align="left" valign="top"><p>Quando o buffer de mudança é esvaziado?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>As páginas atualizadas são descarregadas pelo mesmo mecanismo de descarregamento que descarrega as outras páginas que ocupam o pool de buffer.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.8.</b></p></td><td align="left" valign="top"><p>Quando o buffer de mudança deve ser usado?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>O buffer de alterações é uma funcionalidade projetada para reduzir o acesso aleatório a índices secundários à medida que esses índices aumentam de tamanho e não cabem mais no pool de buffer <code>DELETE</code><code>SHOW ENGINE INNODB STATUS \G</code>]. Geralmente, o buffer de alterações deve ser usado quando todo o conjunto de dados não cabe no pool de buffer, quando há uma atividade DML substancial que modifica páginas de índices secundários ou quando há muitos índices secundários que são alterados regularmente pela atividade DML.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.9.</b></p></td><td align="left" valign="top"><p>Quando o buffer de mudança não deve ser usado?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Você pode considerar desativar o buffer de alterações se o conjunto de dados inteiro cabe no pool de buffers <code>DELETE</code><code>SHOW ENGINE INNODB STATUS \G</code>], se você tiver poucos índices secundários ou se estiver usando armazenamento em estado sólido, onde as leituras aleatórias são tão rápidas quanto as leituras sequenciais. Antes de fazer alterações na configuração, é recomendável executar testes com uma carga de trabalho representativa para determinar se a desativação do buffer de alterações oferece algum benefício.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.16.10.</b></p></td><td align="left" valign="top"><p>Onde posso encontrar informações adicionais sobre o buffer de mudança?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>VejaSeção 14.5.2, “Buffer de Alteração”.</p></td></tr></tbody></table>
