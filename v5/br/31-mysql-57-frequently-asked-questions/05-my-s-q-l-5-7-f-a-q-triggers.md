## A.5 Perguntas frequentes sobre o MySQL 5.7: gatilhos

A.5.1. [Onde posso encontrar a documentação para gatilhos do MySQL 5.7?](faqs-triggers.html#faq-mysql-onde-os-gatilhos-estao-documentados)

A.5.2. [Há um fórum de discussão para gatilhos MySQL?](faqs-triggers.html#faq-mysql-onde-está-o-fórum-de-gatilhos)

A.5.3. [O MySQL tem gatilhos de nível de declaração ou de nível de linha?](faqs-triggers.html#faq-mysql-have-trigger-levels)

A.5.4. [Existem gatilhos padrão?](faqs-triggers.html#faq-mysql-have-trigger-defaults)

A.5.5. [Como os gatilhos são gerenciados no MySQL?](faqs-triggers.html#faq-mysql-como-os-gatilhos-sao-gerenciados)

A.5.6. [Existe uma maneira de visualizar todos os gatilhos em um banco de dados específico?](faqs-triggers.html#faq-mysql-pode-visualizar-todos-os-gatilhos)

A.5.7. [Onde os gatilhos são armazenados?](faqs-triggers.html#faq-mysql-como-os-gatilhos-sao-armazenados)

A.5.8. [Um gatilho pode chamar um procedimento armazenado?](faqs-triggers.html#faq-mysql-can-trigger-procedure)

A.5.9. [Os gatilhos podem acessar tabelas?](faqs-triggers.html#faq-mysql-can-triggers-tables)

A.5.10. [Uma tabela pode ter múltiplos gatilhos com o mesmo evento de gatilho e hora de ação?](faqs-triggers.html#faq-mysql-can-triggers-same-events)

A.5.11. [É possível que um gatilho atualize tabelas em um servidor remoto?](faqs-triggers.html#faq-mysql-can-triggers-remote)

A.5.12. [Os gatilhos funcionam com replicação?](faqs-triggers.html#faq-mysql-can-triggers-replication)

A.5.13. [Como as ações realizadas por gatilhos em uma fonte são replicadas para uma réplica?](faqs-triggers.html#faq-mysql-como-triggers-fonte-replica)

<table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"/><col/></colgroup><tbody><tr class="question"><td align="left" valign="top"><p><b>A.5.1.</b></p></td><td align="left" valign="top"><p>Onde posso encontrar a documentação para gatilhos do MySQL 5.7?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>VejaSeção 23.3, “Usando gatilhos”.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.2.</b></p></td><td align="left" valign="top"><p>Há um fórum de discussão para gatilhos MySQL?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Sim. Está disponível emhttps://forums.mysql.com/list.php?99.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.3.</b></p></td><td align="left" valign="top"><p>O MySQL tem gatilhos de nível de declaração ou de nível de linha?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Todos os gatilhos são PH_HTML_CODE_<code>SHOW TRIGGERS</code>]; ou seja, o gatilho é ativado para cada linha inserida, atualizada ou excluída. O MySQL não suporta gatilhos usando PH_HTML_CODE_<code>SHOW TRIGGERS</code>].</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.4.</b></p></td><td align="left" valign="top"><p>Existem algum gatilho padrão?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Não explicitamente. O MySQL tem um comportamento especial específico para algunsPH_HTML_CODE_<code>BEFORE UPDATE</code>]colunas, bem como para colunas que são definidas usando PH_HTML_CODE_<code>FOR EACH ROW</code>].</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.5.</b></p></td><td align="left" valign="top"><p>Como os gatilhos são gerenciados no MySQL?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Os gatilhos podem ser criados usando oPH_HTML_CODE_<code>FOLLOWS</code>]declaração, e foi descartada a utilização dePH_HTML_CODE_<code>PRECEDES</code>]VejaSeção 13.1.20, “Instrução CREATE TRIGGER”, eSeção 13.1.31, “Declaração DROP TRIGGER”Para saber mais sobre essas declarações.</p><p>Informações sobre os gatilhos podem ser obtidas consultando oPH_HTML_CODE_<code>FOLLOWS</code>]Veja a tabela.Seção 24.3.29, “A tabela INFORMATION_SCHEMA TRIGGERS”.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.6.</b></p></td><td align="left" valign="top"><p>Existe uma maneira de visualizar todos os gatilhos em um banco de dados específico?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Sim. Você pode obter uma lista de todos os gatilhos definidos no banco de dados PH_HTML_CODE_<code>PRECEDES</code>] usando uma consulta noPH_HTML_CODE_<code>FEDERATED</code>]uma tabela como a mostrada aqui:</p><pre class="programlisting copytoclipboard language-sql">PH_HTML_CODE_<code>EMP</code>]</pre><p>Para mais informações sobre esta tabela, consulteSeção 24.3.29, “A tabela INFORMATION_SCHEMA TRIGGERS”.</p><p>Você também pode usar o<code>SHOW TRIGGERS</code>Esta é uma declaração específica para o MySQL. VejaSeção 13.7.5.38, “Declaração de TRIGGERS SHOW”.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.7.</b></p></td><td align="left" valign="top"><p>Onde os gatilhos são armazenados?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Os gatilhos são armazenados em arquivos <code>FOR EACH STATEMENT</code><code>SHOW TRIGGERS</code>], com um arquivo por tabela.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.8.</b></p></td><td align="left" valign="top"><p>Um gatilho pode chamar um procedimento armazenado?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Sim.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.9.</b></p></td><td align="left" valign="top"><p>Os gatilhos podem acessar tabelas?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Um gatilho pode acessar dados antigos e novos em sua própria tabela. Um gatilho também pode afetar outras tabelas, mas não é permitido modificar uma tabela que já esteja sendo usada (para leitura ou escrita) pela instrução que invocou a função ou o gatilho.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.10.</b></p></td><td align="left" valign="top"><p>Uma tabela pode ter múltiplos gatilhos com o mesmo evento de gatilho e hora de ação?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>É possível definir múltiplos gatilhos para uma tabela que tenham o mesmo evento de gatilho e hora de ação. Por exemplo, você pode ter dois gatilhos <code>BEFORE UPDATE</code> para uma tabela. Por padrão, os gatilhos que têm o mesmo evento de gatilho e hora de ação são ativados na ordem em que foram criados. Para alterar a ordem dos gatilhos, especifique uma cláusula após <code>FOR EACH ROW</code> que indique <code>FOLLOWS</code> ou <code>PRECEDES</code> e o nome de um gatilho existente que também tenha o mesmo evento de gatilho e hora de ação. Com <code>FOLLOWS</code>, o novo gatilho é ativado após o gatilho existente. Com <code>PRECEDES</code>, o novo gatilho é ativado antes do gatilho existente.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.11.</b></p></td><td align="left" valign="top"><p>É possível que um gatilho atualize tabelas em um servidor remoto?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Sim. Uma tabela em um servidor remoto pode ser atualizada usando o mecanismo de armazenamento <code>FEDERATED</code>. (VejaSeção 15.8, “O Motor de Armazenamento FEDERATED”).</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.12.</b></p></td><td align="left" valign="top"><p>Os gatilhos funcionam com replicação?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Sim. No entanto, a forma como elas funcionam depende se você está usando o MySQL ou<span class="quote">“<span class="quote">clássico</span>”</span>formato de replicação baseado em declarações ou baseado em linhas.</p><p>Ao usar a replicação baseada em declarações, os gatilhos na replica são executados por declarações que são executadas na fonte (e replicadas para a replica).</p><p>Ao usar a replicação baseada em linhas, os gatilhos não são executados na replica devido a instruções que foram executadas na fonte e depois replicadas para a replica. Em vez disso, ao usar a replicação baseada em linhas, as alterações causadas pela execução do gatilho na fonte são aplicadas na replica.</p><p>Para mais informações, consulteSeção 16.4.1.34, “Replicação e gatilhos”.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.5.13.</b></p></td><td align="left" valign="top"><p>Como as ações realizadas por meio de gatilhos em uma fonte são replicadas para uma réplica?</p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p>Novamente, isso depende se você está usando replicação baseada em declarações ou baseada em linhas.</p><p><b>Replicação baseada em declarações.</b>Primeiro, os gatilhos existentes em uma fonte devem ser recriados no servidor de replicação. Uma vez feito isso, o fluxo de replicação funciona como qualquer outra declaração DML padrão que participa da replicação. Por exemplo, considere uma tabela <code>EMP</code> que tem um gatilho de inserção <code>TIMESTAMP</code><code>SHOW TRIGGERS</code>], que existe em um servidor de fonte de replicação. A mesma tabela <code>TIMESTAMP</code><code>SHOW TRIGGERS</code>] e o gatilho de inserção <code>TIMESTAMP</code><code>BEFORE UPDATE</code>] existem também no servidor de replicação. O fluxo de replicação seria:</p> <div class="orderedlist"> <ol class="orderedlist" type="1"><li class="listitem"><p>Um<code>TIMESTAMP</code><code>FOR EACH ROW</code>]A declaração é feita para <code>TIMESTAMP</code><code>FOLLOWS</code>].</p></li><li class="listitem"><p>O gatilho <code>TIMESTAMP</code><code>PRECEDES</code>] em <code>TIMESTAMP</code><code>FOLLOWS</code>] é ativado.</p></li><li class="listitem"><p>O<code>TIMESTAMP</code><code>PRECEDES</code>]Essa declaração é escrita no log binário.</p></li><li class="listitem"><p>A réplica pega o<code>TIMESTAMP</code><code>FEDERATED</code>]declaração para <code>TIMESTAMP</code><code>EMP</code>] e executa-a.</p></li><li class="listitem"><p>O gatilho <code>AUTO_INCREMENT</code><code>SHOW TRIGGERS</code>] em <code>AUTO_INCREMENT</code><code>SHOW TRIGGERS</code>] que existe na replica é ativado.</p></li></ol> </div> <p><b>Replicação baseada em linhas.</b>Quando você usa a replicação baseada em linhas, as alterações causadas pela execução do gatilho na fonte são aplicadas na replica. No entanto, os próprios gatilhos não são realmente executados na replica na replicação baseada em linhas. Isso ocorre porque, se tanto a fonte quanto a replica aplicaram as alterações da fonte e, além disso, o gatilho que causou essas alterações foi aplicado na replica, as alterações seriam aplicadas duas vezes na replica, levando a dados diferentes na fonte e na replica.</p><p>Na maioria dos casos, o resultado é o mesmo para a replicação baseada em linhas e a baseada em declarações. No entanto, se você usar gatilhos diferentes na fonte e na replica, não poderá usar a replicação baseada em linhas. (Isso ocorre porque o formato baseado em linhas replica as alterações feitas pelos gatilhos que executam na fonte para as réplicas, em vez das declarações que causaram a execução dos gatilhos, e os gatilhos correspondentes na replica não são executados.) Em vez disso, quaisquer declarações que causem a execução desses gatilhos devem ser replicadas usando a replicação baseada em declarações.</p><p>Para mais informações, consulteSeção 16.4.1.34, “Replicação e gatilhos”.</p></td></tr></tbody></table>
