## A.4 FAQ do MySQL 5.7: Stored Procedures e Functions

A.4.1. [O MySQL oferece suporte a stored procedures e functions?](faqs-stored-procs.html#faq-mysql-have-procedures-functions)

A.4.2. [Onde posso encontrar documentação para stored procedures e stored functions do MySQL?](faqs-stored-procs.html#faq-mysql-where-procedures-functions-docs)

A.4.3. [Existe um fórum de discussão para stored procedures do MySQL?](faqs-stored-procs.html#faq-mysql-where-procedures-forum)

A.4.4. [Onde posso encontrar a especificação ANSI SQL 2003 para stored procedures?](faqs-stored-procs.html#faq-mysql-where-ansi-2003-spec)

A.4.5. [Como você gerencia stored routines?](faqs-stored-procs.html#faq-mysql-how-manage-routines)

A.4.6. [Existe uma maneira de visualizar todas as stored procedures e stored functions em um dado Database?](faqs-stored-procs.html#faq-mysql-how-view-procedures-functions)

A.4.7. [Onde as stored procedures são armazenadas?](faqs-stored-procs.html#faq-mysql-where-procedures-stored)

A.4.8. [É possível agrupar stored procedures ou stored functions em packages?](faqs-stored-procs.html#faq-mysql-how-group-procedures-functions)

A.4.9. [Uma stored procedure pode chamar outra stored procedure?](faqs-stored-procs.html#faq-mysql-can-procedure-call-procedure)

A.4.10. [Uma stored procedure pode chamar um Trigger?](faqs-stored-procs.html#faq-mysql-can-procedure-call-trigger)

A.4.11. [Uma stored procedure pode acessar tables?](faqs-stored-procs.html#faq-mysql-can-procedure-access-table)

A.4.12. [Stored procedures possuem um Statement para levantar erros de aplicação?](faqs-stored-procs.html#faq-mysql-can-procedure-raise-error)

A.4.13. [Stored procedures fornecem tratamento de exceções (exception handling)?](faqs-stored-procs.html#faq-mysql-have-exceptions)

A.4.14. [As stored routines do MySQL podem retornar result sets?](faqs-stored-procs.html#faq-mysql-can-routine-results)

A.4.15. [O `WITH RECOMPILE` é suportado para stored procedures?](faqs-stored-procs.html#faq-mysql-have-with-recompile)

A.4.16. [Existe um equivalente no MySQL ao uso de `mod_plsql` como um gateway no Apache para se comunicar diretamente com uma stored procedure no Database?](faqs-stored-procs.html#faq-mysql-have-mod-plsql)

A.4.17. [Posso passar um array como input para uma stored procedure?](faqs-stored-procs.html#faq-mysql-can-procedure-array)

A.4.18. [Posso passar um Cursor como parâmetro `IN` para uma stored procedure?](faqs-stored-procs.html#faq-mysql-can-pass-cursor-in)

A.4.19. [Posso retornar um Cursor como parâmetro `OUT` de uma stored procedure?](faqs-stored-procs.html#faq-mysql-can-return-cursor-out)

A.4.20. [Posso imprimir o valor de uma variável dentro de uma stored routine para fins de debugging?](faqs-stored-procs.html#faq-mysql-can-print-var-in-procedure)

A.4.21. [Posso fazer COMMIT ou ROLLBACK de transactions dentro de uma stored procedure?](faqs-stored-procs.html#faq-mysql-can-rollback-transaction-procedure)

A.4.22. [Stored procedures e functions do MySQL funcionam com replication?](faqs-stored-procs.html#faq-mysql-can-procedures-replicatation)

A.4.23. [Stored procedures e functions criadas em um replication source server são replicadas para uma replica?](faqs-stored-procs.html#faq-mysql-are-procedures-replicated)

A.4.24. [Como as ações que ocorrem dentro de stored procedures e functions são replicadas?](faqs-stored-procs.html#faq-mysql-how-procedures-replicated)

A.4.25. [Existem requisitos de segurança especiais para usar stored procedures e functions juntamente com replication?](faqs-stored-procs.html#faq-mysql-security-procedures-replication)

A.4.26. [Quais limitações existem para replicar ações de stored procedures e functions?](faqs-stored-procs.html#faq-mysql-limitations-procedures-replication)

A.4.27. [As limitações anteriores afetam a capacidade do MySQL de realizar point-in-time recovery?](faqs-stored-procs.html#faq-mysql-limitations-pit-recovery)

A.4.28. [O que está sendo feito para corrigir as limitações mencionadas?](faqs-stored-procs.html#faq-mysql-when-limitations-resolved)

<table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"/><col/></colgroup><tbody><tr class="question"><td align="left" valign="top"><p><b>A.4.1.</b></p></td><td align="left" valign="top"><p> O MySQL oferece suporte a stored procedures e functions? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim. O MySQL suporta dois tipos de stored routines: stored procedures e stored functions. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.2.</b></p></td><td align="left" valign="top"><p> Onde posso encontrar documentação para stored procedures e stored functions do MySQL? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Consulte a Seção 23.2, “Usando Stored Routines”. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.3.</b></p></td><td align="left" valign="top"><p> Existe um fórum de discussão para stored procedures do MySQL? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim. Consulte https://forums.mysql.com/list.php?98. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.4.</b></p></td><td align="left" valign="top"><p> Onde posso encontrar a especificação ANSI SQL 2003 para stored procedures? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Infelizmente, as especificações oficiais não estão disponíveis gratuitamente (a ANSI as disponibiliza para compra). No entanto, existem livros, como <em class="citetitle">SQL-99 Complete, Really</em> de Peter Gulutzan e Trudy Pelzer, que fornecem uma visão geral abrangente do padrão, incluindo cobertura de stored procedures. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.5.</b></p></td><td align="left" valign="top"><p> Como você gerencia stored routines? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> É sempre uma boa prática usar um esquema de nomenclatura claro para suas stored routines. Você pode gerenciar stored procedures com <code>CREATE [FUNCTION|PROCEDURE]</code>, <code>ALTER [FUNCTION|PROCEDURE]</code>, <code>DROP [FUNCTION|PROCEDURE]</code> e <code>SHOW CREATE [FUNCTION|PROCEDURE]</code>. Você pode obter informações sobre stored procedures existentes usando a tabela <code>ROUTINES</code> no <code>INFORMATION_SCHEMA Database</code> (consulte a Seção 24.3.21, “The INFORMATION_SCHEMA ROUTINES Table”). </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.6.</b></p></td><td align="left" valign="top"><p> Existe uma maneira de visualizar todas as stored procedures e stored functions em um dado Database? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim. Para um Database chamado <em><code>dbname</code></em>, use esta Query na tabela <code>INFORMATION_SCHEMA.ROUTINES</code>: </p><pre class="programlisting copytoclipboard language-sql"><code class="language-sql">SELECT ROUTINE_TYPE, ROUTINE_NAME FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_SCHEMA='<em>dbname</em>';</code></pre><p> Para mais informações, consulte a Seção 24.3.21, “The INFORMATION_SCHEMA ROUTINES Table”. </p><p> O corpo de uma stored routine pode ser visualizado usando <code>SHOW CREATE FUNCTION</code> (para uma stored function) ou <code>SHOW CREATE PROCEDURE</code> (para uma stored procedure). Consulte a Seção 13.7.5.9, “SHOW CREATE PROCEDURE Statement”, para mais informações. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.7.</b></p></td><td align="left" valign="top"><p> Onde as stored procedures são armazenadas? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Na tabela <code>proc</code> do <code>mysql</code> system Database. No entanto, você não deve acessar as tabelas no system Database diretamente. Em vez disso, consulte as tabelas <code>ROUTINES</code> e <code>PARAMETERS</code> do <code>INFORMATION_SCHEMA</code>. Consulte a Seção 24.3.21, “The INFORMATION_SCHEMA ROUTINES Table”, e a Seção 24.3.15, “The INFORMATION_SCHEMA PARAMETERS Table”. </p><p> Você também pode usar <code>SHOW CREATE FUNCTION</code> para obter informações sobre stored functions, e <code>SHOW CREATE PROCEDURE</code> para obter informações sobre stored procedures. Consulte a Seção 13.7.5.9, “SHOW CREATE PROCEDURE Statement”. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.8.</b></p></td><td align="left" valign="top"><p> É possível agrupar stored procedures ou stored functions em packages? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Não. Isso não é suportado no MySQL. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.9.</b></p></td><td align="left" valign="top"><p> Uma stored procedure pode chamar outra stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.10.</b></p></td><td align="left" valign="top"><p> Uma stored procedure pode chamar um Trigger? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Uma stored procedure pode executar um Statement SQL, como um <code>UPDATE</code>, que faz com que um Trigger seja ativado. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.11.</b></p></td><td align="left" valign="top"><p> Uma stored procedure pode acessar tables? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim. Uma stored procedure pode acessar uma ou mais tables conforme necessário. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.12.</b></p></td><td align="left" valign="top"><p> Stored procedures possuem um Statement para levantar erros de aplicação? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim. O MySQL implementa os Statements padrão SQL <code>SIGNAL</code> e <code>RESIGNAL</code>. Consulte a Seção 13.6.7, “Condition Handling”. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.13.</b></p></td><td align="left" valign="top"><p> Stored procedures fornecem tratamento de exceções (exception handling)? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> O MySQL implementa definições de <code>HANDLER</code> de acordo com o padrão SQL. Consulte a Seção 13.6.7.2, “DECLARE ... HANDLER Statement”, para detalhes. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.14.</b></p></td><td align="left" valign="top"><p> As stored routines do MySQL podem retornar result sets? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> <span><em>Stored procedures</em></span> podem, mas stored functions não. Se você executar um <code>SELECT</code> comum dentro de uma stored procedure, o result set é retornado diretamente ao cliente. Você precisa usar o protocolo cliente/servidor MySQL 4.1 (ou superior) para que isso funcione. Isso significa que, por exemplo, em PHP, você precisa usar a extensão <code>mysqli</code> em vez da antiga extensão <code>mysql</code>. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.15.</b></p></td><td align="left" valign="top"><p> O <code>WITH RECOMPILE</code> é suportado para stored procedures? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Não. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.16.</b></p></td><td align="left" valign="top"><p> Existe um equivalente no MySQL ao uso de <code>mod_plsql</code> como um gateway no Apache para se comunicar diretamente com uma stored procedure no Database? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Não há equivalente no MySQL. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.17.</b></p></td><td align="left" valign="top"><p> Posso passar um array como input para uma stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Não. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.18.</b></p></td><td align="left" valign="top"><p> Posso passar um Cursor como parâmetro <code>IN</code> para uma stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Cursors estão disponíveis apenas dentro de stored procedures. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.19.</b></p></td><td align="left" valign="top"><p> Posso retornar um Cursor como parâmetro <code>OUT</code> de uma stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Cursors estão disponíveis apenas dentro de stored procedures. No entanto, se você não abrir um Cursor em um <code>SELECT</code>, o resultado é enviado diretamente ao cliente. Você também pode usar <code>SELECT INTO</code> para variáveis. Consulte a Seção 13.2.9, “SELECT Statement”. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.20.</b></p></td><td align="left" valign="top"><p> Posso imprimir o valor de uma variável dentro de uma stored routine para fins de debugging? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim, você pode fazer isso em uma <span><em>stored procedure</em></span>, mas não em uma stored function. Se você executar um <code>SELECT</code> comum dentro de uma stored procedure, o result set é retornado diretamente ao cliente. Você deve usar o protocolo cliente/servidor MySQL 4.1 (ou superior) para que isso funcione. Isso significa que, por exemplo, em PHP, você precisa usar a extensão <code>mysqli</code> em vez da antiga extensão <code>mysql</code>. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.21.</b></p></td><td align="left" valign="top"><p> Posso fazer COMMIT ou ROLLBACK de transactions dentro de uma stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim. No entanto, você não pode realizar operações transacionais dentro de uma stored function. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.22.</b></p></td><td align="left" valign="top"><p> Stored procedures e functions do MySQL funcionam com replication? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim, ações padrão realizadas em stored procedures e functions são replicadas de um replication source server para uma replica. Existem algumas limitações que são descritas em detalhes na Seção 23.7, “Stored Program Binary Logging”. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.23.</b></p></td><td align="left" valign="top"><p> Stored procedures e functions criadas em um replication source server são replicadas para uma replica? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim, a criação de stored procedures e functions realizada através de Statements DDL normais em um replication source server é replicada para uma replica, de modo que os objetos existam em ambos os servers. Statements <code>ALTER</code> e <code>DROP</code> para stored procedures e functions também são replicados. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.24.</b></p></td><td align="left" valign="top"><p> Como as ações que ocorrem dentro de stored procedures e functions são replicadas? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> O MySQL registra cada evento DML que ocorre em uma stored procedure e replica essas ações individuais para uma replica. As chamadas reais feitas para executar stored procedures não são replicadas. Stored functions que alteram dados são registradas como invocações de função, e não como os eventos DML que ocorrem dentro de cada function. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.25.</b></p></td><td align="left" valign="top"><p> Existem requisitos de segurança especiais para usar stored procedures e functions juntamente com replication? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim. Como uma replica tem autoridade para executar qualquer Statement lido do binary log de uma source, existem restrições de segurança especiais para o uso de stored functions com replication. Se a replication ou o binary logging em geral (para fins de point-in-time recovery) estiver ativo, os DBAs do MySQL têm duas opções de segurança disponíveis: </p> <div class="orderedlist"> <ol class="orderedlist" type="1"><li class="listitem"><p> Qualquer usuário que deseje criar stored functions deve receber o privilégio <code>SUPER</code>. </p></li><li class="listitem"><p> Alternativamente, um DBA pode definir a variável de sistema <code>log_bin_trust_function_creators</code> para 1, o que permite que qualquer pessoa com o privilégio padrão <code>CREATE ROUTINE</code> crie stored functions. </p></li></ol> </div> <p> </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.26.</b></p></td><td align="left" valign="top"><p> Que limitações existem para replicar ações de stored procedures e functions? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Ações não determinísticas (aleatórias) ou baseadas em tempo incorporadas em stored procedures podem não ser replicadas adequadamente. Pela sua própria natureza, os resultados produzidos aleatoriamente não são previsíveis e não podem ser reproduzidos exatamente; portanto, ações aleatórias replicadas para uma replica não espelham aquelas executadas em uma source. Declarar stored functions como <code>DETERMINISTIC</code> ou definir a variável de sistema <code>log_bin_trust_function_creators</code> como 0 impede que operações aleatórias que produzem valores aleatórios sejam invocadas. </p><p> Além disso, ações baseadas em tempo não podem ser reproduzidas em uma replica porque o *timing* dessas ações em uma stored procedure não é reproduzível através do binary log usado para replication. Ele registra apenas eventos DML e não considera restrições de tempo. </p><p> Finalmente, tabelas não transacionais para as quais ocorrem erros durante grandes ações DML (como *bulk inserts*) podem enfrentar problemas de replication, pois uma source pode ser parcialmente atualizada pela atividade DML, mas nenhuma atualização é feita na replica devido aos erros ocorridos. Uma solução alternativa é que as ações DML de uma function sejam executadas com a palavra-chave <code>IGNORE</code>, para que as atualizações na source que causem erros sejam ignoradas e as atualizações que não causem erros sejam replicadas para a replica. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.27.</b></p></td><td align="left" valign="top"><p> As limitações anteriores afetam a capacidade do MySQL de realizar point-in-time recovery? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> As mesmas limitações que afetam a replication também afetam o point-in-time recovery. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.28.</b></p></td><td align="left" valign="top"><p> O que está sendo feito para corrigir as limitações mencionadas? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Você pode escolher entre statement-based replication ou row-based replication. A implementação original da replication é baseada em statement-based binary logging. O row-based binary logging resolve as limitações mencionadas anteriormente. </p><p> A replication <span class="firstterm">Mixed</span> também está disponível (iniciando o server com <code>--binlog-format=mixed</code>). Esta forma híbrida de replication "sabe" se a replication em nível de Statement pode ser usada com segurança, ou se a replication em nível de row é necessária. </p><p> Para informações adicionais, consulte a Seção 16.2.1, “Replication Formats”. </p></td></tr></tbody></table>