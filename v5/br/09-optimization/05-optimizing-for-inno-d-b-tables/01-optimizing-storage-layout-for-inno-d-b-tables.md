### 8.5.1 Otimizando o Layout de Armazenamento para Tabelas InnoDB

- Quando seus dados atingem um tamanho estável ou uma tabela em crescimento tiver aumentado em dezenas ou algumas centenas de megabytes, considere usar a instrução `OPTIMIZE TABLE` para reorganizar a tabela e compactar qualquer espaço desperdiçado. As tabelas reorganizadas exigem menos I/O de disco para realizar varreduras completas da tabela. Essa é uma técnica simples que pode melhorar o desempenho quando outras técnicas, como a melhoria do uso de índices ou o ajuste do código do aplicativo, não são práticas.

  A opção `OPTIMIZE TABLE` copia a parte de dados da tabela e reconstrui os índices. Os benefícios vêm da melhor compactação dos dados dentro dos índices e da redução da fragmentação dentro dos espaços de tabela e no disco. Os benefícios variam dependendo dos dados de cada tabela. Você pode perceber que há ganhos significativos para alguns e não para outros, ou que os ganhos diminuem com o tempo até que você otimize a tabela novamente. Essa operação pode ser lenta se a tabela for grande ou se os índices em reconstrução não cabem no pool de buffers. A primeira execução após adicionar muitos dados a uma tabela é geralmente muito mais lenta do que as execuções posteriores.

- No `InnoDB`, ter um `PRIMARY KEY` longo (uma única coluna com um valor extenso ou várias colunas que formam um valor composto longo) desperdiça muito espaço em disco. O valor da chave primária de uma linha é duplicado em todos os registros de índice secundário que apontam para a mesma linha. (Veja a Seção 14.6.2.1, “Indekses Agrupados e Secundários”.) Crie uma coluna `AUTO_INCREMENT` como chave primária se sua chave primária for longa ou inicie um prefixo de uma coluna `VARCHAR` longa em vez de toda a coluna.

- Use o tipo de dados `VARCHAR` em vez de `CHAR` para armazenar strings de comprimento variável ou para colunas com muitos valores `NULL`. Uma coluna `CHAR(N)` sempre armazena *`N`* caracteres para dados, mesmo que a string seja mais curta ou seu valor seja `NULL`. Tabelas menores se encaixam melhor no pool de buffer e reduzem o I/O no disco.

  Ao usar o formato de linha `COMPACT` (o formato padrão do `InnoDB`) e conjuntos de caracteres de comprimento variável, como `utf8` ou `sjis`, as colunas `CHAR(N)` ocupam uma quantidade variável de espaço, mas ainda pelo menos *`N`* bytes.

- Para tabelas grandes ou que contenham muitos dados de texto ou números repetitivos, considere usar o formato de linha `COMPRESSED`. Menos I/O de disco é necessário para carregar dados no pool de buffer ou para realizar varreduras completas da tabela. Antes de tomar uma decisão definitiva, meça a quantidade de compressão que pode ser alcançada usando o formato de linha `COMPRESSED` em comparação com o formato de linha `COMPACT`.
