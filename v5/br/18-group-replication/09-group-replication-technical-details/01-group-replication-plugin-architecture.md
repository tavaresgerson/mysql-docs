### 17.9.1 Arquitetura do Plugin Group Replication

O MySQL Group Replication é um plugin do MySQL e se baseia na infraestrutura de replication existente do MySQL, aproveitando recursos como o binary log, o logging baseado em linha (row-based logging) e identificadores globais de Transaction. Ele se integra com os frameworks atuais do MySQL, como o performance schema ou as infraestruturas de plugin e serviço. A figura a seguir apresenta um block diagram que descreve a arquitetura geral do MySQL Group Replication.

**Figura 17.9 Block Diagram do Plugin Group Replication**

![O texto que segue a figura descreve o conteúdo do diagrama.](images/gr-plugin-blocks.png)

O plugin MySQL Group Replication inclui um conjunto de APIs para capture, apply e lifecycle, que controlam como o plugin interage com o MySQL Server. Existem interfaces para fazer com que a informação flua do server para o plugin e vice-versa. Essas interfaces isolam o core do MySQL Server do plugin Group Replication e são majoritariamente hooks posicionados na transaction execution pipeline. Em uma direção, do server para o plugin, há notifications para eventos como o server iniciando, o server recuperando, o server estando pronto para aceitar conexões e o server estando prestes a commit uma Transaction. Na outra direção, o plugin instrui o server a realizar ações como commit ou abort de transactions em andamento, ou o queuing de transactions no relay log.

A próxima camada da arquitetura do plugin Group Replication é um conjunto de components que reagem quando uma notification é roteada para eles. O component de capture é responsável por rastrear o context relacionado às transactions que estão sendo executadas. O component applier é responsável por executar transactions remotas no database. O component de recovery gerencia distributed recovery (recuperação distribuída) e é responsável por manter um server que está ingressando no group atualizado, selecionando o donor, orquestrando o catch up procedure (procedimento de atualização) e reagindo a falhas do donor.

Continuando a descer a stack, o replication protocol module contém a lógica específica do replication protocol. Ele lida com a conflict detection (detecção de conflitos) e recebe e propaga transactions para o group.

As duas camadas finais da arquitetura do plugin Group Replication são a Group Communication System (GCS) API, e uma implementação de um group communication engine baseado em Paxos (XCom). A GCS API é uma API de alto nível que abstrai as propriedades necessárias para construir uma replicated state machine (máquina de estado replicada) (veja [Seção 17.1, “Introdução ao Group Replication”](group-replication-background.html "17.1 Group Replication Background")). Isso desvincula a implementação da messaging layer (camada de mensagens) das demais camadas superiores do plugin. O group communication engine lida com as comunicações com os membros do replication group.