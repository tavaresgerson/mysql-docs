#### 17.1.3.1 Associação ao grupo

No MySQL Group Replication, um conjunto de servidores forma um grupo de replicação. Um grupo tem um nome, que assume a forma de um UUID. O grupo é dinâmico e os servidores podem sair (voluntariamente ou involuntariamente) e se juntar a ele a qualquer momento. O grupo se ajusta sempre que servidores se juntam ou saem.

Se um servidor se juntar ao grupo, ele se atualiza automaticamente, obtendo o estado faltante de um servidor existente. Se um servidor sair do grupo, por exemplo, se for desligado para manutenção, os servidores restantes percebem que ele saiu e reconfiguram o grupo automaticamente.

A Replicação em Grupo tem um serviço de associação de grupo que define quais servidores estão online e participando do grupo. A lista de servidores online é referida como uma *visualização*. Cada servidor do grupo tem uma visão consistente de quais servidores são os membros que estão participando ativamente do grupo em um determinado momento.

Os membros do grupo devem concordar não apenas sobre os compromissos de transação, mas também sobre qual é a visão atual. Se os membros existentes concordarem que um novo servidor deve fazer parte do grupo, o grupo é reconfigurado para integrar esse servidor, o que desencadeia uma mudança de visão. Se um servidor sair do grupo, voluntariamente ou não, o grupo reorganiza dinamicamente sua configuração e uma mudança de visão é desencadeada.

No caso de um membro sair do grupo voluntariamente, ele primeiro inicia uma reconfiguração dinâmica do grupo, durante a qual todos os membros precisam concordar com uma nova visão sem o servidor que está saindo. No entanto, se um membro sair do grupo involuntariamente, por exemplo, porque parou inesperadamente ou a conexão de rede está desligada, ele não pode iniciar a reconfiguração. Nesta situação, o mecanismo de detecção de falha da Replicação de Grupo reconhece, após um curto período de tempo, que o membro saiu, e uma reconfiguração do grupo sem o membro falhado é proposta. Assim como com um membro que sai voluntariamente, a reconfiguração requer o acordo da maioria dos servidores do grupo. No entanto, se o grupo não conseguir chegar a um acordo, por exemplo, porque foi particionado de tal forma que não há maioria de servidores online, o sistema não consegue mudar dinamicamente a configuração e bloqueia para evitar uma situação de cérebro partido. Esta situação requer intervenção de um administrador.

É possível que um membro saia offline por um curto período, tente se reiniciar no grupo novamente antes que o mecanismo de detecção de falhas tenha detectado sua falha e antes que o grupo tenha sido reconfigurado para remover o membro. Nessa situação, o membro que se reinicia esquece seu estado anterior, mas se outros membros enviarem mensagens que são destinadas ao estado pré-falha, isso pode causar problemas, incluindo possíveis inconsistências de dados. Se um membro nessa situação participa do protocolo de consenso do XCom, isso pode potencialmente fazer com que o XCom entregue valores diferentes para a mesma rodada de consenso, tomando uma decisão diferente antes e depois da falha.

Para contrariar essa possibilidade, a partir do MySQL 5.7.22, os servidores recebem um identificador único quando se juntam a um grupo. Isso permite que a Replicação em Grupo esteja ciente da situação em que uma nova encarnação do mesmo servidor (com o mesmo endereço, mas um novo identificador) está tentando se juntar ao grupo enquanto sua antiga encarnação ainda está listada como membro. A nova encarnação é bloqueada de se juntar ao grupo até que a antiga encarnação possa ser removida por uma reconfiguração. Se a Replicação em Grupo for parada e reiniciada no servidor, o membro se torna uma nova encarnação e não pode se juntar novamente até que o tempo de suspeita expire.
