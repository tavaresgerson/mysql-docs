#### 17.1.3.2 Detecção de falhas

O mecanismo de detecção de falha da Replicação em Grupo é um serviço distribuído que consegue identificar que um servidor no grupo não está se comunicando com os outros, e, portanto, é suspeito de estar fora de serviço. Se o consenso do grupo for que a suspeita provavelmente é verdadeira, o grupo toma uma decisão coordenada para expulsar o membro. Expulsar um membro que não está se comunicando é necessário porque o grupo precisa de uma maioria de seus membros concordar com uma transação ou mudança de visão. Se um membro não está participando dessas decisões, o grupo deve removê-lo para aumentar a chance de que o grupo contenha uma maioria de membros que estão funcionando corretamente e, portanto, podem continuar processando transações.

Em um grupo de replicação, cada membro tem um canal de comunicação ponto a ponto com outro membro, criando um grafo totalmente conectado. Essas conexões são gerenciadas pelo motor de comunicação do grupo (XCom, uma variante do Paxos) e usam soquetes TCP/IP. Um canal é usado para enviar mensagens para o membro e o outro canal é usado para receber mensagens do membro. Se um membro não receber mensagens de outro membro por 5 segundos, ele suspeita que o membro falhou e lista o status desse membro como `UNREACHABLE` (IRRECONHECÍVEL) na própria tabela do Schema de Desempenho `replication_group_members`. Normalmente, dois membros suspeitam um do outro de terem falhado porque cada um não está se comunicando com o outro. É possível, embora menos provável, que o membro A suspeite que o membro B tenha falhado, mas o membro B não suspeita que o membro A tenha falhado - talvez devido a um problema de roteamento ou firewall. Um membro também pode criar uma suspeita sobre si mesmo. Um membro que está isolado do resto do grupo suspeita que todos os outros falharam.

Se uma suspeita durar mais de 10 segundos, o membro suspeito tenta propagar sua visão de que o membro suspeito está com defeito aos outros membros do grupo. Um membro suspeito só faz isso se for um notificador, conforme calculado pelo número do nó XCom interno. Se um membro estiver realmente isolado do resto do grupo, ele pode tentar propagar sua visão, mas isso não terá consequências, pois não consegue garantir um quórum dos outros membros para concordar com isso. Uma suspeita só tem consequências se um membro for um notificador e sua suspeita durar o tempo suficiente para ser propagada aos outros membros do grupo, e os outros membros concordarem com isso. Nesse caso, o membro suspeito é marcado para expulsão do grupo em uma decisão coordenada e é expulso após o mecanismo de expulsão detectar e implementar a expulsão.

Para obter informações sobre as variáveis do sistema de replicação em grupo que você pode configurar para especificar as respostas dos membros do grupo de trabalho em situações de falha, e as ações tomadas pelos membros do grupo que são suspeitos de terem falhado, consulte Respostas à Detecção de Falha e Partição de Rede.
