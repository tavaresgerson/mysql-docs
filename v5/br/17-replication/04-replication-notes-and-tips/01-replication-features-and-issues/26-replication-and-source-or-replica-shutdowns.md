#### 16.4.1.26 Replication e Desligamentos do Source ou Replica

É seguro desligar um servidor Source e reiniciá-lo mais tarde. Quando uma Replica perde sua conexão com o Source, a Replica tenta reconectar-se imediatamente e retenta periodicamente se a tentativa falhar. O padrão é retentar a cada 60 segundos. Isso pode ser alterado com a instrução [`CHANGE MASTER TO`](change-master-to.html "13.4.2.1 CHANGE MASTER TO Statement"). Uma Replica também é capaz de lidar com interrupções de conectividade de rede. No entanto, a Replica só percebe a interrupção da rede após não receber dados do Source por [`slave_net_timeout`](replication-options-replica.html#sysvar_slave_net_timeout) segundos. Se suas interrupções forem curtas, talvez você queira diminuir [`slave_net_timeout`](replication-options-replica.html#sysvar_slave_net_timeout). Veja [Seção 16.3.2, “Lidando com uma Parada Inesperada de uma Replica”](replication-solutions-unexpected-replica-halt.html "16.3.2 Handling an Unexpected Halt of a Replica").

Um desligamento não limpo (por exemplo, um crash) no lado do Source pode resultar no Binary Log do Source tendo uma posição final menor do que a posição mais recente lida pela Replica, devido ao fato de o arquivo Binary Log do Source não ter sido *flushed*. Isso pode fazer com que a Replica não consiga replicar quando o Source voltar a operar. Definir [`sync_binlog=1`](replication-options-binary-log.html#sysvar_sync_binlog) no arquivo `my.cnf` do Source ajuda a minimizar esse problema, pois faz com que o Source *flush* seu Binary Log com mais frequência. Para a maior durabilidade e consistência possíveis em uma configuração de Replication usando `InnoDB` com Transactions, você também deve definir [`innodb_flush_log_at_trx_commit=1`](innodb-parameters.html#sysvar_innodb_flush_log_at_trx_commit). Com essa configuração, o conteúdo do `InnoDB` redo log buffer é escrito no arquivo de log a cada *Transaction commit*, e o arquivo de log é *flushed* para o disco. Note que a durabilidade das Transactions ainda não é garantida com essa configuração, pois sistemas operacionais ou hardware de disco podem informar ao [**mysqld**](mysqld.html "4.3.1 mysqld — The MySQL Server") que a operação de *flush* para o disco ocorreu, mesmo que não tenha ocorrido.

Desligar uma Replica de forma limpa é seguro porque ela rastreia onde parou. No entanto, tenha cuidado para que a Replica não tenha Temporary Tables abertas; veja [Seção 16.4.1.29, “Replication e Temporary Tables”](replication-features-temptables.html "16.4.1.29 Replication and Temporary Tables"). Desligamentos não limpos podem gerar problemas, especialmente se o *disk cache* não foi *flushed* para o disco antes que o problema ocorresse:

* Para Transactions, a Replica realiza o *commit* e depois atualiza `relay-log.info`. Se ocorrer uma saída inesperada entre essas duas operações, o processamento do Relay Log avança mais do que o indicado pelo arquivo de informações, e a Replica reexecuta os eventos da última Transaction no Relay Log após ser reiniciada.

* Um problema semelhante pode ocorrer se a Replica atualizar `relay-log.info`, mas o host do servidor crashar antes que a escrita tenha sido *flushed* para o disco. Para minimizar a chance disso ocorrer, defina [`sync_relay_log_info=1`](replication-options-replica.html#sysvar_sync_relay_log_info) no arquivo `my.cnf` da Replica. Definir [`sync_relay_log_info`](replication-options-replica.html#sysvar_sync_relay_log_info) como 0 não força nenhuma escrita para o disco e o servidor depende do sistema operacional para *flush* o arquivo de tempos em tempos.

A tolerância a falhas do seu sistema para esses tipos de problemas é significativamente aumentada se você tiver um bom no-break (*uninterruptible power supply*).