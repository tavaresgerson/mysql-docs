#### 16.4.1.26 Replicação e interrupções de fontes ou réplicas

É seguro desligar um servidor de replica e reiniciá-lo mais tarde. Quando uma replica perde sua conexão com o servidor de origem, ela tenta reconectar imediatamente e tenta novamente periodicamente se isso falhar. O padrão é tentar novamente a cada 60 segundos. Isso pode ser alterado com a declaração `CHANGE MASTER TO`. Uma replica também é capaz de lidar com interrupções na conectividade da rede. No entanto, a replica só percebe a interrupção da rede após não receber dados do servidor de origem por `slave_net_timeout` segundos. Se suas interrupções forem curtas, você pode querer diminuir `slave_net_timeout`. Veja Seção 16.3.2, “Tratamento de um Parada Inesperada de uma Replica”.

Um desligamento não limpo (por exemplo, um travamento) no lado da fonte pode resultar no log binário da fonte ter uma posição final menor que a posição mais recente lida pela replica, devido ao arquivo de log binário da fonte não ter sido esvaziado. Isso pode fazer com que a replica não consiga replicar quando a fonte voltar a funcionar. Definir `sync_binlog=1` no arquivo `my.cnf` da fonte ajuda a minimizar esse problema, pois faz com que a fonte esvazie seu log binário com mais frequência. Para a maior durabilidade e consistência possíveis em uma configuração de replicação usando `InnoDB` com transações, você também deve definir `innodb_flush_log_at_trx_commit=1`. Com essa configuração, o conteúdo do buffer de log de refazer do `InnoDB` é escrito no arquivo de log em cada commit de transação e o arquivo de log é esvaziado para o disco. Note que a durabilidade das transações ainda não é garantida com essa configuração, porque sistemas operacionais ou hardware de disco podem informar ao **mysqld** que a operação de gravação para o disco ocorreu, mesmo que não tenha.

Fechar uma replica de forma limpa é seguro, pois ela mantém o registro de onde parou. No entanto, tenha cuidado para que a replica não tenha tabelas temporárias abertas; consulte Seção 16.4.1.29, “Replicação e Tabelas Temporárias”. Fechar de forma não limpa pode causar problemas, especialmente se o cache do disco não foi descarregado no disco antes do problema ocorrer:

- Para as transações, a replica executa o commit e, em seguida, atualiza o `relay-log.info`. Se uma saída inesperada ocorrer entre essas duas operações, o processamento do log de retransmissão prossegue além do que o arquivo de informações indica e a replica reexecuta os eventos da última transação no log de retransmissão após ser reiniciada.

- Um problema semelhante pode ocorrer se a replica atualizar `relay-log.info`, mas o host do servidor falhar antes que a escrita seja gravada no disco. Para minimizar a chance de isso acontecer, defina `sync_relay_log_info=1` no arquivo `my.cnf` da replica. Definir `sync_relay_log_info` para 0 faz com que as escritas não sejam forçadas ao disco e o servidor dependa do sistema operacional para limpar o arquivo de tempos em tempos.

A tolerância à falha do seu sistema para esses tipos de problemas é muito maior se você tiver uma boa fonte de alimentação ininterrupta.
