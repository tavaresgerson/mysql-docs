## A.4 MySQL 9.5 FAQ: Stored Procedures and Functions

A.4.1. Does MySQL support stored procedures and functions?

A.4.2. Where can I find documentation for MySQL stored procedures and stored functions?

A.4.3. Is there a discussion forum for MySQL stored procedures?

A.4.4. Where can I find the ANSI SQL 2003 specification for stored procedures?

A.4.5. How do you manage stored routines?

A.4.6. Is there a way to view all stored procedures and stored functions in a given database?

A.4.7. Where are stored procedures stored?

A.4.8. Is it possible to group stored procedures or stored functions into packages?

A.4.9. Can a stored procedure call another stored procedure?

A.4.10. Can a stored procedure call a trigger?

A.4.11. Can a stored procedure access tables?

A.4.12. Do stored procedures have a statement for raising application errors?

A.4.13. Do stored procedures provide exception handling?

A.4.14. Can MySQL stored routines return result sets?

A.4.15. Is WITH RECOMPILE supported for stored procedures?

A.4.16. Is there a MySQL equivalent to using mod\_plsql as a gateway on Apache to talk directly to a stored procedure in the database?

A.4.17. Can I pass an array as input to a stored procedure?

A.4.18. Can I pass a cursor as an IN parameter to a stored procedure?

A.4.19. Can I return a cursor as an OUT parameter from a stored procedure?

A.4.20. Can I print out a variable's value within a stored routine for debugging purposes?

A.4.21. Can I commit or roll back transactions inside a stored procedure?

A.4.22. Do MySQL stored procedures and functions work with replication?

A.4.23. Are stored procedures and functions created on a replication source server replicated to a replica?

A.4.24. How are actions that take place inside stored procedures and functions replicated?

A.4.25. Are there special security requirements for using stored procedures and functions together with replication?

A.4.26. What limitations exist for replicating stored procedure and function actions?

A.4.27. Do the preceding limitations affect the ability of MySQL to do point-in-time recovery?

A.4.28. What is being done to correct the aforementioned limitations?

<table border="0" style="width: 100%;"><colgroup><col align="left" width="1%"/><col/></colgroup><tbody><tr class="question"><td align="left" valign="top"><a name="faq-mysql-have-procedures-functions"></a><a name="id468645"></a><p><b>A.4.1.</b></p></td><td align="left" valign="top"><p> Does MySQL support stored procedures and functions? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. MySQL supports two types of stored routines, stored procedures, and stored functions. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-where-procedures-functions-docs"></a><a name="id468650"></a><p><b>A.4.2.</b></p></td><td align="left" valign="top"><p> Where can I find documentation for MySQL stored procedures and stored functions? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> See <a class="xref" href="stored-routines.html" title="27.2 Using Stored Routines">Section 27.2, “Using Stored Routines”</a>. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-where-procedures-forum"></a><a name="id468656"></a><p><b>A.4.3.</b></p></td><td align="left" valign="top"><p> Is there a discussion forum for MySQL stored procedures? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. See <a class="ulink" href="https://forums.mysql.com/list.php?98" target="_blank">https://forums.mysql.com/list.php?98</a>. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-where-ansi-2003-spec"></a><a name="id468662"></a><p><b>A.4.4.</b></p></td><td align="left" valign="top"><p> Where can I find the ANSI SQL 2003 specification for stored procedures? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Unfortunately, the official specifications are not freely available (ANSI makes them available for purchase). However, there are books, such as <em class="citetitle">SQL-99 Complete, Really</em> by Peter Gulutzan and Trudy Pelzer, that provide a comprehensive overview of the standard, including coverage of stored procedures. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-how-manage-routines"></a><a name="id468668"></a><p><b>A.4.5.</b></p></td><td align="left" valign="top"><p> How do you manage stored routines? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> It is always good practice to use a clear naming scheme for your stored routines. You can manage stored procedures with <code class="literal">CREATE [FUNCTION|PROCEDURE]</code>, <code class="literal">ALTER [FUNCTION|PROCEDURE]</code>, <code class="literal">DROP [FUNCTION|PROCEDURE]</code>, and <code class="literal">SHOW CREATE [FUNCTION|PROCEDURE]</code>. You can obtain information about existing stored procedures using the <a class="link" href="information-schema-routines-table.html" title="28.3.36 The INFORMATION_SCHEMA ROUTINES Table"><code class="literal">ROUTINES</code></a> table in the <code class="literal">INFORMATION_SCHEMA</code> database (see <a class="xref" href="information-schema-routines-table.html" title="28.3.36 The INFORMATION_SCHEMA ROUTINES Table">Section 28.3.36, “The INFORMATION_SCHEMA ROUTINES Table”</a>). </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-how-view-procedures-functions"></a><a name="id468681"></a><p><b>A.4.6.</b></p></td><td align="left" valign="top"><p> Is there a way to view all stored procedures and stored functions in a given database? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. For a database named <em class="replaceable"><code>dbname</code></em>, use this query on the <a class="link" href="information-schema-routines-table.html" title="28.3.36 The INFORMATION_SCHEMA ROUTINES Table"><code class="literal">INFORMATION_SCHEMA.ROUTINES</code></a> table: </p><pre class="programlisting copytoclipboard language-sql"><code class="language-sql">SELECT ROUTINE_TYPE, ROUTINE_NAME FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_SCHEMA='<em class="replaceable">dbname</em>';</code></pre><p> For more information, see <a class="xref" href="information-schema-routines-table.html" title="28.3.36 The INFORMATION_SCHEMA ROUTINES Table">Section 28.3.36, “The INFORMATION_SCHEMA ROUTINES Table”</a>. </p><p> The body of a stored routine can be viewed using <a class="link" href="show-create-function.html" title="15.7.7.9 SHOW CREATE FUNCTION Statement"><code class="literal">SHOW CREATE FUNCTION</code></a> (for a stored function) or <a class="link" href="show-create-procedure.html" title="15.7.7.11 SHOW CREATE PROCEDURE Statement"><code class="literal">SHOW CREATE PROCEDURE</code></a> (for a stored procedure). See <a class="xref" href="show-create-procedure.html" title="15.7.7.11 SHOW CREATE PROCEDURE Statement">Section 15.7.7.11, “SHOW CREATE PROCEDURE Statement”</a>, for more information. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-where-procedures-stored"></a><a name="id468699"></a><p><b>A.4.7.</b></p></td><td align="left" valign="top"><p> Where are stored procedures stored? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Stored procedures are stored in the <code class="literal">mysql.routines</code> and <code class="literal">mysql.parameters</code> tables, which are part of the data dictionary. You cannot access these tables directly. Instead, query the <code class="literal">INFORMATION_SCHEMA</code> <a class="link" href="information-schema-routines-table.html" title="28.3.36 The INFORMATION_SCHEMA ROUTINES Table"><code class="literal">ROUTINES</code></a> and <a class="link" href="information-schema-parameters-table.html" title="28.3.25 The INFORMATION_SCHEMA PARAMETERS Table"><code class="literal">PARAMETERS</code></a> tables. See <a class="xref" href="information-schema-routines-table.html" title="28.3.36 The INFORMATION_SCHEMA ROUTINES Table">Section 28.3.36, “The INFORMATION_SCHEMA ROUTINES Table”</a>, and <a class="xref" href="information-schema-parameters-table.html" title="28.3.25 The INFORMATION_SCHEMA PARAMETERS Table">Section 28.3.25, “The INFORMATION_SCHEMA PARAMETERS Table”</a>. </p><p> You can also use <a class="link" href="show-create-function.html" title="15.7.7.9 SHOW CREATE FUNCTION Statement"><code class="literal">SHOW CREATE FUNCTION</code></a> to obtain information about stored functions, and <a class="link" href="show-create-procedure.html" title="15.7.7.11 SHOW CREATE PROCEDURE Statement"><code class="literal">SHOW CREATE PROCEDURE</code></a> to obtain information about stored procedures. See <a class="xref" href="show-create-procedure.html" title="15.7.7.11 SHOW CREATE PROCEDURE Statement">Section 15.7.7.11, “SHOW CREATE PROCEDURE Statement”</a>. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-how-group-procedures-functions"></a><a name="id468719"></a><p><b>A.4.8.</b></p></td><td align="left" valign="top"><p> Is it possible to group stored procedures or stored functions into packages? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> No. This is not supported in MySQL. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-can-procedure-call-procedure"></a><a name="id468724"></a><p><b>A.4.9.</b></p></td><td align="left" valign="top"><p> Can a stored procedure call another stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-can-procedure-call-trigger"></a><a name="id468729"></a><p><b>A.4.10.</b></p></td><td align="left" valign="top"><p> Can a stored procedure call a trigger? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> A stored procedure can execute an SQL statement, such as an <a class="link" href="update.html" title="15.2.17 UPDATE Statement"><code class="literal">UPDATE</code></a>, that causes a trigger to activate. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-can-procedure-access-table"></a><a name="id468736"></a><p><b>A.4.11.</b></p></td><td align="left" valign="top"><p> Can a stored procedure access tables? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. A stored procedure can access one or more tables as required. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-can-procedure-raise-error"></a><a name="id468741"></a><p><b>A.4.12.</b></p></td><td align="left" valign="top"><p> Do stored procedures have a statement for raising application errors? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. MySQL implements the SQL standard <code class="literal">SIGNAL</code> and <code class="literal">RESIGNAL</code> statements. See <a class="xref" href="condition-handling.html" title="15.6.7 Condition Handling">Section 15.6.7, “Condition Handling”</a>. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-have-exceptions"></a><a name="id468749"></a><p><b>A.4.13.</b></p></td><td align="left" valign="top"><p> Do stored procedures provide exception handling? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> MySQL implements <a class="link" href="handler.html" title="15.2.5 HANDLER Statement"><code class="literal">HANDLER</code></a> definitions according to the SQL standard. See <a class="xref" href="declare-handler.html" title="15.6.7.2 DECLARE ... HANDLER Statement">Section 15.6.7.2, “DECLARE ... HANDLER Statement”</a>, for details. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-can-routine-results"></a><a name="id468757"></a><p><b>A.4.14.</b></p></td><td align="left" valign="top"><p> Can MySQL stored routines return result sets? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> <span class="emphasis"><em>Stored procedures</em></span> can, but stored functions cannot. If you perform an ordinary <a class="link" href="select.html" title="15.2.13 SELECT Statement"><code class="literal">SELECT</code></a> inside a stored procedure, the result set is returned directly to the client. You need to use the MySQL 4.1 (or higher) client/server protocol for this to work. This means that, for example, in PHP, you need to use the <code class="literal">mysqli</code> extension rather than the old <code class="literal">mysql</code> extension. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-have-with-recompile"></a><a name="id468767"></a><p><b>A.4.15.</b></p></td><td align="left" valign="top"><p> Is <code class="literal">WITH RECOMPILE</code> supported for stored procedures? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> No. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-have-mod-plsql"></a><a name="id468773"></a><p><b>A.4.16.</b></p></td><td align="left" valign="top"><p> Is there a MySQL equivalent to using <code class="literal">mod_plsql</code> as a gateway on Apache to talk directly to a stored procedure in the database? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> There is no equivalent in MySQL. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-can-procedure-array"></a><a name="id468779"></a><p><b>A.4.17.</b></p></td><td align="left" valign="top"><p> Can I pass an array as input to a stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> No. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-can-pass-cursor-in"></a><a name="id468784"></a><p><b>A.4.18.</b></p></td><td align="left" valign="top"><p> Can I pass a cursor as an <code class="literal">IN</code> parameter to a stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Cursors are only available inside stored procedures. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-can-return-cursor-out"></a><a name="id468790"></a><p><b>A.4.19.</b></p></td><td align="left" valign="top"><p> Can I return a cursor as an <code class="literal">OUT</code> parameter from a stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Cursors are only available inside stored procedures. However, if you do not open a cursor on a <a class="link" href="select.html" title="15.2.13 SELECT Statement"><code class="literal">SELECT</code></a>, the result is sent directly to the client. You can also <code class="literal">SELECT INTO</code> variables. See <a class="xref" href="select.html" title="15.2.13 SELECT Statement">Section 15.2.13, “SELECT Statement”</a>. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-can-print-var-in-procedure"></a><a name="id468800"></a><p><b>A.4.20.</b></p></td><td align="left" valign="top"><p> Can I print out a variable's value within a stored routine for debugging purposes? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes, you can do this in a <span class="emphasis"><em>stored procedure</em></span>, but not in a stored function. If you perform an ordinary <a class="link" href="select.html" title="15.2.13 SELECT Statement"><code class="literal">SELECT</code></a> inside a stored procedure, the result set is returned directly to the client. You must use the MySQL 4.1 (or above) client/server protocol for this to work. This means that, for example, in PHP, you need to use the <code class="literal">mysqli</code> extension rather than the old <code class="literal">mysql</code> extension. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-can-rollback-transaction-procedure"></a><a name="id468810"></a><p><b>A.4.21.</b></p></td><td align="left" valign="top"><p> Can I commit or roll back transactions inside a stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. However, you cannot perform transactional operations within a stored function. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-can-procedures-replicatation"></a><a name="id468815"></a><p><b>A.4.22.</b></p></td><td align="left" valign="top"><p> Do MySQL stored procedures and functions work with replication? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes, standard actions carried out in stored procedures and functions are replicated from a replication source server to a replica. There are a few limitations that are described in detail in <a class="xref" href="stored-programs-logging.html" title="27.9 Stored Program Binary Logging">Section 27.9, “Stored Program Binary Logging”</a>. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-are-procedures-replicated"></a><a name="id468821"></a><p><b>A.4.23.</b></p></td><td align="left" valign="top"><p> Are stored procedures and functions created on a replication source server replicated to a replica? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes, creation of stored procedures and functions carried out through normal DDL statements on a replication source server are replicated to a replica, so that the objects exist on both servers. <code class="literal">ALTER</code> and <code class="literal">DROP</code> statements for stored procedures and functions are also replicated. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-how-procedures-replicated"></a><a name="id468828"></a><p><b>A.4.24.</b></p></td><td align="left" valign="top"><p> How are actions that take place inside stored procedures and functions replicated? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> MySQL records each DML event that occurs in a stored procedure and replicates those individual actions to a replica. The actual calls made to execute stored procedures are not replicated. </p><p> Stored functions that change data are logged as function invocations, not as the DML events that occur inside each function. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-security-procedures-replication"></a><a name="id468834"></a><p><b>A.4.25.</b></p></td><td align="left" valign="top"><p> Are there special security requirements for using stored procedures and functions together with replication? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. Because a replica has authority to execute any statement read from a source's binary log, special security constraints exist for using stored functions with replication. If replication or binary logging in general (for the purpose of point-in-time recovery) is active, then MySQL DBAs have two security options open to them: </p> <div class="orderedlist"> <ol class="orderedlist" type="1"><li class="listitem"><p> Any user wishing to create stored functions must be granted the <a class="link" href="privileges-provided.html#priv_super"><code class="literal">SUPER</code></a> privilege. </p></li><li class="listitem"><p> Alternatively, a DBA can set the <a class="link" href="replication-options-binary-log.html#sysvar_log_bin_trust_function_creators"><code class="literal">log_bin_trust_function_creators</code></a> system variable to 1, which enables anyone with the standard <a class="link" href="privileges-provided.html#priv_create-routine"><code class="literal">CREATE ROUTINE</code></a> privilege to create stored functions. </p></li></ol> </div> <p> </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-limitations-procedures-replication"></a><a name="id468850"></a><p><b>A.4.26.</b></p></td><td align="left" valign="top"><p> What limitations exist for replicating stored procedure and function actions? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Nondeterministic (random) or time-based actions embedded in stored procedures may not replicate properly. By their very nature, randomly produced results are not predictable and cannot be exactly reproduced; therefore, random actions replicated to a replica do not mirror those performed on a source. Declaring stored functions to be <code class="literal">DETERMINISTIC</code> or setting the <a class="link" href="replication-options-binary-log.html#sysvar_log_bin_trust_function_creators"><code class="literal">log_bin_trust_function_creators</code></a> system variable to 0 keeps random operations producing random values from being invoked. </p><p> In addition, time-based actions cannot be reproduced on a replica because the timing of such actions in a stored procedure is not reproducible through the binary log used for replication. It records only DML events and does not factor in timing constraints. </p><p> Finally, nontransactional tables for which errors occur during large DML actions (such as bulk inserts) may experience replication issues in that a source may be partially updated from DML activity, but no updates are done to the replica because of the errors that occurred. A workaround is for a function's DML actions to be carried out with the <code class="literal">IGNORE</code> keyword so that updates on the source that cause errors are ignored and updates that do not cause errors are replicated to the replica. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-limitations-pit-recovery"></a><a name="id468861"></a><p><b>A.4.27.</b></p></td><td align="left" valign="top"><p> Do the preceding limitations affect the ability of MySQL to do point-in-time recovery? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> The same limitations that affect replication do affect point-in-time recovery. </p></td></tr><tr class="question"><td align="left" valign="top"><a name="faq-mysql-when-limitations-resolved"></a><a name="id468866"></a><p><b>A.4.28.</b></p></td><td align="left" valign="top"><p> What is being done to correct the aforementioned limitations? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> You can choose either statement-based replication or row-based replication. The original replication implementation is based on statement-based binary logging. Row-based binary logging resolves the limitations mentioned earlier. </p><p> <span class="firstterm">Mixed</span> replication is also available (by starting the server with <a class="link" href="replication-options-binary-log.html#sysvar_binlog_format"><code>--binlog-format=mixed</code></a>). This hybrid form of replication <span class="quote">“<span class="quote">knows</span>”</span> whether statement-level replication can safely be used, or row-level replication is required. </p><p> For additional information, see <a class="xref" href="replication-formats.html" title="19.2.1 Replication Formats">Section 19.2.1, “Replication Formats”</a>. </p></td></tr></tbody></table>
