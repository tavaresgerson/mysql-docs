#### 19.2.4.2 Replication Metadata Repositories

A replica server creates two replication metadata repositories, the connection metadata repository and the applier metadata repository. The replication metadata repositories survive a replica server's shutdown. If binary log file position based replication is in use, when the replica restarts, it reads the two repositories to determine how far it previously proceeded in reading the binary log from the source and in processing its own relay log. If GTID-based replication is in use, the replica does not use the replication metadata repositories for that purpose, but does need them for the other metadata that they contain.

* The replica's *connection metadata repository* contains information that the replication I/O (receiver) thread needs to connect to the replication source server and retrieve transactions from the source's binary log. The metadata in this repository includes the connection configuration, the replication user account details, the SSL settings for the connection, and the file name and position where the replication receiver thread is currently reading from the source's binary log.

* The replica's *applier metadata repository* contains information that the replication SQL (applier) thread needs to read and apply transactions from the replica's relay log. The metadata in this repository includes the file name and position up to which the replication applier thread has executed the transactions in the relay log, and the equivalent position in the source's binary log. It also includes metadata for the process of applying transactions, such as the number of worker threads and the `PRIVILEGE_CHECKS_USER` account for the channel.

The connection metadata repository is written to the `slave_master_info` table in the `mysql` system schema, and the applier metadata repository is written to the `slave_relay_log_info` table in the `mysql` system schema. A warning message is issued if **mysqld** is unable to initialize the tables for the replication metadata repositories, but the replica is allowed to continue starting. This situation is most likely to occur when upgrading from a version of MySQL that does not support the use of tables for the repositories to one in which they are supported.

Important

1. Do not attempt to update or insert rows in the `mysql.slave_master_info` or `mysql.slave_relay_log_info` tables manually. Doing so can cause undefined behavior, and is not supported. Execution of any statement requiring a write lock on either or both of the `slave_master_info` and `slave_relay_log_info` tables is disallowed while replication is ongoing (although statements that perform only reads are permitted at any time).

2. Access privileges for the connection metadata repository table `mysql.slave_master_info` should be restricted to the database administrator, because it contains the replication user account name and password for connecting to the source. Use a restricted access mode to protect database backups that include this table. You can clear the replication user account credentials from the connection metadata repository, and instead always provide them using a `START REPLICA` statement to start the replication channel. This approach means that the replication channel always needs operator intervention to restart, but the account name and password are not recorded in the replication metadata repositories.

`RESET REPLICA` clears the data in the replication metadata repositories, with the exception of the replication connection parameters (depending on the MySQL Server release). For details, see the description for `RESET REPLICA`.

You can set the `GTID_ONLY` option of the `CHANGE REPLICATION SOURCE TO` statement to stop a replication channel from persisting file names and file positions in the replication metadata repositories. This avoids writes and reads to the tables in situations where GTID-based replication does not actually require them. With the `GTID_ONLY` setting, the connection metadata repository and the applier metadata repository are not updated when the replica queues and applies events in a transaction, or when the replication threads are stopped and started. File positions are tracked in memory, and can be viewed using `SHOW REPLICA STATUS` if they are needed. The replication metadata repositories are only synchronized in the following situations:

* When a `CHANGE REPLICATION SOURCE TO` statement is issued.

* When a `RESET REPLICA` statement is issued. `RESET REPLICA ALL` deletes rather than updates the repositories, so they are synchronized implicitly.

* When a replication channel is initialized.
* If the replication metadata repositories are moved from files to tables.

Creating the replication metadata repositories as tables is the default; the use of files is deprecated.

The `mysql.slave_master_info` and `mysql.slave_relay_log_info` tables are created using the `InnoDB` transactional storage engine. Updates to the applier metadata repository table are committed together with the transactions, meaning that the replica's progress information recorded in that repository is always consistent with what has been applied to the database, even in the event of an unexpected server halt. For information on the combination of settings on a replica that is most resilient to unexpected halts, see Section 19.4.2, “Handling an Unexpected Halt of a Replica”.

When you back up the replica's data or transfer a snapshot of its data to create a new replica, ensure that you include the `mysql.slave_master_info` and `mysql.slave_relay_log_info` tables containing the replication metadata repositories. For cloning operations, note that when the replication metadata repositories are created as tables, they are copied to the recipient during a cloning operation, but when they are created as files, they are not copied. When binary log file position based replication is in use, the replication metadata repositories are needed to resume replication after restarting the restored, copied, or cloned replica. If you do not have the relay log files, but still have the applier metadata repository, you can check it to determine how far the replication SQL thread has executed in the source's binary log. Then you can use a `CHANGE REPLICATION SOURCE TO` statement with the `SOURCE_LOG_FILE` and `SOURCE_LOG_POS` options to tell the replica to re-read the binary logs from the source from that point (provided that the required binary logs still exist on the source).

One additional repository, the applier worker metadata repository, is created primarily for internal use, and holds status information about worker threads on a multithreaded replica. The applier worker metadata repository includes the names and positions for the relay log file and the source's binary log file for each worker thread. If the applier metadata repository is created as a table, which is the default, the applier worker metadata repository is written to the `mysql.slave_worker_info` table. If the applier metadata repository is written to a file, the applier worker metadata repository is written to the `worker-relay-log.info` file. For external use, status information for worker threads is presented in the Performance Schema `replication_applier_status_by_worker` table.

The replication metadata repositories originally contained information similar to that shown in the output of the `SHOW REPLICA STATUS` statement, which is discussed in Section 15.4.2, “SQL Statements for Controlling Replica Servers”. Further information has since been added to the replication metadata repositories which is not displayed by the `SHOW REPLICA STATUS` statement.

For the connection metadata repository, the following table shows the correspondence between the columns in the `mysql.slave_master_info` table, the columns displayed by `SHOW REPLICA STATUS`, and the lines in the deprecated `master.info` file.

<table summary="The correspondence between the columns in the mysql.slave_master_info table, the columns displayed by SHOW REPLICA STATUS, and the lines in the deprecated master.info file."><thead><tr> <th><code>slave_master_info</code> Table Column</th> <th><code>SHOW REPLICA STATUS</code> Column</th> <th><code>master.info</code> File Line</th> <th>Description</th> </tr></thead><tbody><tr> <th><code>Number_of_lines</code></th> <td>[None]</td> <td>1</td> <td>Number of columns in the table (or lines in the file)</td> </tr><tr> <th><code>Master_log_name</code></th> <td><code>Source_Log_File</code></td> <td>2</td> <td>The name of the binary log currently being read from the source</td> </tr><tr> <th><code>Master_log_pos</code></th> <td><code>Read_Source_Log_Pos</code></td> <td>3</td> <td>The current position within the binary log that has been read from the source</td> </tr><tr> <th><code>Host</code></th> <td><code>Source_Host</code></td> <td>4</td> <td>The host name of the replication source server</td> </tr><tr> <th><code>User_name</code></th> <td><code>Source_User</code></td> <td>5</td> <td>The replication user account name used to connect to the source</td> </tr><tr> <th><code>User_password</code></th> <td>Password (not shown by <code>SHOW REPLICA STATUS</code>)</td> <td>6</td> <td>The replication user account password used to connect to the source</td> </tr><tr> <th><code>Port</code></th> <td><code>Source_Port</code></td> <td>7</td> <td>The network port used to connect to the replication source server</td> </tr><tr> <th><code>Connect_retry</code></th> <td><code>Connect_Retry</code></td> <td>8</td> <td>The period (in seconds) that the replica waits before trying to reconnect to the source</td> </tr><tr> <th><code>Enabled_ssl</code></th> <td><code>Source_SSL_Allowed</code></td> <td>9</td> <td>Whether the replica supports SSL connections</td> </tr><tr> <th><code>Ssl_ca</code></th> <td><code>Source_SSL_CA_File</code></td> <td>10</td> <td>The file used for the Certificate Authority (CA) certificate</td> </tr><tr> <th><code>Ssl_capath</code></th> <td><code>Source_SSL_CA_Path</code></td> <td>11</td> <td>The path to the Certificate Authority (CA) certificate</td> </tr><tr> <th><code>Ssl_cert</code></th> <td><code>Source_SSL_Cert</code></td> <td>12</td> <td>The name of the SSL certificate file</td> </tr><tr> <th><code>Ssl_cipher</code></th> <td><code>Source_SSL_Cipher</code></td> <td>13</td> <td>The list of possible ciphers used in the handshake for the SSL connection</td> </tr><tr> <th><code>Ssl_key</code></th> <td><code>Source_SSL_Key</code></td> <td>14</td> <td>The name of the SSL key file</td> </tr><tr> <th><code>Ssl_verify_server_cert</code></th> <td><code>Source_SSL_Verify_Server_Cert</code></td> <td>15</td> <td>Whether to verify the server certificate</td> </tr><tr> <th><code>Heartbeat</code></th> <td>[None]</td> <td>16</td> <td>Interval between replication heartbeats, in seconds</td> </tr><tr> <th><code>Bind</code></th> <td><code>Source_Bind</code></td> <td>17</td> <td>Which of the replica's network interfaces should be used for connecting to the source</td> </tr><tr> <th><code>Ignored_server_ids</code></th> <td><code>Replicate_Ignore_Server_Ids</code></td> <td>18</td> <td>The list of server IDs to be ignored. Note that for <code>Ignored_server_ids</code> the list of server IDs is preceded by the total number of server IDs to ignore.</td> </tr><tr> <th><code>Uuid</code></th> <td><code>Source_UUID</code></td> <td>19</td> <td>The source's unique ID</td> </tr><tr> <th><code>Retry_count</code></th> <td><code>Source_Retry_Count</code></td> <td>20</td> <td>Maximum number of reconnection attempts permitted</td> </tr><tr> <th><code>Ssl_crl</code></th> <td>[None]</td> <td>21</td> <td>Path to an SSL certificate revocation-list file</td> </tr><tr> <th><code>Ssl_crlpath</code></th> <td>[None]</td> <td>22</td> <td>Path to a directory containing SSL certificate revocation-list files</td> </tr><tr> <th><code>Enabled_auto_position</code></th> <td><code>Auto_position</code></td> <td>23</td> <td>Whether GTID auto-positioning is in use or not</td> </tr><tr> <th><code>Channel_name</code></th> <td><code>Channel_name</code></td> <td>24</td> <td>The name of the replication channel</td> </tr><tr> <th><code>Tls_version</code></th> <td><code>Source_TLS_Version</code></td> <td>25</td> <td>TLS version on the source</td> </tr><tr> <th><code>Public_key_path</code></th> <td><code>Source_public_key_path</code></td> <td>26</td> <td>Name of the RSA public key file</td> </tr><tr> <th><code>Get_public_key</code></th> <td><code>Get_source_public_key</code></td> <td>27</td> <td>Whether to request RSA public key from source</td> </tr><tr> <th><code>Network_namespace</code></th> <td><code>Network_namespace</code></td> <td>28</td> <td>Network namespace</td> </tr><tr> <th><code>Master_compression_algorithm</code></th> <td>[None]</td> <td>29</td> <td>Permitted compression algorithms for the connection to the source</td> </tr><tr> <th><code>Master_zstd_compression_level</code></th> <td>[None]</td> <td>30</td> <td><code>zstd</code> compression level</td> </tr><tr> <th><code>Tls_ciphersuites</code></th> <td>[None]</td> <td>31</td> <td>Permitted ciphersuites for TLSv1.3</td> </tr><tr> <th><code>Source_connection_auto_failover</code></th> <td>[None]</td> <td>32</td> <td>Whether the asynchronous connection failover mechanism is activated</td> </tr><tr> <th><code>Gtid_only</code></th> <td>[None]</td> <td>33</td> <td>Whether the channel uses only GTIDs and does not persist positions</td> </tr></tbody></table>

For the applier metadata repository, the following table shows the correspondence between the columns in the `mysql.slave_relay_log_info` table, the columns displayed by `SHOW REPLICA STATUS`, and the lines in the deprecated `relay-log.info` file.

<table summary="The correspondence between the columns in the mysql.slave_relay_log_info table, the columns displayed by SHOW REPLICA STATUS, and the lines in the deprecated relay-log.info file."><thead><tr> <th><code>slave_relay_log_info</code> Table Column</th> <th><code>SHOW REPLICA STATUS</code> Column</th> <th>Line in <code>relay-log.info</code> File</th> <th>Description</th> </tr></thead><tbody><tr> <th><code>Number_of_lines</code></th> <td>[None]</td> <td>1</td> <td>Number of columns in the table or lines in the file</td> </tr><tr> <th><code>Relay_log_name</code></th> <td><code>Relay_Log_File</code></td> <td>2</td> <td>The name of the current relay log file</td> </tr><tr> <th><code>Relay_log_pos</code></th> <td><code>Relay_Log_Pos</code></td> <td>3</td> <td>The current position within the relay log file; events up to this position have been executed on the replica database</td> </tr><tr> <th><code>Master_log_name</code></th> <td><code>Relay_Source_Log_File</code></td> <td>4</td> <td>The name of the source's binary log file from which the events in the relay log file were read</td> </tr><tr> <th><code>Master_log_pos</code></th> <td><code>Exec_Source_Log_Pos</code></td> <td>5</td> <td>The equivalent position within the source's binary log file of the events that have been executed on the replica</td> </tr><tr> <th><code>Sql_delay</code></th> <td><code>SQL_Delay</code></td> <td>6</td> <td>The number of seconds that the replica must lag the source</td> </tr><tr> <th><code>Number_of_workers</code></th> <td>[None]</td> <td>7</td> <td>The number of worker threads for applying replication transactions in parallel</td> </tr><tr> <th><code>Id</code></th> <td>[None]</td> <td>8</td> <td>ID used for internal purposes; currently this is always 1</td> </tr><tr> <th><code>Channel_name</code></th> <td><code>Channel_name</code></td> <td>9</td> <td>The name of the replication channel</td> </tr><tr> <th><code>Privilege_checks_username</code></th> <td>[None]</td> <td>10</td> <td>The user name for the <code>PRIVILEGE_CHECKS_USER</code> account for the channel</td> </tr><tr> <th><code>Privilege_checks_hostname</code></th> <td>[None]</td> <td>11</td> <td>The host name for the <code>PRIVILEGE_CHECKS_USER</code> account for the channel</td> </tr><tr> <th><code>Require_row_format</code></th> <td>[None]</td> <td>12</td> <td>Whether the channel accepts only row-based events</td> </tr><tr> <th><code>Require_table_primary_key_check</code></th> <td>[None]</td> <td>13</td> <td>The channel's policy on whether tables must have primary keys for <code>CREATE TABLE</code> and <code>ALTER TABLE</code> operations</td> </tr><tr> <th><code>Assign_gtids_to_anonymous_transactions_type </code></th> <td>[None]</td> <td>14</td> <td>If the channel assigns a GTID to replicated transactions that do not already have one, using the replica's local UUID, this value is <code>LOCAL</code>; if the channel does so using instead a UUID which has been set manually, the value is <code>UUID</code>. If the channel does not assign a GTID in such cases, the value is <code>OFF</code>.</td> </tr><tr> <th><code>Assign_gtids_to_anonymous_transactions_value </code></th> <td>[None]</td> <td>15</td> <td>The UUID used in the GTIDs assigned to anonymous transactions</td> </tr></tbody></table>
