#### 17.15.1.3 Usando as tabelas do esquema de informações de compressão

**Exemplo 17.1 Usando as tabelas do esquema de informações de compressão**

O seguinte é uma saída de amostra de um banco de dados que contém tabelas compactadas (veja a Seção 17.9, “Compressão de Tabelas InnoDB e Páginas”, `INNODB_CMP`, `INNODB_CMP_PER_INDEX` e `INNODB_CMPMEM`).

A tabela a seguir mostra o conteúdo de `INFORMATION_SCHEMA.INNODB_CMP` sob uma carga de trabalho leve. O único tamanho de página compactado que o pool de buffer contém é de 8K. A compressão ou descompactação de páginas consumiu menos de um segundo desde que as estatísticas foram redefinidas, porque as colunas `COMPRESS_TIME` e `UNCOMPRESS_TIME` são zero.

<table summary="Dados de amostra da tabela INFORMATION_SCHEMA.INNODB_CMP, mostrando o funcionamento interno da compressão de tabelas InnoDB sob uma carga de trabalho leve."><col style="width: 15%"/><col style="width: 15%"/><col style="width: 15%"/><col style="width: 15%"/><col style="width: 20%"/><col style="width: 20%"/><thead><tr> <th>tamanho da página</th> <th>ops de compressão</th> <th>ops de compressão ok</th> <th>tempo de compressão</th> <th>ops de descompactação</th> <th>tempo de descompactação</th> </tr></thead><tbody><tr> <th>1024</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr><tr> <th>2048</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr><tr> <th>4096</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr><tr> <th>8192</th> <td>1048</td> <td>921</td> <td>0</td> <td>61</td> <td>0</td> </tr><tr> <th>16384</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr></tbody></table>

De acordo com `INNODB_CMPMEM`, há 6169 páginas compactadas de 8 KB no pool de buffers. O único outro tamanho de bloco alocado é de 64 bytes. O menor `PAGE_SIZE` em `INNODB_CMPMEM` é usado para descritores de bloco dessas páginas compactadas para as quais não existe uma página não compactada no pool de buffers. Vemos que há 5910 páginas assim. Indiretamente, vemos que 259 (6169-5910) páginas compactadas também existem no pool de buffers na forma não compactada.

A tabela a seguir mostra o conteúdo de `INFORMATION_SCHEMA.INNODB_CMPMEM` sob uma carga de trabalho leve. Algum espaço de memória é inutilizável devido à fragmentação do alocador de memória para páginas compactadas: `SUM(PAGE_SIZE*PAGES_FREE)=6784`. Isso ocorre porque solicitações de alocação de memória pequenas são atendidas dividindo blocos maiores, começando pelos blocos de 16 K que são alocados do pool de buffers principal, usando o sistema de alocação buddy. A fragmentação é tão baixa porque alguns blocos alocados foram realocados (copiados) para formar blocos livres adjacentes maiores. Essa cópia de `SUM(PAGE_SIZE*RELOCATION_OPS)` bytes consumiu menos de um segundo (`SUM(RELOCATION_TIME)=0`).

<table summary="Dados de amostra da tabela INFORMATION_SCHEMA.INNODB_CMPMEM, mostrando operações de memória do pool de buffers para compressão de tabelas InnoDB sob uma carga de trabalho leve."><col style="width: 15%"/><col style="width: 15%"/><col style="width: 20%"/><col style="width: 20%"/><col style="width: 20%"/><thead><tr> <th>tamanho da página</th> <th>páginas usadas</th> <th>páginas livres</th> <th>operações de realocação</th> <th>tempo de realocação</th> </tr></thead><tbody><tr> <th>64</th> <td>5910</td> <td>0</td> <td>2436</td> <td>0</td> </tr><tr> <th>128</th> <td>0</td> <td>1</td> <td>0</td> <td>0</td> </tr><tr> <th>256</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr><tr> <th>512</th> <td>0</td> <td>1</td> <td>0</td> <td>0</td> </tr><tr> <th>1024</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr><tr> <th>2048</th> <td>0</td> <td>1</td> <td>0</td> <td>0</td> </tr><tr> <th>4096</th> <td>6169</td> <td>0</td> <td>5</td> <td>0</td> </tr><tr> <th>8192</th> <td>0</td> <td>0</td> <td>0</td> <td>0</td> </tr><tr> <th>16384</th> <td>6169</td> <td>0</td> <td>5</td> <td>0</td> </tr></tbody></table>