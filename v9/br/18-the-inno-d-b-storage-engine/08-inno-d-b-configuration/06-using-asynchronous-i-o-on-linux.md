### 17.8.6 Uso de E/S Assíncrona no Linux

O `InnoDB` utiliza o subsistema de E/S assíncrona (AIO nativo) no Linux para realizar solicitações de leitura à frente e escrita de páginas de arquivos de dados. Esse comportamento é controlado pela opção de configuração `innodb_use_native_aio`, que se aplica apenas a sistemas Linux e é habilitada por padrão. Em outros sistemas Unix-like, o `InnoDB` utiliza apenas E/S síncrona. Historicamente, o `InnoDB` usava apenas E/S assíncrona em sistemas Windows. O uso do subsistema de E/S assíncrona no Linux requer a biblioteca `libaio`.

Com E/S síncrona, os threads de consulta colocam as solicitações de E/S em fila, e os threads de segundo plano do `InnoDB` recuperam as solicitações em fila uma de cada vez, emitindo uma chamada de E/S síncrona para cada uma. Quando uma solicitação de E/S é concluída e a chamada de E/S retorna, o thread de segundo plano do `InnoDB` que está lidando com a solicitação chama uma rotina de conclusão de E/S e retorna para processar a próxima solicitação. O número de solicitações que podem ser processadas em paralelo é *`n`*, onde *`n`* é o número de threads de segundo plano do `InnoDB`. O número de threads de segundo plano do `InnoDB` é controlado por `innodb_read_io_threads` e `innodb_write_io_threads`. Veja a Seção 17.8.5, “Configurando o Número de Threads de E/S Assíncronas do `InnoDB`”.

Com AIO nativo, os threads de consulta emitem solicitações de E/S diretamente para o sistema operacional, removendo assim o limite imposto pelo número de threads de segundo plano. Os threads de segundo plano do `InnoDB` aguardam por eventos de E/S para sinalizar solicitações concluídas. Quando uma solicitação é concluída, um thread de segundo plano chama uma rotina de conclusão de E/S e retoma a espera por eventos de E/S.

A vantagem do AIO nativo é a escalabilidade para sistemas com grande demanda de E/S, que geralmente apresentam muitos pedidos pendentes de leitura e escrita na saída `SHOW ENGINE INNODB STATUS`. O aumento no processamento paralelo ao usar o AIO nativo significa que o tipo de agendador de E/S ou as propriedades do controlador da matriz de discos têm uma influência maior no desempenho da E/S.

Uma possível desvantagem do AIO nativo para sistemas com grande demanda de E/S é a falta de controle sobre o número de solicitações de escrita de E/S enviadas ao sistema operacional de uma vez. Exibir muitas solicitações de escrita de E/S ao sistema operacional para processamento paralelo pode, em alguns casos, resultar em escassez de leitura de E/S, dependendo da quantidade de atividade de E/S e das capacidades do sistema.

Se um problema com o subsistema de E/S assíncrona no SO impedir que o `InnoDB` seja iniciado, você pode iniciar o servidor com `innodb_use_native_aio=0`. Essa opção também pode ser desabilitada automaticamente durante a inicialização se o `InnoDB` detectar um problema potencial, como uma combinação de localização do `tmpdir`, sistema de arquivos `tmpfs` e kernel Linux que não suporta E/S assíncrona no `tmpfs`.