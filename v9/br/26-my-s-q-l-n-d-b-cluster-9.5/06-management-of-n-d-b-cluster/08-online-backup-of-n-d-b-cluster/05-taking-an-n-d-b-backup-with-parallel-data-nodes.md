#### 25.6.8.5 Fazer um backup do NDB com nós de dados paralelos

É possível fazer um backup com vários gestores de dados locais (LDMs) atuando em paralelo nos nós de dados. Para que isso funcione, todos os nós de dados do clúster devem usar vários LDMs, e cada nó de dados deve usar o mesmo número de LDMs. Isso significa que todos os nós de dados devem rodar **ndbmtd**") (**ndbd** é monofilamento e, portanto, sempre tem apenas um LDM) e devem ser configurados para usar vários LDMs antes de fazer o backup; **ndbmtd**") por padrão executa em modo monofilamento. Você pode fazer com que eles usem vários LDMs escolhendo uma configuração apropriada para um dos parâmetros de configuração do nó de dados multifilamento `MaxNoOfExecutionThreads` ou `ThreadConfig`. Tenha em mente que alterar esses parâmetros requer um reinício do clúster; isso pode ser um reinício contínuo. Além disso, o parâmetro `EnableMultithreadedBackup` deve ser definido para 1 para cada nó de dados (isso é o padrão).

Dependendo do número de LDMs e de outros fatores, você também pode precisar aumentar `NoOfFragmentLogParts`. Se você estiver usando tabelas de dados de disco grandes, também pode precisar aumentar `DiskPageBufferMemory`. Como em backups monofilamentos, você também pode querer ou precisar fazer ajustes nas configurações de `BackupDataBufferSize`, `BackupMemory` e outros parâmetros de configuração relacionados a backups (veja Parâmetros de backup).

Uma vez que todos os nós de dados estão usando vários LDMs, você pode fazer o backup paralelo usando o comando `START BACKUP` no cliente de gerenciamento do NDB, da mesma forma que se os nós de dados estivessem rodando **ndbd** (ou **ndbmtd**") em modo monofilamento; não é necessária sintaxe adicional ou especial, e você pode especificar um ID de backup, opção de espera ou opção de instantâneo em qualquer combinação conforme necessário ou desejado.

As cópias de segurança com múltiplos LDM criam subdiretórios, um por LDM, sob o diretório `BACKUP/BACKUP-backup_id/` (que, por sua vez, reside sob o `BackupDataDir`) em cada nó de dados; esses subdiretórios são nomeados `BACKUP-backup_id-PART-1-OF-N/`, `BACKUP-backup_id-PART-2-OF-N/`, e assim por diante, até `BACKUP-backup_id-PART-N-OF-N/`, onde *`backup_id`* é o ID de backup usado para este backup e *`N`* é o número de LDM por nó de dados. Cada um desses subdiretórios contém os arquivos de backup usuais `BACKUP-backup_id-0.node_id.Data`, `BACKUP-backup_id.node_id.ctl`, e `BACKUP-backup_id.node_id.log`, onde *`node_id`* é o ID do nó deste nó de dados.

O **ndb\_restore** verifica automaticamente a presença dos subdiretórios descritos acima; se encontrá-los, ele tenta restaurar o backup em paralelo. Para obter informações sobre a restauração de backups feitos com múltiplos LDM, consulte Restaurando de um backup feito em paralelo.

Para forçar a criação de uma cópia de segurança de fluxo único, defina `EnableMultithreadedBackup = 0` para todos os nós de dados (você pode fazer isso definindo o parâmetro na seção `[ndbd default]` do arquivo de configuração global `config.ini`). Também é possível restaurar um backup paralelo a um cluster executando uma versão mais antiga do `NDB`. Consulte Restaurando um backup NDB para uma versão anterior do NDB Cluster, para obter mais informações.