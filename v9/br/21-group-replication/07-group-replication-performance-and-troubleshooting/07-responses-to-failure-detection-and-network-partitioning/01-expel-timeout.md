#### 20.7.7.1 Expulsão por tempo limite

Você pode usar a variável de sistema `group_replication_member_expel_timeout` para permitir um tempo adicional entre a criação de uma suspeita e a expulsão do membro suspeito. Uma suspeita é criada quando um servidor não recebe mensagens de outro servidor, conforme explicado na Seção 20.1.4.2, “Detecção de falhas”.

Existe um período de detecção inicial de 5 segundos antes que um membro do grupo de replicação de grupo crie uma suspeita de outro membro (ou de si mesmo). O membro é então expulso quando a suspeita de outro membro (ou a própria suspeita de si mesmo) do membro expulso expira. Pode passar um curto período de tempo após isso antes que o mecanismo de expulsão detecte e implemente a expulsão. `group_replication_member_expel_timeout` especifica o período de tempo em segundos, chamado de tempo limite de expulsão, que um membro do grupo espera entre a criação de uma suspeita e a expulsão do membro suspeito. Os membros suspeitos são listados como `UNREACHABLE` (Inalcançável) durante esse período de espera, mas não são removidos da lista de membros do grupo.

* Se um membro suspeito se tornar ativo novamente antes que a suspeita expire no final do período de espera, o membro aplica todas as mensagens que foram armazenadas em cache de mensagens do XCom pelos membros restantes do grupo e entra no estado `ONLINE` (Online), sem intervenção do operador. Nessa situação, o membro é considerado pelo grupo como a mesma encarnação.

* Se um membro suspeito se tornar ativo apenas após o tempo de suspeita expirar e conseguir retomar as comunicações, ele recebe uma visualização de que foi expulso e, nesse momento, percebe que foi expulso. Você pode usar `group_replication_autorejoin_tries` para fazer o membro tentar se reiniciar automaticamente nesse ponto. Essa funcionalidade está ativada por padrão no MySQL 9.5, e o membro faz três tentativas de reinício automático. Se o procedimento de reinício automático não for bem-sucedido ou não for tentado, o membro expulso segue a ação de saída especificada por `group_replication_exit_state_action`.

O período de espera antes de expulsar um membro só se aplica a membros que já estiveram ativos no grupo. Membros não membros que nunca estiveram ativos no grupo não recebem esse período de espera e são removidos após o período de detecção inicial porque demoraram muito para se juntar.

Se `group_replication_member_expel_timeout` for definido como 0, não há período de espera, e um membro suspeito é responsável pela expulsão imediatamente após o término do período inicial de detecção de 5 segundos. O padrão é 5, o que significa que um membro suspeito é responsável pela expulsão 5 segundos após o período de detecção de 5 segundos ter expirado. Não é obrigatório que todos os membros de um grupo tenham a mesma configuração para `group_replication_member_expel_timeout`, mas é recomendado para evitar expulsões inesperadas. Qualquer membro pode criar uma suspeita de qualquer outro membro, incluindo a si mesmo, então o tempo de expiração efetivo é o do membro com a configuração mais baixa.

Considere aumentar o valor de `group_replication_member_expel_timeout` do padrão nos seguintes cenários:

* A rede é lenta e o tempo padrão de 5 ou 10 segundos antes da expulsão não é suficiente para que os membros do grupo sempre troquem pelo menos uma mensagem.

* A rede às vezes tem interrupções transitórias e você deseja evitar expulsões desnecessárias e mudanças de membros primários nesses momentos.

* A rede não está sob seu controle direto e você deseja minimizar a necessidade de intervenção do operador.

* Uma interrupção temporária da rede é esperada e você não deseja que alguns ou todos os membros sejam expulsos devido a isso.

* Uma máquina individual está experimentando uma desaceleração e você não deseja que ela seja expulsa do grupo.

Você pode especificar um tempo de explosão de até 3600 segundos (1 hora). É importante garantir que o cache de mensagens do XCom seja suficientemente grande para conter o volume esperado de mensagens no seu período de tempo especificado, mais o período inicial de detecção de 5 segundos, caso contrário, os membros não poderão se reconectar. Você pode ajustar o limite de tamanho do cache usando a variável de sistema `group_replication_message_cache_size`. Para mais informações, consulte a Seção 20.7.6, “Gestão do Cache do XCom”.

Se algum membro de um grupo estiver atualmente sob suspeita, a associação ao grupo não pode ser reconfigurada (adicionando ou removendo membros ou eleger um novo líder). Se as mudanças de associação ao grupo precisam ser implementadas enquanto um ou mais membros estão sob suspeita e você deseja que os membros suspeitos permaneçam no grupo, tome as ações necessárias para fazer os membros se tornarem ativos novamente, se isso for possível. Se você não puder fazer os membros se tornarem ativos novamente e deseja que eles sejam expulsos do grupo, você pode forçar a explosão das suspeitas imediatamente. Faça isso alterando o valor de `group_replication_member_expel_timeout` em quaisquer membros ativos para um valor menor que o tempo que já se passou desde que as suspeitas foram criadas. Os membros suspeitos então se tornam responsáveis pela expulsão imediatamente.

Se um membro do grupo de replicação parar inesperadamente e for reiniciado imediatamente (por exemplo, porque foi iniciado com `mysqld_safe`), ele tentará automaticamente se reiniciar no grupo se o `group_replication_start_on_boot=on` estiver definido. Nessa situação, é possível que a tentativa de reinício e reinserção ocorra antes que a encarnação anterior do membro seja expulsa do grupo, caso em que o membro não poderá se reinserir. A Replicação de Grupo usa automaticamente uma funcionalidade do Sistema de Comunicação de Grupo (GCS) para tentar novamente a tentativa de reinserção do membro 10 vezes, com um intervalo de 5 segundos entre cada tentativa. Isso deve cobrir a maioria dos casos e permitir tempo suficiente para que a encarnação anterior seja expulsa do grupo, permitindo que o membro se reinserta. Observe que, se a variável de sistema `group_replication_member_expel_timeout` for definida para especificar um período de espera mais longo antes da expulsão do membro, as tentativas automáticas de reinserção ainda podem não ter sucesso.

Para estratégias alternativas de mitigação para evitar expulsões desnecessárias quando a variável de sistema `group_replication_member_expel_timeout` não estiver disponível, consulte a Seção 20.3.2, “Limitações da Replicação de Grupo”.