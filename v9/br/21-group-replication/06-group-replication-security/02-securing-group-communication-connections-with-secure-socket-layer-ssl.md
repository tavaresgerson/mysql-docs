### 20.6.2 Protegendo as Conexões de Comunicação de Grupo com Secure Socket Layer (SSL)

As conexões de comunicação de grupo podem ser protegidas com sockets seguros (SSL).

A variável do sistema de replicação de grupo `group_replication_ssl_mode` é usada para ativar o uso de SSL nas conexões de comunicação de grupo e especificar o modo de segurança para as conexões. Esse valor deve ser o mesmo em todos os membros do grupo; se for diferente, alguns membros podem não conseguir se juntar ao grupo. O ajuste padrão significa que o SSL não é usado. Essa variável tem os seguintes valores possíveis:

**Tabela 20.1 valores de configuração de group\_replication\_ssl\_mode**

<table summary="Lista os valores possíveis para group_replication_ssl_mode e descreve seu efeito sobre como os membros do grupo de replicação se conectam uns aos outros."><col style="width: 35%"/><col style="width: 65%"/><thead><tr> <th>Valor</th> <th><p> Descrição </p></th> </tr></thead><tbody><tr> <td><code class="literal">DESATIVADO</code></td> <td><p> Estabelecer uma conexão não criptografada (o padrão). </p></td> </tr><tr> <td><code class="literal">REQUERIDO</code></td> <td><p> Estabelecer uma conexão segura se o servidor suportar conexões seguras. </p></td> </tr><tr> <td><code class="literal">VERIFY_CA</code></td> <td><p> Como <code class="literal">REQUERIDO</code>, mas adicionalmente verificar o certificado TLS do servidor contra os certificados da Autoridade de Certificação (CA) configurados. </p></td> </tr><tr> <td><code class="literal">VERIFY_IDENTITY</code></td> <td><p> Como <code class="literal">VERIFY_CA</code>, mas adicionalmente verificar se o certificado do servidor corresponde ao host ao qual a conexão é tentada. </p></td> </tr></tbody></table>

Se o SSL for usado, os meios para configurar a conexão segura dependem se o XCom ou a pilha de comunicação MySQL é usada para a comunicação em grupo.

**Ao usar a pilha de comunicação XCom (`group_replication_communication_stack=XCOM`):** O restante da configuração para as conexões de comunicação em grupo da Replicação em Grupo é tirado da configuração SSL do servidor. Para mais informações sobre as opções de configuração do SSL do servidor, consulte Opções de comando para conexões criptografadas. As opções SSL do servidor que são aplicadas às conexões de comunicação em grupo da Replicação em Grupo são as seguintes:

**Tabela 20.2 Opções SSL**

<table summary="Lista as opções de configuração do servidor para SSL e descreve seu efeito na configuração do plugin de replicação de grupo para SSL."><col style="width: 35%"/><col style="width: 65%"/><thead><tr> <th>Configuração do Servidor</th> <th>Descrição</th> </tr></thead><tbody><tr> <td><a class="link" href="server-system-variables.html#sysvar_ssl_key"><code class="literal">ssl_key</code></a></td> <td>O nome do caminho do arquivo de chave privada SSL em formato PEM. No lado do cliente, esta é a chave privada do cliente. No lado do servidor, esta é a chave privada do servidor.</td> </tr><tr> <td><a class="link" href="server-system-variables.html#sysvar_ssl_cert"><code class="literal">ssl_cert</code></a></td> <td>O nome do caminho do arquivo de certificado da chave pública SSL em formato PEM. No lado do cliente, este é o certificado da chave pública do cliente. No lado do servidor, este é o certificado da chave pública do servidor.</td> </tr><tr> <td><a class="link" href="server-system-variables.html#sysvar_ssl_ca"><code class="literal">ssl_ca</code></a></td> <td>O nome do caminho do arquivo de certificado da Autoridade de Certificação (CA).</td> </tr><tr> <td><a class="link" href="server-system-variables.html#sysvar_ssl_capath"><code class="literal">ssl_capath</code></a></td> <td>O nome do caminho do diretório que contém arquivos de certificado de Autoridade de Certificação (CA) em formato PEM.</td> </tr><tr> <td><a class="link" href="server-system-variables.html#sysvar_ssl_crl"><code class="literal">ssl_crl</code></a></td> <td>O nome do caminho do arquivo que contém listas de revogação de certificados em formato PEM.</td> </tr><tr> <td><a class="link" href="server-system-variables.html#sysvar_ssl_crlpath"><code class="literal">ssl_crlpath</code></a></td> <td>O nome do caminho do diretório que contém arquivos de listas de revogação de certificados em formato PEM.</td> </tr><tr> <td><a class="link" href="server-system-variables.html#sysvar_ssl_cipher"><code class="literal">ssl_cipher</code></a></td> <td>Uma lista de cifra permitidos para conexões criptografadas.</td> </tr><tr> <td><a class="link" href="server-system-variables.html#sysvar_tls_version"><code class="literal">tls_version</code></a></td> <td>Uma lista dos protocolos TLS que o servidor permite para conexões criptografadas.</td> </tr><tr> <td><a class="link" href="server-system-variables.html#sysvar_tls_ciphersuites"><code class="literal">tls_ciphersuites</code></a></td> <td>Quais as suíte de cifra TLSv1.3 que o servidor permite para conexões criptografadas.</td> </tr></tbody></table>

Importante

* O suporte aos protocolos de conexão TLSv1 e TLSv1.1 foi removido no MySQL 8.0. Os clientes do MySQL, incluindo as instâncias do servidor de replicação de grupo que atuam como clientes, não retornam avisos ao usuário se uma versão de protocolo TLS obsoleta for usada. Consulte a remoção do suporte aos protocolos TLSv1 e TLSv1.1 para obter mais informações.

* O MySQL 9.5 suporta o protocolo TLSv1.3, desde que o servidor MySQL tenha sido compilado usando o OpenSSL 1.1.1. O servidor verifica a versão do OpenSSL no início; se for menor que 1.1.1, o TLSv1.3 é removido dos valores padrão para todas as variáveis de sistema do servidor relacionadas às versões TLS, incluindo `group_replication_recovery_tls_version`.

* A replicação de grupo do MySQL 9.5 suporta o TLSv1.3.
* Use `group_replication_recovery_tls_version` e `group_replication_recovery_tls_ciphersuites` para configurar o suporte ao cliente para qualquer seleção de suítes de cifra, incluindo apenas suítes de cifra não padrão, se desejado.

* Na lista de protocolos TLS especificada na variável de sistema `tls_version`, garanta que as versões especificadas estejam contínuas (por exemplo, `TLSv1.2,TLSv1.3`). Se houver lacunas na lista de protocolos (por exemplo, se você especificou `TLSv1,TLSv1.2`, omitindo o TLS 1.1), a replicação de grupo pode não ser capaz de fazer conexões de comunicação em grupo.

Em um grupo de replicação, o OpenSSL negocia o uso do protocolo TLS mais alto suportado por todos os membros. Um membro que se junta e está configurado para usar apenas TLSv1.3 (`tls_version=TLSv1.3`) não pode se juntar a um grupo de replicação onde qualquer membro existente não suporte TLSv1.3, porque os membros do grupo, nesse caso, estão usando uma versão de protocolo TLS mais baixa. Para que o membro se junte ao grupo, você deve configurar o membro que se junta para permitir também o uso de versões de protocolo TLS mais baixas suportadas pelos membros do grupo existentes. Por outro lado, se um membro que se junta não suporte TLSv1.3, mas os membros do grupo existentes todos o suportam e estão usando essa versão para conexões uns com os outros, o membro pode se juntar se os membros do grupo existentes já permitirem o uso de uma versão de protocolo TLS mais baixa adequada, ou se você configurá-los para fazer isso. Nessa situação, o OpenSSL usa uma versão de protocolo TLS mais baixa para as conexões de cada membro ao membro que se junta. As conexões de cada membro com outros membros existentes continuam a usar o protocolo mais alto disponível que ambos os membros suportam.

Você pode alterar a variável de sistema `tls_version` em tempo de execução para alterar a lista de versões de protocolo TLS permitidas para o servidor. Para a Replicação em Grupo, a instrução `ALTER INSTANCE RELOAD TLS`, que reconfigura o contexto TLS do servidor a partir dos valores atuais das variáveis de sistema que definem o contexto, não altera o contexto TLS para a conexão de comunicação de grupo da Replicação em Grupo enquanto a Replicação em Grupo estiver em execução. Para aplicar a reconfiguração a essas conexões, você deve executar `STOP GROUP_REPLICATION` seguido de `START GROUP_REPLICATION` para reiniciar a Replicação em Grupo no membro ou membros onde você alterou a variável de sistema `tls_version`. Da mesma forma, se você quiser que todos os membros de um grupo mudem para usar uma versão de protocolo TLS mais alta ou mais baixa, você deve realizar um reinício contínuo da Replicação em Grupo nos membros após alterar a lista de versões de protocolo TLS permitidas, para que o OpenSSL negocie o uso da versão de protocolo TLS mais alta quando o reinício contínuo for concluído. Para obter instruções sobre como alterar a lista de versões de protocolo TLS permitidas em tempo de execução, consulte a Seção 8.3.2, “Protocolos e cifra de conexão TLS Encriptada” e Configuração e monitoramento de execução no lado do servidor para conexões encriptadas.

O exemplo a seguir mostra uma seção de um arquivo `my.cnf` que configura o SSL em um servidor e ativa o SSL para as conexões de comunicação de grupo da Replicação em Grupo:

```
[mysqld]
ssl_ca = "cacert.pem"
ssl_capath = "/.../ca_directory"
ssl_cert = "server-cert.pem"
ssl_cipher = "DHE-RSA-AEs256-SHA"
ssl_crl = "crl-server-revoked.crl"
ssl_crlpath = "/.../crl_directory"
ssl_key = "server-key.pem"
group_replication_ssl_mode= REQUIRED
```

Importante

A declaração `ALTER INSTANCE RELOAD TLS`, que reconfigura o contexto TLS do servidor a partir dos valores atuais das variáveis do sistema que definem o contexto, não altera o contexto TLS das conexões de comunicação do grupo da Replicação de Grupo enquanto a Replicação de Grupo estiver em execução. Para aplicar a reconfiguração a essas conexões, você deve executar `STOP GROUP_REPLICATION` seguido de `START GROUP_REPLICATION` para reiniciar a Replicação de Grupo.

As conexões feitas entre um membro que está se juntando e um membro existente para a recuperação distribuída não estão cobertas pelas opções descritas acima. Essas conexões usam as opções dedicadas de SSL para recuperação distribuída da Replicação de Grupo, que são descritas na Seção 20.6.3.2, “Conexões de Camada de Sockets Segura (SSL) para Recuperação Distribuída” (Conexões para Recuperação Distribuída”).

**Ao usar a pilha de comunicação MySQL (group\_replication\_communication\_stack=MYSQL):** As configurações de segurança para a recuperação distribuída do grupo são aplicadas às comunicações normais entre os membros do grupo. Veja a Seção 20.6.3, “Segurança das Conexões de Recuperação Distribuída” para saber como configurar as configurações de segurança.