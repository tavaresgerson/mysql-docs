### 20.1.5 Arquitetura do Plugin de Replicação em Grupo

A Replicação em Grupo do MySQL é um plugin do MySQL e se baseia na infraestrutura de replicação existente do MySQL, aproveitando recursos como o log binário, o registro baseado em linhas e os identificadores de transações globais. Ele se integra a frameworks MySQL atuais, como o esquema de desempenho ou infraestruturas de plugins e serviços. A figura a seguir apresenta um diagrama de blocos que ilustra a arquitetura geral da Replicação em Grupo do MySQL.

**Figura 20.6 Diagrama de Blocos do Plugin de Replicação em Grupo**

![O texto após a figura descreve o conteúdo do diagrama.](images/gr-plugin-blocks.png)

O plugin de Replicação em Grupo do MySQL inclui um conjunto de APIs para captura, aplicação e ciclo de vida, que controlam como o plugin interage com o MySQL Server. Existem interfaces para fazer o fluxo de informações do servidor para o plugin e vice-versa. Essas interfaces isolam o núcleo do MySQL Server do plugin de Replicação em Grupo e são, na maioria das vezes, pontos de conexão colocados na pipeline de execução de transações. Em uma direção, do servidor para o plugin, há notificações para eventos como o servidor iniciando, o servidor recuperando, o servidor estando pronto para aceitar conexões e o servidor prestes a comprometer uma transação. Na outra direção, o plugin instrui o servidor a realizar ações como comprometer ou abortar transações em andamento ou agrupar transações no log de retransmissão.

A próxima camada da arquitetura do plugin de replicação em grupo é um conjunto de componentes que reagem quando uma notificação é encaminhada para eles. O componente de captura é responsável por manter o controle do contexto relacionado às transações em execução. O componente de aplicação é responsável por executar transações remotas no banco de dados. O componente de recuperação gerencia a recuperação distribuída e é responsável por atualizar um servidor que está se juntando ao grupo, selecionando o doador, gerenciando o procedimento de recuperação e reagindo a falhas do doador.

Continuando a pilha, o módulo do protocolo de replicação contém a lógica específica do protocolo de replicação. Ele lida com a detecção de conflitos e recebe e propaga transações para o grupo.

As duas camadas finais da arquitetura do plugin de replicação em grupo são o Sistema de Comunicação de Grupo (GCS) API e uma implementação de um motor de comunicação de grupo baseado em Paxos (XCom). A API GCS é uma API de alto nível que abstrai as propriedades necessárias para construir uma máquina de estado replicada (veja a Seção 20.1, “Contexto da Replicação em Grupo”). Portanto, ela desacopla a implementação da camada de mensagens das camadas superiores restantes do plugin. O motor de comunicação de grupo lida com as comunicações com os membros do grupo de replicação.