#### 19.1.3.7 Restrições para replicação com GTIDs

Como a replicação baseada em GTIDs depende de transações, algumas funcionalidades que normalmente estão disponíveis no MySQL não são suportadas ao usá-la. Esta seção fornece informações sobre as restrições e limitações da replicação com GTIDs.

**Atualizações envolvendo motores de armazenamento não transacionais.** Ao usar GTIDs, as atualizações em tabelas usando motores de armazenamento não transacionais, como `MyISAM`, não podem ser feitas na mesma instrução ou transação que atualizações em tabelas usando motores de armazenamento transacionais, como `InnoDB`.

Esta restrição ocorre porque as atualizações em tabelas que usam um motor de armazenamento não transakcional, misturadas com atualizações em tabelas que usam um motor de armazenamento transakcional, dentro da mesma transação, podem resultar em múltiplos GTIDs sendo atribuídos à mesma transação.

Esses problemas também podem ocorrer quando a fonte e a replica usam motores de armazenamento diferentes para suas respectivas versões da mesma tabela, onde um motor de armazenamento é transakcional e o outro não. Além disso, esteja ciente de que gatilhos definidos para operar em tabelas não transacionais podem ser a causa desses problemas.

Em qualquer um dos casos mencionados, a correspondência um-para-um entre transações e GTIDs é quebrada, com o resultado de que a replicação baseada em GTIDs não pode funcionar corretamente.

**Instruções `CREATE TABLE ... SELECT`.** Para motores de armazenamento que suportam DDL atômico, a instrução `CREATE TABLE ... SELECT` é registrada no log binário como uma transação. Para mais informações, consulte a Seção 15.1.1, “Suporte a Declaração de Definição de Dados Atômica”.

**Tabelas temporárias.** Se `binlog_format` estiver definido como `STATEMENT`, as instruções `CREATE TEMPORARY TABLE` e `DROP TEMPORARY TABLE` não podem ser usadas dentro de transações, procedimentos, funções e gatilhos quando GTIDs estão em uso no servidor (ou seja, quando a variável de sistema `enforce_gtid_consistency` está definida como `ON`). Elas podem ser usadas fora desses contextos quando GTIDs estão em uso, desde que `autocommit=1` esteja definido. Quando `binlog_format` está definido como `ROW` ou `MIXED`, as instruções `CREATE TEMPORARY TABLE` e `DROP TEMPORARY TABLE` são permitidas dentro de uma transação, procedimento, função ou gatilho quando GTIDs estão em uso. As instruções não são escritas no log binário e, portanto, não são replicadas para réplicas. O uso da replicação baseada em linhas significa que as réplicas permanecem sincronizadas sem a necessidade de replicar tabelas temporárias. Se a remoção dessas instruções de uma transação resultar em uma transação vazia, a transação não é escrita no log binário.

**Prevenção da execução de instruções não suportadas.** Para prevenir a execução de instruções que causariam o fracasso da replicação baseada em GTIDs, todos os servidores devem ser iniciados com a opção `--enforce-gtid-consistency` ao habilitar GTIDs. Isso faz com que as instruções de qualquer um dos tipos discutidos anteriormente nesta seção falhem com um erro.

Observe que `--enforce-gtid-consistency` só tem efeito se o registro binário estiver ocorrendo para uma instrução. Se o registro binário estiver desativado no servidor ou se as instruções não forem escritas no log binário porque são removidas por um filtro, a consistência de GTIDs não é verificada ou aplicada para as instruções que não são registradas.

Para obter informações sobre outras opções de inicialização necessárias ao habilitar GTIDs, consulte a Seção 19.1.3.4, “Configurando a replicação usando GTIDs”.

**Saltar transações.** `sql_replica_skip_counter` não está disponível quando se usa a replicação baseada em GTID. Se você precisar pular transações, use o valor da variável `gtid_executed` da fonte. Se você habilitou a atribuição de GTID em um canal de replicação usando a opção `ASSIGN_GTIDS_TO_ANONYMOUS_TRANSACTIONS` da instrução `CHANGE REPLICATION SOURCE TO`, `sql_replica_skip_counter` estará disponível. Para mais informações, consulte a Seção 19.1.7.3, “Saltar transações”.

**Ignorar servidores.** `IGNORE_SERVER_IDS` não pode ser usado com `CHANGE REPLICATION SOURCE TO` quando se usa GTIDs, porque as transações que já foram aplicadas são automaticamente ignoradas. Antes de iniciar a replicação baseada em GTIDs, verifique e limpe todas as listas de IDs de servidor ignorados que foram previamente definidas nos servidores envolvidos. A instrução `SHOW REPLICA STATUS`, que pode ser emitida para canais individuais, exibe a lista de IDs de servidor ignorados, se houver. Se não houver lista, o campo `Replicate_Ignore_Server_Ids` está em branco. Se a lista de IDs de servidor ignorados não estiver vazia, você pode limpá-la com `CHANGE REPLICATION SOURCE TO ... IGNORE_SERVER_IDS=()` (ou seja, com uma lista vazia de IDs de servidor a serem ignorados).