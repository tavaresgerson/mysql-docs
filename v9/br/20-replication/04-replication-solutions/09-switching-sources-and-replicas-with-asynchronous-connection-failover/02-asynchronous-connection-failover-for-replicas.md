#### 19.4.9.2 Falha no Failover de Conexão Assíncrona para Replicas

O failover de conexão assíncrona para replicas é ativado automaticamente para um canal de replicação em um primário de Replicação por Grupo quando você define `SOURCE_CONNECTION_AUTO_FAILOVER=1` na instrução `CHANGE REPLICATION SOURCE TO` para o canal. O recurso é projetado para um grupo de remetentes e um grupo de destinatários para permanecerem sincronizados entre si, mesmo quando alguns membros estão temporariamente indisponíveis. Quando o recurso está ativo e configurado corretamente, se o primário que está replicando sair offline ou entrar em um estado de erro, o novo primário começa a replicação no mesmo canal quando é eleito. O novo primário usa a lista de fontes do canal para selecionar a fonte com o maior nível de prioridade (peso), que pode não ser o mesmo da fonte original.

Para configurar este recurso, o canal de replicação e a conta de usuário e senha de replicação para o canal devem ser configurados em todos os servidores membros do grupo de replicação e em quaisquer novos membros que se juntem. Certifique-se de que `SOURCE_RETRY_COUNT` e `SOURCE_CONNECT_RETRY` estejam configurados para números mínimos que permitam apenas algumas tentativas de reposição, por exemplo, 3 e 10. Você pode configurar o canal de replicação usando `CHANGE REPLICATION SOURCE TO`, ou se os novos servidores forem provisionados usando a funcionalidade de clone do MySQL, isso acontece automaticamente. A configuração `SOURCE_CONNECTION_AUTO_FAILOVER` para o canal é transmitida aos membros do grupo a partir do primário quando eles se juntam. Se você desabilitar mais tarde `SOURCE_CONNECTION_AUTO_FAILOVER` para o canal no primário, isso também é transmitido aos servidores secundários, e eles alteram o status do canal para corresponder.

O failover de conexão assíncrona para réplicas é ativado e desativado usando a ação do membro da Replicação em Grupo `mysql_start_failover_channels_if_primary`, que é habilitada por padrão. Você pode desativá-la para todo o grupo desabilitando essa ação do membro no primário, usando a função `group_replication_disable_member_action`, como neste exemplo:

```
mysql> SELECT group_replication_disable_member_action("mysql_start_failover_channels_if_primary", "AFTER_PRIMARY_ELECTION");
```

A função só pode ser alterada em um primário e deve ser habilitada ou desabilitada para todo o grupo, então você não pode ter alguns membros fornecendo failover e outros não. Quando a ação do membro `mysql_start_failover_channels_if_primary` é desativada, o canal não precisa ser configurado nos membros secundários, mas se o primário sair offline ou entrar em um estado de erro, a replicação para o canal para. Note que, se houver mais de um canal com `SOURCE_CONNECTION_AUTO_FAILOVER=1`, a ação do membro cobre todos os canais, então eles não podem ser habilitados e desabilitados individualmente por esse método. Defina `SOURCE_CONNECTION_AUTO_FAILOVER=0` no primário para desabilitar um canal individual.

A lista de fontes para um canal com `SOURCE_CONNECTION_AUTO_FAILOVER=1` é transmitida para todos os membros do grupo quando eles se juntam e também quando ela muda. Isso ocorre independentemente se as fontes são um grupo gerenciado para o qual a associação é atualizada automaticamente ou se são adicionadas ou alteradas manualmente usando `asynchronous_connection_failover_add_source()`, `asynchronous_connection_failover_delete_source()`, `asynchronous_connection_failover_add_managed()` ou `asynchronous_connection_failover_delete_managed()`. Todos os membros do grupo recebem a lista atual de fontes conforme registrada nas tabelas `mysql.replication_asynchronous_connection_failover` e `mysql.replication_asynchronous_connection_failover_managed`. Como as fontes não precisam estar em um grupo gerenciado, você pode configurar a função para sincronizar um grupo de receptores com um ou mais remetentes independentes alternativos, ou até mesmo com um único remetente. Uma replica independente que não faça parte de um grupo de replicação não pode usar essa funcionalidade.