### 10.2.1 Otimização de Instruções `SELECT`

As consultas, na forma de instruções `SELECT`, realizam todas as operações de busca no banco de dados. A otimização dessas instruções é uma prioridade máxima, seja para alcançar tempos de resposta inferiores a um segundo para páginas web dinâmicas, ou para reduzir horas no tempo necessário para gerar relatórios enormes durante a noite.

Além das instruções `SELECT`, as técnicas de otimização para consultas também se aplicam a construções como `CREATE TABLE...AS SELECT`, `INSERT INTO...SELECT` e cláusulas `WHERE` em instruções `DELETE`. Essas instruções têm considerações de desempenho adicionais porque combinam operações de escrita com operações de consulta orientadas para leitura.

O NDB Cluster suporta uma otimização de empurrão de junção, onde uma junção qualificadora é enviada na íntegra para os nós de dados do NDB Cluster, onde pode ser distribuída entre eles e executada em paralelo. Para obter mais informações sobre essa otimização, consulte Condições para junções de empurrão do NDB.

As principais considerações para otimizar consultas são:

* Para tornar uma consulta lenta `SELECT ... WHERE` mais rápida, a primeira coisa a verificar é se é possível adicionar um índice. Configure índices nas colunas usadas na cláusula `WHERE`, para acelerar a avaliação, o filtro e a recuperação final dos resultados. Para evitar o desperdício de espaço em disco, construa um pequeno conjunto de índices que acelere muitas consultas relacionadas usadas em sua aplicação.

Os índices são especialmente importantes para consultas que fazem referência a diferentes tabelas, utilizando recursos como junções e chaves estrangeiras. Você pode usar a instrução `EXPLAIN` para determinar quais índices são usados para uma `SELECT`. Veja a Seção 10.3.1, “Como o MySQL Usa Índices” e a Seção 10.8.1, “Otimizando Consultas com EXPLAIN”.
* Isolar e ajustar qualquer parte da consulta, como uma chamada de função, que leva tempo excessivo. Dependendo da estrutura da consulta, uma função pode ser chamada uma vez para cada linha no conjunto de resultados, ou até mesmo uma vez para cada linha da tabela, ampliando grandemente qualquer ineficiência.
* Minimizar o número de varreduras completas da tabela em suas consultas, particularmente para tabelas grandes.
* Manter as estatísticas da tabela atualizadas usando a instrução `ANALYZE TABLE` periodicamente, para que o otimizador tenha as informações necessárias para construir um plano de execução eficiente.
* Aprenda as técnicas de ajuste, técnicas de indexação e parâmetros de configuração que são específicos ao motor de armazenamento para cada tabela. Tanto o `InnoDB` quanto o `MyISAM` têm conjuntos de diretrizes para habilitar e sustentar alto desempenho em consultas. Para detalhes, veja a Seção 10.5.6, “Otimizando Consultas InnoDB” e a Seção 10.6.1, “Otimizando Consultas MyISAM”.
* Você pode otimizar transações de consulta única para tabelas `InnoDB`, usando a técnica na Seção 10.5.3, “Otimizando Transações InnoDB de Leitura Somente”.
* Evite transformar a consulta de maneiras que tornem difícil entendê-la, especialmente se o otimizador fizer algumas das mesmas transformações automaticamente.
* Se um problema de desempenho não for facilmente resolvido por uma das diretrizes básicas, investigue os detalhes internos da consulta específica lendo o plano `EXPLAIN` e ajustando seus índices, cláusulas `WHERE`, cláusulas de junção e assim por diante. (Quando você atingir um certo nível de expertise, ler o plano `EXPLAIN` pode ser o seu primeiro passo para cada consulta.)
* Ajuste o tamanho e as propriedades das áreas de memória que o MySQL usa para cache. Com o uso eficiente do pool de buffers `InnoDB`, cache de chaves `MyISAM` e cache de consultas MySQL, consultas repetidas são executadas mais rápido porque os resultados são recuperados da memória nas segundas e subsequentes vezes.
* Mesmo para uma consulta que roda rápido usando as áreas de memória de cache, você ainda pode otimizar mais para que elas exijam menos memória de cache, tornando sua aplicação mais escalável. Escalabilidade significa que sua aplicação pode lidar com mais usuários simultâneos, solicitações maiores e assim por diante sem experimentar uma grande queda de desempenho.
* Lidar com problemas de bloqueio, onde a velocidade da sua consulta pode ser afetada por outras sessões acessando as tabelas ao mesmo tempo.