### 10.5.9 Otimizando as Variáveis de Configuração do InnoDB

Diferentes configurações funcionam melhor para servidores com cargas leves e previsíveis, em comparação com servidores que estão operando quase na capacidade máxima o tempo todo ou que experimentam picos de alta atividade.

Como o mecanismo de armazenamento `InnoDB` realiza muitas de suas otimizações automaticamente, muitas tarefas de ajuste de desempenho envolvem monitoramento para garantir que o banco de dados esteja funcionando bem e alterar as opções de configuração quando o desempenho cair. Consulte a Seção 17.16, “Integração do InnoDB com o Schema de Desempenho do MySQL” para obter informações sobre o monitoramento detalhado do desempenho do `InnoDB`.

Os principais passos de configuração que você pode realizar incluem:

* Controlar os tipos de operações de alteração de dados para as quais os buffers do `InnoDB` armazenam os dados alterados, para evitar escritas frequentes em disco de pequeno tamanho. Veja Configuração da Armazenagem de Dados Alterados. Ativação da armazenagem de dados alterados pode proporcionar um melhor desempenho em cargas de trabalho dependentes de I/O, mas pode causar problemas durante a recuperação, carga em massa ou durante o redimensionamento do pool de buffers. Desativá-la (padrão a partir do MySQL 8.4) ajuda a garantir a estabilidade, mesmo que possa reduzir o desempenho.
* Ativação e desativação da funcionalidade de indexação hash adaptativa usando a opção `innodb_adaptive_hash_index`. Veja Seção 17.5.3, “Índice Hash Adaptativo” para mais informações. Você pode alterar essa configuração durante períodos de atividade incomum, e depois restaurá-la para a configuração original.
* Definir um limite para o número de threads concorrentes que o `InnoDB` processa, se a troca de contexto for um gargalo. Veja Seção 17.8.4, “Configurando Concorrencia de Threads para o InnoDB”.
* Controlar a quantidade de prefetching que o `InnoDB` faz com suas operações de leitura à frente. Quando o sistema tem capacidade de I/O não utilizada, mais leitura à frente pode melhorar o desempenho das consultas. Muito leitura à frente pode causar quedas periódicas de desempenho em um sistema com alta carga. Veja Seção 17.8.3.4, “Configurando Prefetching de Pool de Buffers InnoDB (Leitura à Frente”)").
* Aumentar o número de threads de segundo plano para operações de leitura ou escrita, se você tiver um subsistema de I/O de alta gama que não é totalmente utilizado pelos valores padrão. Veja Seção 17.8.5, “Configurando o Número de Threads de I/O InnoDB de Segundo Plano”.
* Controlar o quanto o I/O `InnoDB` realiza em segundo plano. Veja Seção 17.8.7, “Configurando Capacidade de I/O InnoDB”. Você pode reduzir essa configuração se observar quedas periódicas de desempenho.
* Controlar o algoritmo que determina quando o `InnoDB` realiza certos tipos de escritas em segundo plano. Veja Seção 17.8.3.5, “Configurando Purga de Pool de Buffers”. O algoritmo funciona para alguns tipos de cargas de trabalho, mas não para outros, então você pode desativar essa funcionalidade se observar quedas periódicas de desempenho.
* Aproveitar os processadores multicore e sua configuração de memória cache, para minimizar os atrasos na troca de contexto. Veja Seção 17.8.8, “Configurando Polling de Spin Lock”.
* Prevenir operações únicas, como varreduras de tabelas, de interferir nos dados frequentemente acessados armazenados no cache de buffers do `InnoDB`. Veja Seção 17.8.3.3, “Tornando a Varredura do Pool de Buffers Resistente à Garbageamento”.
* Ajustar os arquivos de log para um tamanho que faça sentido para a confiabilidade e recuperação após falhas. Os arquivos de log do `InnoDB` frequentemente foram mantidos pequenos para evitar tempos de inicialização longos após uma falha. As otimizações introduzidas no MySQL 5.5 aceleram certos passos do processo de recuperação após falhas. Em particular, a varredura do log de refazer e a aplicação do log de refazer são mais rápidas devido a algoritmos aprimorados para gerenciamento de memória. Se você manteve seus arquivos de log artificialmente pequenos para evitar tempos de inicialização longos, agora você pode considerar aumentar o tamanho do arquivo de log para reduzir o I/O que ocorre devido ao reciclagem de registros do log de refazer.
* Configurar o tamanho e o número de instâncias para o pool de buffers do `InnoDB`, especialmente importante para sistemas com pools de buffers de vários gigabytes. Veja Seção 17.8.3.2, “Configurando Múltiplas Instâncias de Pool de Buffers”.
* Aumentar o número máximo de transações concorrentes, o que melhora drasticamente a escalabilidade para os bancos de dados mais movimentados. Veja Seção 17.6.6, “Logs de Undo”.
* Mover operações de purga (um tipo de coleta de lixo) para um thread de segundo plano. Veja Seção 17.8.9, “Configuração de Purga”. Para medir efetivamente os resultados dessa configuração, ajuste primeiro as outras configurações relacionadas a I/O e threads.
* Reduzir a quantidade de troca que