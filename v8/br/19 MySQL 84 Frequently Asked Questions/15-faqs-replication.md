## A.14 Perguntas frequentes sobre a replicação do MySQL 8.4:

Na seção a seguir, fornecemos respostas às perguntas mais frequentes sobre a replicação do MySQL.

<table><colgroup><col align="left" width="1%"/><col/></colgroup><tbody><tr class="question"><td align="left" valign="top"><p><b>A.14.1.</b></p></td><td align="left" valign="top"><p> <b>A replica precisa estar conectada à fonte o tempo todo?</b></p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Não, não precisa. A replica pode ficar inativa ou desconectada por horas ou até dias, e depois se reconectar e recuperar as atualizações. Por exemplo, você pode configurar uma relação fonte/replica por meio de uma conexão dial-up, onde o link está ativo apenas esporadicamente e por curtos períodos de tempo. A implicação disso é que, em qualquer momento, não é garantido que a replica esteja em sincronia com a fonte, a menos que você tome algumas medidas especiais.</p><p> Para garantir que a recuperação possa ocorrer para uma replica que foi desconectada, você não deve remover arquivos de log binário da fonte que contêm informações que ainda não foram replicadas para as réplicas. A replicação assíncrona só pode funcionar se a replica puder continuar lendo o log binário a partir do ponto em que leu os eventos pela última vez.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.14.2.</b></p></td><td align="left" valign="top"><p> <b>Devo habilitar a rede na minha fonte e replica para habilitar a replicação?</b></p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Sim, a rede deve ser habilitada na fonte e na replica. Se a rede não estiver habilitada, a replica não poderá se conectar à fonte e transferir o log binário. Verifique se a variável de sistema <code>skip_networking</code> não foi habilitada no arquivo de configuração de qualquer servidor.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.14.3.</b></p></td><td align="left" valign="top"><p> <b>Como saber o quanto uma replica está atrasada em relação à fonte? Em outras palavras, como saber a data da última declaração replicada pela replica?</b></p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Verifique a coluna <code>Seconds_Behind_Master</code> na saída do comando <code>SHOW REPLICA | SLAVE STATUS</code>. Consulte a Seção 19.1.7.1, “Verificação do Status da Replicação”.</p><p> Quando o thread SQL de replicação executa uma leitura de eventos da fonte, ele modifica seu próprio tempo para o timestamp do evento. (É por isso que <code>TIMESTAMP</code> é bem replicado.) Na coluna <code>Time</code> na saída do comando <code>SHOW PROCESSLIST</code>, o número de segundos exibido para o thread SQL de replicação é o número de segundos entre o timestamp do último evento replicado e o tempo real da máquina da replica. Você pode usar isso para determinar a data do último evento replicado. Note que, se sua replica estiver desconectada da fonte por uma hora e depois se reconectar, você pode ver imediatamente grandes valores de <code>Time</code>, como 3600, no comando <code>SHOW PROCESSLIST</code>. Isso ocorre porque a replica está executando declarações que têm uma idade de uma hora.</p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.14.4.</b></p></td><td align="left" valign="top"><p> <b>Como forçar a fonte a bloquear as atualizações até que a replica recupere?</b></p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Use o seguinte procedimento:</p> <div class="orderedlist"> <ol class="orderedlist" type="1"><li><p> Na fonte, execute esses comandos:</p><pre class="programlisting copytoclipboard language-sql"><code class="language-sql">mysql&gt; FLUSH TABLES WITH READ LOCK; mysql&gt; SHOW MASTER STATUS;</code></pre><p> Anote as coordenadas de replicação (o nome atual do arquivo de log binário e a posição) na saída do comando <code>SHOW</code>.</p></li><li><p> Na replica, execute o seguinte comando,

<div class="question-answer">
<p><b>A.14.5.</b></p>
<p> Quais problemas devo estar ciente ao configurar a replicação bidirecional?</p>
<p> A replicação MySQL atualmente não suporta nenhum protocolo de bloqueio entre a fonte e a replica para garantir a atomicidade de uma atualização distribuída (cruzada entre servidores). Em outras palavras, é possível que o cliente A faça uma atualização para a co-fonte 1, e, enquanto isso, antes de propagar para a co-fonte 2, o cliente B faça uma atualização para a co-fonte 2 que faça a atualização do cliente A funcionar de maneira diferente do que funcionaria na co-fonte 1. Assim, quando a atualização do cliente A chega à co-fonte 2, ela produz tabelas diferentes das que você tem na co-fonte 1, mesmo após todas as atualizações da co-fonte 2 também terem sido propagadas. Isso significa que você não deve enlaçar dois servidores em uma relação de replicação bidirecional a menos que esteja certo de que suas atualizações podem ser executadas em qualquer ordem, ou a menos que você tome cuidado com atualizações mal-ordenadas de alguma forma no código do cliente.</p>
<p> Você também deve perceber que a replicação bidirecional na verdade não melhora muito o desempenho, se de todo, no que diz respeito às atualizações. Cada servidor deve fazer o mesmo número de atualizações, assim como você faria com um único servidor. A única diferença é que há um pouco menos de disputa por bloqueio porque as atualizações que se originam em outro servidor são serializadas em um único thread de replicação. Mesmo esse benefício pode ser compensado por atrasos na rede.</p>
</div>
<div class="question-answer">
<p><b>A.14.6.</b></p>
<p> Como posso usar a replicação para melhorar o desempenho do meu sistema?</p>
<p> Configure um servidor como fonte e direcione todos os escritos para ele. Em seguida, configure tantas réplicas quanto o orçamento e o espaço disponível permitirem, e distribua as leituras entre a fonte e as réplicas. Você também pode iniciar as réplicas com a opção <code>--skip-innodb</code>, habilitar a variável de sistema <code>low_priority_updates</code> e definir a variável de sistema <code>delay_key_write</code> para <code>ALL</code> para obter melhorias de velocidade no lado da replica. Neste caso, a replica usa tabelas <code>MyISAM</code> não transacionais em vez de tabelas <code>InnoDB</code> para obter mais velocidade, eliminando o overhead transacional. </p>
</div>
<div class="question-answer">
<p><b>A.14.7.</b></p>
<p> O que devo fazer para preparar o código do cliente em minhas próprias aplicações para usar a replicação com desempenho aprimorado?</p>
<p> Consulte o guia para usar a replicação como uma solução de escala horizontal, Seção 19.4.5, “Usando a Replicação para Escala Horizontal”. </p>
</div>
<div class="question-answer">
<p><b>A.14.8.</b></p>
<p> Quando e quanto a replicação pode melhorar o desempenho do meu sistema?</p>
<p> A replicação é mais benéfica para um sistema que processa leituras frequentes e escritas infrequentes. Teoricamente, ao usar uma configuração de fonte única/múltiplas réplicas, você pode escalar o sistema adicionando mais réplicas até que você ou o seu sistema não possa mais lidar com a carga de escrita. </p>
<p> Para determinar quantos réplicas você pode usar antes que os benefícios adicionais comecem a se igualar e quanto você pode melhorar o desempenho do seu site, você deve conhecer seus padrões de consulta e determinar empiricamente verificando a relação entre o throughput para leituras e escritas em um sistema típico de fonte e uma replica típica. O exemplo aqui mostra um cálculo bastante simplificado do que você pode obter com a replicação para um sistema hipotético. Deixe <code>reads</code> e <code>writes</code> representarem o número de leituras e escritas por segundo, respectivamente. </p>
<p> Vamos supor que a carga de sistema consiste de 10% de escritas e 90% de leituras, e determinamos por benchmarking que <code>reads</code> é 1,200 - 2 * <code>writes</code>. Em outras palavras, o sistema pode fazer 1.200 leituras por segundo sem escritas, a escrita média é duas vezes mais lenta que a leitura