#### 7.4.4.3 Formato de registo binário misto

Quando executado no formato de registro `MIXED`, o servidor muda automaticamente de registro baseado em instruções para registro baseado em linhas sob as seguintes condições:

- Quando uma função contém `UUID()`.
- Quando uma ou mais tabelas com `AUTO_INCREMENT` colunas são atualizadas e uma função de gatilho ou armazenada é invocada. Como todas as outras instruções inseguras, isso gera um aviso se `binlog_format = STATEMENT`.

  Para mais informações, ver secção 19.5.1.1, "Replicação e AUTO\_INCREMENTO".
- Quando o corpo de uma visualização requer replicação baseada em linhas, a instrução que cria a visualização também a usa. Por exemplo, isso ocorre quando a instrução que cria uma visualização usa a função `UUID()`.
- Quando uma chamada para uma função carregável está envolvida.
- Quando o `FOUND_ROWS()` ou o `ROW_COUNT()` é usado. (Bug #12092, Bug #30244)
- Quando `USER()`, `CURRENT_USER()`, ou `CURRENT_USER` é usado.
- Quando uma das tabelas envolvidas é uma tabela de log no banco de dados `mysql`.
- Quando a função `LOAD_FILE()` é usada. (Bug #39701)
- Quando uma instrução se refere a uma ou mais variáveis do sistema. (Bug #31168)

  \*\* Exceção. \*\* As seguintes variáveis do sistema, quando utilizadas com o escopo de sessão (apenas), não causam a mudança do formato de registo:

  - `auto_increment_increment`
  - `auto_increment_offset`
  - `character_set_client`
  - `character_set_connection`
  - `character_set_database`
  - `character_set_server`
  - `collation_connection`
  - `collation_database`
  - `collation_server`
  - `foreign_key_checks`
  - `identity`
  - `last_insert_id`
  - `lc_time_names`
  - `pseudo_thread_id`
  - `sql_auto_is_null`
  - `time_zone`
  - `timestamp`
  - `unique_checks`

  Para obter informações sobre a determinação do âmbito de aplicação das variáveis do sistema, ver a secção 7.1.9, "Utilização das variáveis do sistema".

  Para obter informações sobre a forma como a replicação trata o `sql_mode`, ver secção 19.5.1.39, "Replicação e variáveis".

Em versões anteriores ao MySQL 8.0, quando o formato de registro binário misto estava em uso, se uma instrução era registrada por linha e a sessão que executava a instrução tinha tabelas temporárias, todas as instruções subsequentes eram tratadas como inseguras e registradas em formato baseado em linha até que todas as tabelas temporárias em uso por essa sessão fossem descartadas. No MySQL 8.4, as operações em tabelas temporárias não são registradas no formato de registro binário misto, e a presença de tabelas temporárias na sessão não tem impacto no modo de registro usado para cada instrução.

::: info Note

Um aviso é gerado se você tentar executar uma instrução usando o registro baseado em instruções que deve ser escrito usando o registro baseado em linhas. O aviso é mostrado tanto no cliente (na saída de `SHOW WARNINGS`) quanto através do registro de erros `mysqld`. Um aviso é adicionado à tabela `SHOW WARNINGS` cada vez que tal instrução é executada. No entanto, apenas a primeira instrução que gerou o aviso para cada sessão do cliente é escrita no registro de erros para evitar inundação do registro.

:::

Além das decisões acima, os motores individuais também podem determinar o formato de registo utilizado quando as informações de uma tabela são atualizadas.

- Se um motor suportar o registo por linhas, diz-se que o motor é capaz de registo por linhas.
- Se um motor suporta o registo baseado em instruções, diz-se que o motor é capaz de registo de instruções.

Um determinado motor de armazenamento pode suportar um ou ambos os formatos de registro.

<table><col style="width: 50%"/><col style="width: 25%"/><col style="width: 25%"/><thead><tr> <th scope="col">Motor de armazenamento</th> <th scope="col">Registro de linhas suportado</th> <th scope="col">Registro de declarações suportado</th> </tr></thead><tbody><tr> <th>[[PH_HTML_CODE_<code>MERGE</code>]</th> <td>Sim , sim .</td> <td>Sim , sim .</td> </tr><tr> <th>[[PH_HTML_CODE_<code>MERGE</code>]</th> <td>Sim , sim .</td> <td>Sim , sim .</td> </tr><tr> <th>[[<code>CSV</code>]]</th> <td>Sim , sim .</td> <td>Sim , sim .</td> </tr><tr> <th>[[<code>EXAMPLE</code>]]</th> <td>Sim , sim .</td> <td>Não .</td> </tr><tr> <th>[[<code>FEDERATED</code>]]</th> <td>Sim , sim .</td> <td>Sim , sim .</td> </tr><tr> <th>[[<code>HEAP</code>]]</th> <td>Sim , sim .</td> <td>Sim , sim .</td> </tr><tr> <th>[[<code>InnoDB</code>]]</th> <td>Sim , sim .</td> <td>Sim, quando o nível de isolamento da transação for [[<code>REPEATABLE READ</code>]] ou [[<code>SERIALIZABLE</code>]]; Não, caso contrário.</td> </tr><tr> <th>[[<code>MyISAM</code>]]</th> <td>Sim , sim .</td> <td>Sim , sim .</td> </tr><tr> <th>[[<code>MERGE</code>]]</th> <td>Sim , sim .</td> <td>Sim , sim .</td> </tr><tr> <th>[[<code>BLACKHOLE</code><code>MERGE</code>]</th> <td>Sim , sim .</td> <td>Não .</td> </tr></tbody></table>

Se uma instrução deve ser registrada e o modo de registro a ser usado é determinado de acordo com o tipo de instrução (seguro, inseguro ou binário injetado), o formato de registro binário (`STATEMENT`, `ROW` ou `MIXED`) e as capacidades de registro do mecanismo de armazenamento (capaz de instrução, capaz de linha, ambos ou nenhum). (Injeção binária refere-se ao registro de uma alteração que deve ser registrada usando o formato `ROW`).

As instruções podem ser registradas com ou sem um aviso; instruções falhadas não são registradas, mas geram erros no registro. Isso é mostrado na tabela de decisão a seguir. \*\* Tipo \*\*, \*\* binlog\_format \*\*, \*\* SLC \*\* e \*\* RLC \*\* colunas descrevem as condições, e \*\* Erro / Aviso \*\* e \*\* Registado como \*\* colunas representam as ações correspondentes. \*\* SLC \*\* significa  declaração-registro capaz, e \*\* RLC \*\* significa  linha-registro capaz.

<table><col style="width: 10%"/><col style="width: 25%"/><col style="width: 10%"/><col style="width: 10%"/><col style="width: 20%"/><col style="width: 25%"/><thead><tr> <th scope="col">Tipo do produto</th> <th scope="col">[[PH_HTML_CODE_<code>STATEMENT</code>]</th> <th scope="col">SLC</th> <th scope="col">RLC</th> <th scope="col">Erro / Aviso</th> <th scope="col">Registado como</th> </tr></thead><tbody><tr> <th>- O quê ?</th> <td>[[PH_HTML_CODE_<code>STATEMENT</code>]</td> <td>Não .</td> <td>Não .</td> <td><span>Erro: Não é possível executar instrução</span>: O registro binário é impossível, pois pelo menos um mecanismo está envolvido que é incapaz de fazer linhas e declarações.</td> <td>[[PH_HTML_CODE_<code>STATEMENT</code>]</td> </tr><tr> <th>Em segurança .</th> <td>[[PH_HTML_CODE_<code>MIXED</code>]</td> <td>Sim , sim .</td> <td>Não .</td> <td>- O quê ?</td> <td>[[PH_HTML_CODE_<code>BINLOG_FORMAT = MIXED</code>]</td> </tr><tr> <th>Em segurança .</th> <td>[[PH_HTML_CODE_<code>-</code>]</td> <td>Sim , sim .</td> <td>Não .</td> <td>- O quê ?</td> <td>[[PH_HTML_CODE_<code>ROW</code>]</td> </tr><tr> <th>Em segurança .</th> <td>[[PH_HTML_CODE_<code>BINLOG_FORMAT = ROW</code>]</td> <td>Sim , sim .</td> <td>Não .</td> <td><span>Erro: Não é possível executar instrução</span>: O registro binário é impossível desde [[PH_HTML_CODE_<code>STATEMENT</code>] e pelo menos uma tabela usa um mecanismo de armazenamento que não é capaz de registro baseado em linhas.</td> <td>[[PH_HTML_CODE_<code>MIXED</code>]</td> </tr><tr> <th>Inseguro</th> <td>[[<code>STATEMENT</code>]]</td> <td>Sim , sim .</td> <td>Não .</td> <td><span>Aviso: Instrução insegura binlogada no formato de instrução</span>, desde [[<code>*</code><code>STATEMENT</code>]</td> <td>[[<code>STATEMENT</code>]]</td> </tr><tr> <th>Inseguro</th> <td>[[<code>MIXED</code>]]</td> <td>Sim , sim .</td> <td>Não .</td> <td><span>Erro: Não é possível executar instrução</span>: O registro binário de uma instrução insegura é impossível quando o mecanismo de armazenamento está limitado ao registro baseado em instruções, mesmo que [[<code>BINLOG_FORMAT = MIXED</code>]].</td> <td>[[<code>-</code>]]</td> </tr><tr> <th>Inseguro</th> <td>[[<code>ROW</code>]]</td> <td>Sim , sim .</td> <td>Não .</td> <td><span>Erro: Não é possível executar instrução</span>: O registro binário é impossível desde [[<code>BINLOG_FORMAT = ROW</code>]] e pelo menos uma tabela usa um mecanismo de armazenamento que não é capaz de registro baseado em linhas.</td> <td>- O quê ?</td> </tr><tr> <th>Injecção em linha</th> <td>[[<code>STATEMENT</code>]]</td> <td>Sim , sim .</td> <td>Não .</td> <td><span>Erro: Não é possível executar injeção de linha</span>: O registo binário não é possível, uma vez que pelo menos uma tabela utiliza um mecanismo de armazenamento que não é capaz de registo baseado em linhas.</td> <td>- O quê ?</td> </tr><tr> <th>Injecção em linha</th> <td>[[<code>MIXED</code>]]</td> <td>Sim , sim .</td> <td>Não .</td> <td><span>Erro: Não é possível executar injeção de linha</span>: O registo binário não é possível, uma vez que pelo menos uma tabela utiliza um mecanismo de armazenamento que não é capaz de registo baseado em linhas.</td> <td>- O quê ?</td> </tr><tr> <th>Injecção em linha</th> <td>[[<code>-</code><code>STATEMENT</code>]</td> <td>Sim , sim .</td> <td>Não .</td> <td><span>Erro: Não é possível executar injeção de linha</span>: O registo binário não é possível, uma vez que pelo menos uma tabela utiliza um mecanismo de armazenamento que não é capaz de registo baseado em linhas.</td> <td>- O quê ?</td> </tr><tr> <th>Em segurança .</th> <td>[[<code>-</code><code>STATEMENT</code>]</td> <td>Não .</td> <td>Sim , sim .</td> <td><span>Erro: Não é possível executar instrução</span>: O registro binário é impossível desde [[<code>-</code><code>STATEMENT</code>] e pelo menos uma tabela usa um mecanismo de armazenamento que não é capaz de registro baseado em instruções.</td> <td>[[<code>-</code><code>MIXED</code>]</td> </tr><tr> <th>Em segurança .</th> <td>[[<code>-</code><code>BINLOG_FORMAT = MIXED</code>]</td> <td>Não .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>-</code><code>-</code>]</td> </tr><tr> <th>Em segurança .</th> <td>[[<code>-</code><code>ROW</code>]</td> <td>Não .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>-</code><code>BINLOG_FORMAT = ROW</code>]</td> </tr><tr> <th>Inseguro</th> <td>[[<code>-</code><code>STATEMENT</code>]</td> <td>Não .</td> <td>Sim , sim .</td> <td><span>Erro: Não é possível executar instrução</span>: O registro binário é impossível desde [[<code>-</code><code>MIXED</code>] e pelo menos uma tabela usa um mecanismo de armazenamento que não é capaz de registro baseado em instruções.</td> <td>- O quê ?</td> </tr><tr> <th>Inseguro</th> <td>[[<code>STATEMENT</code><code>STATEMENT</code>]</td> <td>Não .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>STATEMENT</code><code>STATEMENT</code>]</td> </tr><tr> <th>Inseguro</th> <td>[[<code>STATEMENT</code><code>STATEMENT</code>]</td> <td>Não .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>STATEMENT</code><code>MIXED</code>]</td> </tr><tr> <th>Injecção em linha</th> <td>[[<code>STATEMENT</code><code>BINLOG_FORMAT = MIXED</code>]</td> <td>Não .</td> <td>Sim , sim .</td> <td><span>Erro: Não é possível executar injeção de linha</span>: O registro binário não é possível desde [[<code>STATEMENT</code><code>-</code>].</td> <td>[[<code>STATEMENT</code><code>ROW</code>]</td> </tr><tr> <th>Injecção em linha</th> <td>[[<code>STATEMENT</code><code>BINLOG_FORMAT = ROW</code>]</td> <td>Não .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>STATEMENT</code><code>STATEMENT</code>]</td> </tr><tr> <th>Injecção em linha</th> <td>[[<code>STATEMENT</code><code>MIXED</code>]</td> <td>Não .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>STATEMENT</code><code>STATEMENT</code>]</td> </tr><tr> <th>Em segurança .</th> <td>[[<code>STATEMENT</code><code>STATEMENT</code>]</td> <td>Sim , sim .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>STATEMENT</code><code>STATEMENT</code>]</td> </tr><tr> <th>Em segurança .</th> <td>[[<code>STATEMENT</code><code>MIXED</code>]</td> <td>Sim , sim .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>STATEMENT</code><code>BINLOG_FORMAT = MIXED</code>]</td> </tr><tr> <th>Em segurança .</th> <td>[[<code>STATEMENT</code><code>-</code>]</td> <td>Sim , sim .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>STATEMENT</code><code>ROW</code>]</td> </tr><tr> <th>Inseguro</th> <td>[[<code>STATEMENT</code><code>BINLOG_FORMAT = ROW</code>]</td> <td>Sim , sim .</td> <td>Sim , sim .</td> <td><span>Aviso: Instrução insegura binlogada no formato de instrução</span>desde [[<code>STATEMENT</code><code>STATEMENT</code>].</td> <td>[[<code>STATEMENT</code><code>MIXED</code>]</td> </tr><tr> <th>Inseguro</th> <td>[[<code>MIXED</code><code>STATEMENT</code>]</td> <td>Sim , sim .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>MIXED</code><code>STATEMENT</code>]</td> </tr><tr> <th>Inseguro</th> <td>[[<code>MIXED</code><code>STATEMENT</code>]</td> <td>Sim , sim .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>MIXED</code><code>MIXED</code>]</td> </tr><tr> <th>Injecção em linha</th> <td>[[<code>MIXED</code><code>BINLOG_FORMAT = MIXED</code>]</td> <td>Sim , sim .</td> <td>Sim , sim .</td> <td><span>Erro: Não é possível executar injeção de linha</span>: Registro binário não é possível porque [[<code>MIXED</code><code>-</code>].</td> <td>- O quê ?</td> </tr><tr> <th>Injecção em linha</th> <td>[[<code>MIXED</code><code>ROW</code>]</td> <td>Sim , sim .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>MIXED</code><code>BINLOG_FORMAT = ROW</code>]</td> </tr><tr> <th>Injecção em linha</th> <td>[[<code>MIXED</code><code>STATEMENT</code>]</td> <td>Sim , sim .</td> <td>Sim , sim .</td> <td>- O quê ?</td> <td>[[<code>MIXED</code><code>MIXED</code>]</td> </tr></tbody></table>

Quando um aviso é produzido pela determinação, um aviso padrão do MySQL é produzido (e está disponível usando `SHOW WARNINGS`). A informação também é escrita no `mysqld` log de erro. Apenas um erro para cada instância de erro por conexão do cliente é registrado para evitar inundação do log. A mensagem de log inclui a instrução SQL que foi tentada.

Se uma réplica tiver `log_error_verbosity` definido para exibir avisos, a réplica imprime mensagens para o log de erros para fornecer informações sobre seu status, como o log binário e as coordenadas do log de retransmissão onde começa seu trabalho, quando está mudando para outro log de retransmissão, quando se reconecta após uma desconexão, instruções que não são seguras para o registro baseado em instruções, e assim por diante.
