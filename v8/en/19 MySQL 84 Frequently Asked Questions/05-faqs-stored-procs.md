## A.4 MySQL 8.4 FAQ: Stored Procedures and Functions

<table><colgroup><col align="left" width="1%"/><col/></colgroup><tbody><tr class="question"><td align="left" valign="top"><p><b>A.4.1.</b></p></td><td align="left" valign="top"><p> Does MySQL support stored procedures and functions? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. MySQL supports two types of stored routines, stored procedures, and stored functions. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.2.</b></p></td><td align="left" valign="top"><p> Where can I find documentation for MySQL stored procedures and stored functions? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> See Section 27.2, “Using Stored Routines”. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.3.</b></p></td><td align="left" valign="top"><p> Is there a discussion forum for MySQL stored procedures? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. See https://forums.mysql.com/list.php?98. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.4.</b></p></td><td align="left" valign="top"><p> Where can I find the ANSI SQL 2003 specification for stored procedures? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Unfortunately, the official specifications are not freely available (ANSI makes them available for purchase). However, there are books, such as <em class="citetitle">SQL-99 Complete, Really</em> by Peter Gulutzan and Trudy Pelzer, that provide a comprehensive overview of the standard, including coverage of stored procedures. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.5.</b></p></td><td align="left" valign="top"><p> How do you manage stored routines? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> It is always good practice to use a clear naming scheme for your stored routines. You can manage stored procedures with <code>CREATE [FUNCTION|PROCEDURE]</code>, <code>ALTER [FUNCTION|PROCEDURE]</code>, <code>DROP [FUNCTION|PROCEDURE]</code>, and <code>SHOW CREATE [FUNCTION|PROCEDURE]</code>. You can obtain information about existing stored procedures using the <code>ROUTINES</code> table in the <code>INFORMATION_SCHEMA</code> database (see Section 28.3.30, “The INFORMATION_SCHEMA ROUTINES Table”). </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.6.</b></p></td><td align="left" valign="top"><p> Is there a way to view all stored procedures and stored functions in a given database? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. For a database named <em><code>dbname</code></em>, use this query on the <code>INFORMATION_SCHEMA.ROUTINES</code> table: </p><pre class="programlisting copytoclipboard language-sql"><code class="language-sql">SELECT ROUTINE_TYPE, ROUTINE_NAME FROM INFORMATION_SCHEMA.ROUTINES WHERE ROUTINE_SCHEMA='<em>dbname</em>';</code></pre><p> For more information, see Section 28.3.30, “The INFORMATION_SCHEMA ROUTINES Table”. </p><p> The body of a stored routine can be viewed using <code>SHOW CREATE FUNCTION</code> (for a stored function) or <code>SHOW CREATE PROCEDURE</code> (for a stored procedure). See Section 15.7.7.10, “SHOW CREATE PROCEDURE Statement”, for more information. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.7.</b></p></td><td align="left" valign="top"><p> Where are stored procedures stored? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Stored procedures are stored in the <code>mysql.routines</code> and <code>mysql.parameters</code> tables, which are part of the data dictionary. You cannot access these tables directly. Instead, query the <code>INFORMATION_SCHEMA</code> <code>ROUTINES</code> and <code>PARAMETERS</code> tables. See Section 28.3.30, “The INFORMATION_SCHEMA ROUTINES Table”, and Section 28.3.20, “The INFORMATION_SCHEMA PARAMETERS Table”. </p><p> You can also use <code>SHOW CREATE FUNCTION</code> to obtain information about stored functions, and <code>SHOW CREATE PROCEDURE</code> to obtain information about stored procedures. See Section 15.7.7.10, “SHOW CREATE PROCEDURE Statement”. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.8.</b></p></td><td align="left" valign="top"><p> Is it possible to group stored procedures or stored functions into packages? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> No. This is not supported in MySQL. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.9.</b></p></td><td align="left" valign="top"><p> Can a stored procedure call another stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.10.</b></p></td><td align="left" valign="top"><p> Can a stored procedure call a trigger? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> A stored procedure can execute an SQL statement, such as an <code>UPDATE</code>, that causes a trigger to activate. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.11.</b></p></td><td align="left" valign="top"><p> Can a stored procedure access tables? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. A stored procedure can access one or more tables as required. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.12.</b></p></td><td align="left" valign="top"><p> Do stored procedures have a statement for raising application errors? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. MySQL implements the SQL standard <code>SIGNAL</code> and <code>RESIGNAL</code> statements. See Section 15.6.7, “Condition Handling”. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.13.</b></p></td><td align="left" valign="top"><p> Do stored procedures provide exception handling? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> MySQL implements <code>HANDLER</code> definitions according to the SQL standard. See Section 15.6.7.2, “DECLARE ... HANDLER Statement”, for details. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.14.</b></p></td><td align="left" valign="top"><p> Can MySQL stored routines return result sets? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> <span><em>Stored procedures</em></span> can, but stored functions cannot. If you perform an ordinary <code>SELECT</code> inside a stored procedure, the result set is returned directly to the client. You need to use the MySQL 4.1 (or higher) client/server protocol for this to work. This means that, for example, in PHP, you need to use the <code>mysqli</code> extension rather than the old <code>mysql</code> extension. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.15.</b></p></td><td align="left" valign="top"><p> Is <code>WITH RECOMPILE</code> supported for stored procedures? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> No. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.16.</b></p></td><td align="left" valign="top"><p> Is there a MySQL equivalent to using <code>mod_plsql</code> as a gateway on Apache to talk directly to a stored procedure in the database? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> There is no equivalent in MySQL. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.17.</b></p></td><td align="left" valign="top"><p> Can I pass an array as input to a stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> No. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.18.</b></p></td><td align="left" valign="top"><p> Can I pass a cursor as an <code>IN</code> parameter to a stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Cursors are only available inside stored procedures. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.19.</b></p></td><td align="left" valign="top"><p> Can I return a cursor as an <code>OUT</code> parameter from a stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Cursors are only available inside stored procedures. However, if you do not open a cursor on a <code>SELECT</code>, the result is sent directly to the client. You can also <code>SELECT INTO</code> variables. See Section 15.2.13, “SELECT Statement”. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.20.</b></p></td><td align="left" valign="top"><p> Can I print out a variable's value within a stored routine for debugging purposes? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes, you can do this in a <span><em>stored procedure</em></span>, but not in a stored function. If you perform an ordinary <code>SELECT</code> inside a stored procedure, the result set is returned directly to the client. You must use the MySQL 4.1 (or above) client/server protocol for this to work. This means that, for example, in PHP, you need to use the <code>mysqli</code> extension rather than the old <code>mysql</code> extension. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.21.</b></p></td><td align="left" valign="top"><p> Can I commit or roll back transactions inside a stored procedure? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. However, you cannot perform transactional operations within a stored function. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.22.</b></p></td><td align="left" valign="top"><p> Do MySQL stored procedures and functions work with replication? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes, standard actions carried out in stored procedures and functions are replicated from a replication source server to a replica. There are a few limitations that are described in detail in Section 27.7, “Stored Program Binary Logging”. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.23.</b></p></td><td align="left" valign="top"><p> Are stored procedures and functions created on a replication source server replicated to a replica? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes, creation of stored procedures and functions carried out through normal DDL statements on a replication source server are replicated to a replica, so that the objects exist on both servers. <code>ALTER</code> and <code>DROP</code> statements for stored procedures and functions are also replicated. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.24.</b></p></td><td align="left" valign="top"><p> How are actions that take place inside stored procedures and functions replicated? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> MySQL records each DML event that occurs in a stored procedure and replicates those individual actions to a replica. The actual calls made to execute stored procedures are not replicated. </p><p> Stored functions that change data are logged as function invocations, not as the DML events that occur inside each function. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.25.</b></p></td><td align="left" valign="top"><p> Are there special security requirements for using stored procedures and functions together with replication? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Yes. Because a replica has authority to execute any statement read from a source's binary log, special security constraints exist for using stored functions with replication. If replication or binary logging in general (for the purpose of point-in-time recovery) is active, then MySQL DBAs have two security options open to them: </p> <div class="orderedlist"> <ol class="orderedlist" type="1"><li><p> Any user wishing to create stored functions must be granted the <code>SUPER</code> privilege. </p></li><li><p> Alternatively, a DBA can set the <code>log_bin_trust_function_creators</code> system variable to 1, which enables anyone with the standard <code>CREATE ROUTINE</code> privilege to create stored functions. </p></li></ol> </div> <p> </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.26.</b></p></td><td align="left" valign="top"><p> What limitations exist for replicating stored procedure and function actions? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> Nondeterministic (random) or time-based actions embedded in stored procedures may not replicate properly. By their very nature, randomly produced results are not predictable and cannot be exactly reproduced; therefore, random actions replicated to a replica do not mirror those performed on a source. Declaring stored functions to be <code>DETERMINISTIC</code> or setting the <code>log_bin_trust_function_creators</code> system variable to 0 keeps random operations producing random values from being invoked. </p><p> In addition, time-based actions cannot be reproduced on a replica because the timing of such actions in a stored procedure is not reproducible through the binary log used for replication. It records only DML events and does not factor in timing constraints. </p><p> Finally, nontransactional tables for which errors occur during large DML actions (such as bulk inserts) may experience replication issues in that a source may be partially updated from DML activity, but no updates are done to the replica because of the errors that occurred. A workaround is for a function's DML actions to be carried out with the <code>IGNORE</code> keyword so that updates on the source that cause errors are ignored and updates that do not cause errors are replicated to the replica. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.27.</b></p></td><td align="left" valign="top"><p> Do the preceding limitations affect the ability of MySQL to do point-in-time recovery? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> The same limitations that affect replication do affect point-in-time recovery. </p></td></tr><tr class="question"><td align="left" valign="top"><p><b>A.4.28.</b></p></td><td align="left" valign="top"><p> What is being done to correct the aforementioned limitations? </p></td></tr><tr class="answer"><td align="left" valign="top"></td><td align="left" valign="top"><p> You can choose either statement-based replication or row-based replication. The original replication implementation is based on statement-based binary logging. Row-based binary logging resolves the limitations mentioned earlier. </p><p> <span class="firstterm">Mixed</span> replication is also available (by starting the server with <code>--binlog-format=mixed</code>). This hybrid form of replication <span class="quote">“<span class="quote">knows</span>”</span> whether statement-level replication can safely be used, or row-level replication is required. </p><p> For additional information, see Section 19.2.1, “Replication Formats”. </p></td></tr></tbody></table>
